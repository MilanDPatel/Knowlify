{
    "topic": "The mathematical concept being demonstrated is the binary representation of a number and its visualization using Manim animation",
    "code": [
        "#!/usr/bin/env python\n",
        "\n",
        "\n",
        "import numpy as np\n",
        "import itertools as it\n",
        "from copy import deepcopy\n",
        "import sys\n",
        "\n",
        "from manim_imports_ext import *\n",
        "from script_wrapper import command_line_create_scene\n",
        "\n",
        "MOVIE_PREFIX = \"counting_in_binary/\"\n",
        "BASE_HAND_FILE = os.path.join(VIDEO_DIR, MOVIE_PREFIX, \"Base.mp4\")\n",
        "FORCED_FRAME_DURATION = 0.02\n",
        "TIME_RANGE = (0, 42)\n",
        "INITIAL_PADDING = 27\n",
        "NUM_GOOD_FRAMES = 1223\n",
        "\n",
        "ALGORITHM_TEXT = [\n",
        "    \"\"\"\n",
        "    \\\\begin{flushleft}\n",
        "    Turn up the rightmost finger that is down.\n",
        "    \"\"\", \"\"\"\n",
        "    Turn down all fingers to its right.\n",
        "    \\\\end{flushleft}\n",
        "    \"\"\"\n",
        "]\n",
        "FINGER_WORDS = [\n",
        "    \"Thumb\",\n",
        "    \"Index Finger\",\n",
        "    \"Middle Finger\",\n",
        "    \"Ring Finger\",\n",
        "    \"Pinky\",\n",
        "]\n",
        "\n",
        "COUNT_TO_FRAME_NUM = {\n",
        "    0 : 0,\n",
        "    1 : 27,\n",
        "    2 : 76,\n",
        "    3 : 110,\n",
        "    4 : 163,\n",
        "    5 : 189,\n",
        "    6 : 226,\n",
        "    7 : 264,\n",
        "    8 : 318,\n",
        "    9 : 356,\n",
        "    10 : 384,\n",
        "    11 : 423,\n",
        "    12 : 457,\n",
        "    13 : 513,\n",
        "    14 : 528,\n",
        "    15 : 590,\n",
        "    16 : 620,\n",
        "    17 : 671,\n",
        "    18 : 691,\n",
        "    19 : 740,\n",
        "    20 : 781,\n",
        "    21 : 810,\n",
        "    22 : 855,\n",
        "    23 : 881,\n",
        "    24 : 940,\n",
        "    25 : 970,\n",
        "    26 : 1014,\n",
        "    27 : 1055,\n",
        "    28 : 1092,\n",
        "    29 : 1143,\n",
        "    30 : 1184,\n",
        "    31 : 1219,\n",
        "}\n",
        "\n",
        "COUNT_TO_TIP_POS = {\n",
        "    0 : [5.0, 0.5, 0.0],\n",
        "    1 : [3.1, 2.5, 0.0],\n",
        "    2 : [1.5, 2.3, 0.0],\n",
        "    3 : [0.7, 2.0, 0.0],\n",
        "    4 : [0.0, 1.0, 0.0],\n",
        "}\n",
        "\n",
        "def finger_tip_power_of_2(finger_no):\n",
        "    return OldTex(str(2**finger_no)).shift(COUNT_TO_TIP_POS[finger_no])\n",
        "\n",
        "class Hand(ImageMobject):\n",
        "    STARTING_BOTTOM_RIGHT = [4.61111111e+00,  -3.98888889e+00, 9.80454690e-16]\n",
        "    def __init__(self, num, small = False, **kwargs):\n",
        "        Mobject2D.__init__(self, **kwargs)\n",
        "        path = os.path.join(\n",
        "            VIDEO_DIR, MOVIE_PREFIX, \"images\", \"Hand%d.png\"%num\n",
        "        )\n",
        "        invert = False\n",
        "        if not self.read_in_cached_attrs(path, invert):\n",
        "            ImageMobject.__init__(self, path, invert = invert)\n",
        "            center = self.get_center()\n",
        "            self.center()\n",
        "            self.rotate(np.pi, axis = RIGHT+UP)\n",
        "            self.sort_points(lambda p : np.log(complex(*p[:2])).imag)\n",
        "            self.rotate(np.pi, axis = RIGHT+UP)\n",
        "            self.shift(center)\n",
        "            self.cache_attrs(path, invert = False)\n",
        "        self.shift(self.STARTING_BOTTOM_RIGHT-self.get_boundary_point(DOWN+RIGHT))\n",
        "        if small:\n",
        "            self.shrink()\n",
        "\n",
        "    def shrink(self):\n",
        "        self.scale(0.8).to_edge(DOWN, buff = 0.0)\n",
        "\n",
        "    # def set_color_thumb(self, color = \"yellow\"):\n",
        "    #     self.set_color(\n",
        "    #         color = color,\n",
        "    #         condition = lambda p : p[0] > 4.5 and p[1] > -1.5\n",
        "    #     )\n",
        "\n",
        "def get_algorithm():\n",
        "    return OldTexText(ALGORITHM_TEXT)\n",
        "\n",
        "def get_finger_colors():\n",
        "    return list(Color(\"yellow\").range_to(\"red\", 5))\n",
        "\n",
        "def five_char_binary(num):\n",
        "    result = bin(num)[2:]\n",
        "    return (5-len(result))*\"0\" + result\n",
        "\n",
        "def read_reversed_binary(string):\n",
        "    return sum([\n",
        "        2**count if char == '1' else 0\n",
        "        for count, char in zip(it.count(), string)\n",
        "    ])\n",
        "\n",
        "class LeftHand(Hand):\n",
        "    def __init__(self, num, **kwargs):\n",
        "        Hand.__init__(\n",
        "            self,\n",
        "            read_reversed_binary(five_char_binary(num)),\n",
        "            **kwargs\n",
        "        )\n",
        "        self.rotate(np.pi, UP)\n",
        "        self.shift(LEFT)\n",
        "\n",
        "def get_hand_map(which_hand = \"right\"):\n",
        "    if which_hand == \"right\":\n",
        "        Class = Hand\n",
        "    elif which_hand == \"left\":\n",
        "        Class = LeftHand\n",
        "    else:\n",
        "        print(\"Bad arg, bro\")\n",
        "        return\n",
        "    return dict([\n",
        "        (num, Class(num, small=True))\n",
        "        for num in range(32)\n",
        "    ])\n",
        "\n",
        "class OverHand(SceneFromVideo):\n",
        "    def construct(self):\n",
        "        SceneFromVideo.construct(self, BASE_HAND_FILE)\n",
        "        self.frame_duration = FORCED_FRAME_DURATION\n",
        "        self.frames = self.frames[:NUM_GOOD_FRAMES]\n",
        "\n",
        "\n",
        "class SaveEachNumber(OverHand):\n",
        "    def construct(self):\n",
        "        OverHand.construct(self)\n",
        "        for count in COUNT_TO_FRAME_NUM:\n",
        "            path = os.path.join(\n",
        "                VIDEO_DIR, MOVIE_PREFIX, \"images\",\n",
        "                \"Hand%d.png\"%count\n",
        "            )\n",
        "            Image.fromarray(self.frames[COUNT_TO_FRAME_NUM[count]]).save(path)\n",
        "\n",
        "    def write_to_movie(self, name = None):\n",
        "        print(\"Why bother writing to movie...\")\n",
        "\n",
        "class ShowCounting(OverHand):\n",
        "    def construct(self):\n",
        "        OverHand.construct(self)\n",
        "        self.frames = INITIAL_PADDING*[self.frames[0]] + self.frames\n",
        "        num_frames = len(self.frames)\n",
        "        self.frames = [\n",
        "            disp.paint_mobject(\n",
        "                self.get_counting_mob(32*count // num_frames),\n",
        "                frame\n",
        "            )\n",
        "            for frame, count in zip(self.frames, it.count())\n",
        "        ]\n",
        "\n",
        "    def get_counting_mob(self, count):\n",
        "        mob = OldTex(str(count))\n",
        "        mob.scale(2)\n",
        "        mob.shift(LEFT)\n",
        "        mob.to_edge(UP, buff = 0.1)\n",
        "        return mob\n",
        "\n",
        "\n",
        "class ShowFrameNum(OverHand):\n",
        "    def construct(self):\n",
        "        OverHand.construct(self)\n",
        "        for frame, count in zip(self.frames, it.count()):\n",
        "            print(count + \"of\" + len(self.frames))\n",
        "            mob = Mobject(*[\n",
        "                OldTex(char).shift(0.3*x*RIGHT)\n",
        "                for char, x, in zip(str(count), it.count())\n",
        "            ])\n",
        "            self.frames[count] = disp.paint_mobject(\n",
        "                mob.to_corner(UP+LEFT),\n",
        "                frame\n",
        "            )\n",
        "\n",
        "class CountTo1023(Scene):\n",
        "    def construct(self):\n",
        "        rh_map = get_hand_map(\"right\")\n",
        "        lh_map = get_hand_map(\"left\")\n",
        "        def get_num(count):\n",
        "            return Mobject(*[\n",
        "                OldTex(char).shift(0.35*x*RIGHT)\n",
        "                for char, x, in zip(str(count), it.count())\n",
        "            ]).center().to_edge(UP)\n",
        "        self.frames = [\n",
        "            disp.paint_mobject(Mobject(\n",
        "                rh_map[count%32], lh_map[count//32], get_num(count)\n",
        "            ))\n",
        "            for count in range(2**10)\n",
        "        ]\n",
        "\n",
        "class Introduction(Scene):\n",
        "    def construct(self):\n",
        "        words = OldTexText(\"\"\"\n",
        "            First, let's see how to count\n",
        "            to 31 on just one hand...\n",
        "        \"\"\")\n",
        "        hand = Hand(0)\n",
        "        for mob in words, hand:\n",
        "            mob.sort_points(lambda p : p[0])\n",
        "\n",
        "        self.add(words)\n",
        "        self.wait()\n",
        "        self.play(DelayByOrder(Transform(words, hand)))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ShowReadingRule(Scene):\n",
        "    def construct(self):\n",
        "        sample_counts = [6, 17, 27, 31]\n",
        "        question = OldTexText(\"\"\"\n",
        "            How do you recognize what number a given configuration represents?\n",
        "        \"\"\", size = \"\\\\Huge\").scale(0.75).to_corner(UP+LEFT)\n",
        "        answer = OldTexText([\n",
        "            \"Think of each finger as representing a power of 2, \",\n",
        "            \"then add up the numbers represented by the standing fingers.\"\n",
        "        ], size = \"\\\\Huge\").scale(0.75).to_corner(UP+LEFT).split()\n",
        "        self.add(question)\n",
        "        for count in sample_counts:\n",
        "            hand = Hand(count, small = True)\n",
        "            self.add(hand)\n",
        "            self.wait()\n",
        "            self.remove(hand)\n",
        "        self.add(hand)\n",
        "        self.wait()\n",
        "        self.remove(question)\n",
        "        self.add(answer[0])\n",
        "        counts = list(map(finger_tip_power_of_2, list(range(5))))\n",
        "        for count in counts:\n",
        "            self.play(SpinInFromNothing(count, run_time = 0.3))\n",
        "        self.wait()\n",
        "        self.play(ShimmerIn(answer[1]))\n",
        "        for count in sample_counts:\n",
        "            self.clear()\n",
        "            self.add(*answer)\n",
        "            self.read_sample(count)\n",
        "\n",
        "    def read_sample(self, num):\n",
        "        hand = Hand(num, small = True)\n",
        "        bool_arr = [c == '1' for c in five_char_binary(num)]\n",
        "        counts = [4-count for count in range(5) if bool_arr[count]]\n",
        "        count_mobs = list(map(finger_tip_power_of_2, counts))\n",
        "        if num in [6, 27]:\n",
        "            count_mobs[1].shift(0.2*DOWN + 0.2*LEFT)\n",
        "        if num in [6, 17]:\n",
        "            hand.shift(0.8*LEFT)\n",
        "        sum_mobs = OldTex(\n",
        "            \" + \".join([str(2**c) for c in counts]).split(\" \") + [\"=%d\"%num]\n",
        "        ).to_corner(UP+RIGHT).split()\n",
        "        self.add(hand, *count_mobs)\n",
        "        self.wait()\n",
        "        self.play(*[\n",
        "            Transform(count_mobs[n/2], sum_mobs[n])\n",
        "            if n%2 == 0 and n/2 < len(counts)\n",
        "            else FadeIn(sum_mobs[n])\n",
        "            for n in range(len(sum_mobs))\n",
        "        ])\n",
        "        self.wait(2.0)\n",
        "\n",
        "\n",
        "class ShowIncrementRule(Scene):\n",
        "    def construct(self):\n",
        "        #First count from 18 to 22\n",
        "        def to_left(words):\n",
        "            return \"\\\\begin{flushleft}\" + words + \"\\\\end{flushleft}\"\n",
        "        phrases = [\n",
        "            OldTexText(to_left(words), size = \"\\\\Huge\").scale(0.75).to_corner(UP+LEFT)\n",
        "            for words in [\n",
        "            \"But while you're counting, you don't need to think about powers of 2.\",\n",
        "            \"Can you see the pattern for incrementing?\",\n",
        "            \"If the thumb is down, turn it up.\",\n",
        "            \"If the thumb is up, but the forefinger is down, flip them both.\",\n",
        "            \"If the thumb and forefinger are up, but the middle finger is down, flip all three.\",\n",
        "            \"In general, flip all of the fingers up to the rightmost one which is down.\",\n",
        "            \"After practicing for a minute or two, you're mind starts doing it automatically.\",\n",
        "            \"Question: Why does this rule for incrementation work?\",\n",
        "            ]\n",
        "        ]\n",
        "        ranges = [\n",
        "            (0, 14, False),\n",
        "            (14, 28, False),\n",
        "            (12, 13, True),\n",
        "            (29, 31, True),\n",
        "            (27, 29, True),\n",
        "            (23, 24, True),\n",
        "            (14, 20, False),\n",
        "            (20, 26, False)\n",
        "        ]\n",
        "        oh = OverHand()\n",
        "        for phrase, (start, end, pause) in zip(phrases, ranges):\n",
        "            if pause:\n",
        "                self.background = oh.frames[COUNT_TO_FRAME_NUM[start]]\n",
        "                self.add(phrase)\n",
        "                self.play(ShimmerIn(self.get_arrow_set(start)))\n",
        "                self.wait()\n",
        "                self.clear()\n",
        "                self.reset_background()\n",
        "            self.frames += [\n",
        "                disp.paint_mobject(phrase, frame)\n",
        "                for frame in oh.frames[COUNT_TO_FRAME_NUM[start]:COUNT_TO_FRAME_NUM[end]]\n",
        "            ]\n",
        "            if pause:\n",
        "                self.frames += [self.frames[-1]]*int(1.0/self.frame_duration)\n",
        "\n",
        "    def get_arrow_set(self, num):\n",
        "        arrow = OldTex(\"\\\\downarrow\", size = \"\\\\Huge\")\n",
        "        arrow.set_color(\"green\")\n",
        "        arrow.shift(-arrow.get_bottom())\n",
        "        if num == 12:\n",
        "            tips = [(4, 1, 0)]\n",
        "        elif num == 29:\n",
        "            tips = [\n",
        "                (6, 1.5, 0),\n",
        "                (3, 1.5, 0),\n",
        "            ]\n",
        "        elif num == 27:\n",
        "            tips = [\n",
        "                (5.5, 1.5, 0),\n",
        "                (2.75, 3.5, 0),\n",
        "                (2, 1.0, 0),\n",
        "            ]\n",
        "        elif num == 23:\n",
        "            tips = [\n",
        "                (6, 1, 0),\n",
        "                (3.25, 3.5, 0),\n",
        "                (2.25, 3.5, 0),\n",
        "                (1.5, 0.75, 0),\n",
        "            ]\n",
        "        return Mobject(*[\n",
        "            deepcopy(arrow).shift(tip)\n",
        "            for tip in tips\n",
        "        ])\n",
        "\n",
        "\n",
        "class MindFindsShortcuts(Scene):\n",
        "    def construct(self):\n",
        "        words1 = OldTexText(\"\"\"\n",
        "            Before long, your mind starts to recognize certain\n",
        "            patterns without needing to perform the addition.\n",
        "        \"\"\", size = \"\\\\Huge\").scale(0.75).to_corner(LEFT+UP)\n",
        "        words2 = OldTexText(\"\"\"\n",
        "            Which makes it faster to recognize other patterns...\n",
        "        \"\"\", size = \"\\\\Huge\").scale(0.75).to_corner(LEFT+UP)\n",
        "\n",
        "        hand = Hand(7).scale(0.5).center().shift(DOWN+2*LEFT)\n",
        "        sum421 = OldTex(\"4+2+1\").shift(DOWN+2*RIGHT)\n",
        "        seven = OldTex(\"7\").shift(DOWN+6*RIGHT)\n",
        "        compound = Mobject(\n",
        "            Arrow(hand, sum421),\n",
        "            sum421,\n",
        "            Arrow(sum421, seven)\n",
        "        )\n",
        "        self.add(\n",
        "            words1,\n",
        "            hand,\n",
        "            compound,\n",
        "            seven\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Transform(compound, Arrow(hand, seven).set_color(\"yellow\")),\n",
        "            ShimmerIn(OldTexText(\"Directly recognize\").shift(1.5*DOWN+2*RIGHT))\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        self.clear()\n",
        "        hands = dict([\n",
        "            (num, Hand(num).center().scale(0.5).shift(DOWN))\n",
        "            for num in [23, 16, 7]\n",
        "        ])\n",
        "        hands[23].shift(5*LEFT)\n",
        "        hands[16].shift(LEFT)\n",
        "        hands[7].shift(3*RIGHT)\n",
        "        for num in 7, 16:\n",
        "            hands[num].add(OldTex(str(num)).shift(hands[num].get_top()+0.5*UP))\n",
        "        plus = OldTex(\"+\").shift(DOWN + RIGHT)\n",
        "        equals = OldTex(\"=\").shift(DOWN + 2.5*LEFT)\n",
        "        equals23 = OldTex(\"=23\").shift(DOWN + 5.5*RIGHT)\n",
        "\n",
        "        self.add(words2, hands[23])\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Transform(\n",
        "                deepcopy(hands[16]).set_color(\"black\").center().shift(hands[23].get_center()),\n",
        "                hands[16]\n",
        "            ),\n",
        "            Transform(\n",
        "                deepcopy(hands[7]).set_color(\"black\").center().shift(hands[23].get_center()),\n",
        "                hands[7]\n",
        "            ),\n",
        "            Animation(hands[23]),\n",
        "            FadeIn(equals),\n",
        "            FadeIn(plus)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(ShimmerIn(equals23))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class CountingExampleSentence(ShowCounting):\n",
        "    def construct(self):\n",
        "        words = \"As an example, this is me counting the number of words in this sentence on just one hand!\"\n",
        "        self.words = OldTexText(words.split(), size = \"\\\\Huge\").scale(0.7).to_corner(UP+LEFT, buff = 0.25).split()\n",
        "        ShowCounting.construct(self)\n",
        "\n",
        "    def get_counting_mob(self, num):\n",
        "        return Mobject(*self.words[:num])\n",
        "\n",
        "class FinishCountingExampleSentence(Scene):\n",
        "    def construct(self):\n",
        "        words = \"As an example, this is me counting the number of words in this sentence on just one hand!\"\n",
        "        words = OldTexText(words, size = \"\\\\Huge\").scale(0.7).to_corner(UP+LEFT, buff = 0.25)\n",
        "        hand = Hand(18)\n",
        "        sixteen = OldTex(\"16\").shift([0, 2.25, 0])\n",
        "        two = OldTex(\"2\").shift([3, 3.65, 0])\n",
        "        eightteen = OldTex(\"18\").shift([1.5, 2.5, 0])\n",
        "        eightteen.sort_points()\n",
        "        comp = Mobject(sixteen, two)\n",
        "        self.add(hand, comp, words)\n",
        "        self.wait()\n",
        "        self.play(Transform(comp, eightteen))\n",
        "        self.wait()\n",
        "\n",
        "class Question(Scene):\n",
        "    def construct(self):\n",
        "        self.add(OldTexText(\"Left to ponder: Why does this rule for incrementing work?\"))\n",
        "\n",
        "\n",
        "class TwoHandStatement(Scene):\n",
        "    def construct(self):\n",
        "        self.add(OldTexText(\n",
        "            \"With 10 fingers, you can count up to $2^{10} - 1 = 1023$...\"\n",
        "        ))\n",
        "\n",
        "class WithToes(Scene):\n",
        "    def construct(self):\n",
        "        words = OldTexText([\n",
        "            \"If you were dexterous enough to use your toes as well,\",\n",
        "            \"you could count to 1,048,575\"\n",
        "        ]).split()\n",
        "        self.add(words[0])\n",
        "        self.wait()\n",
        "        self.play(ShimmerIn(words[1]))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "if __name__ == \"__main__\":\n",
        "    command_line_create_scene(MOVIE_PREFIX)\n"
    ]
}