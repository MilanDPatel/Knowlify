{
    "topic": "is demonstrating the concept of a set in mathematics.",
    "code": [
        "import mpmath\n",
        "import sympy\n",
        "from manim_imports_ext import *\n",
        "\n",
        "\n",
        "def get_set_tex(values, max_shown=7, **kwargs):\n",
        "    if len(values) > max_shown:\n",
        "        value_mobs = [\n",
        "            *map(Integer, values[:max_shown - 2]),\n",
        "            Tex(\"\\\\dots\"),\n",
        "            Integer(values[-1], group_with_commas=False),\n",
        "        ]\n",
        "    else:\n",
        "        value_mobs = list(map(Integer, values))\n",
        "\n",
        "    commas = Tex(\",\").replicate(len(value_mobs) - 1)\n",
        "    result = VGroup()\n",
        "    result.add(Tex(\"\\\\{\"))\n",
        "    result.add(*it.chain(*zip(value_mobs, commas)))\n",
        "    if len(value_mobs) > 0:\n",
        "        result.add(value_mobs[-1].align_to(value_mobs[0], UP))\n",
        "    result.add(Tex(\"\\\\}\"))\n",
        "    result.arrange(RIGHT, buff=SMALL_BUFF)\n",
        "    if len(values) > 0:\n",
        "        commas.set_y(value_mobs[0].get_y(DOWN))\n",
        "    if len(values) > max_shown:\n",
        "        result[-4].match_y(commas)\n",
        "    result.values = values\n",
        "    return result\n",
        "\n",
        "\n",
        "def get_part_by_value(set_tex, value):\n",
        "    try:\n",
        "        return next(sm for sm in set_tex if isinstance(sm, Integer) and sm.get_value() == value)\n",
        "    except StopIteration:\n",
        "        return VMobject().move_to(set_tex)\n",
        "\n",
        "\n",
        "def get_brackets(set_tex):\n",
        "    return VGroup(set_tex[0], set_tex[-1])\n",
        "\n",
        "\n",
        "def get_integer_parts(set_tex):\n",
        "    result = VGroup(*(\n",
        "        sm for sm in set_tex\n",
        "        if isinstance(sm, Integer)\n",
        "    ))\n",
        "    if len(result) == 0:\n",
        "        result.move_to(set_tex)\n",
        "    return result\n",
        "\n",
        "\n",
        "def get_commas(set_tex):\n",
        "    result = set_tex[2:-1:2]\n",
        "    if len(result) == 0:\n",
        "        result.move_to(set_tex)\n",
        "    return result\n",
        "\n",
        "\n",
        "def set_tex_transform(set_tex1, set_tex2):\n",
        "    bracket_anim = TransformFromCopy(\n",
        "        get_brackets(set_tex1),\n",
        "        get_brackets(set_tex2),\n",
        "    )\n",
        "    matching_anims = [\n",
        "        TransformFromCopy(\n",
        "            get_part_by_value(set_tex1, value),\n",
        "            get_part_by_value(set_tex2, value),\n",
        "        )\n",
        "        for value in filter(\n",
        "            lambda v: v in set_tex2.values,\n",
        "            set_tex1.values,\n",
        "        )\n",
        "    ]\n",
        "    mismatch_animations = [\n",
        "        FadeInFromPoint(\n",
        "            get_part_by_value(set_tex2, value),\n",
        "            set_tex1.get_center()\n",
        "        )\n",
        "        for value in set(set_tex2.values).difference(set_tex1.values)\n",
        "    ]\n",
        "    anims = [bracket_anim, *matching_anims, *mismatch_animations]\n",
        "    if len(set_tex2.values) > 1:\n",
        "        commas = []\n",
        "        for st in set_tex1, set_tex2:\n",
        "            if len(st.values) > 1:\n",
        "                commas.append(st[2:-1:2])\n",
        "            else:\n",
        "                commas.append(Tex(\",\").set_opacity(0).move_to(st, DOWN))\n",
        "        comma_animations = TransformFromCopy(*commas)\n",
        "        anims.append(comma_animations)\n",
        "    for part in set_tex2:\n",
        "        if isinstance(part, Tex) and part.get_tex() == \"\\\\dots\":\n",
        "            anims.append(FadeInFromPoint(part, set_tex1.get_bottom()))\n",
        "    return AnimationGroup(*anims)\n",
        "\n",
        "\n",
        "def get_sum_wrapper(set_tex):\n",
        "    wrapper = VGroup(\n",
        "        OldTex(\"\\\\text{sum}\\\\big(\\\\big) = \")[0],\n",
        "        Integer(sum(set_tex.values))\n",
        "    )\n",
        "    wrapper.set_height(1.25 * set_tex.get_height())\n",
        "    wrapper[0][:4].next_to(set_tex, LEFT, SMALL_BUFF)\n",
        "    wrapper[0][4:].next_to(set_tex, RIGHT, SMALL_BUFF)\n",
        "    wrapper[1].next_to(wrapper[0][-1], RIGHT, buff=0.2)\n",
        "    return wrapper\n",
        "\n",
        "\n",
        "def get_sum_group(set_tex, sum_color=YELLOW):\n",
        "    height = set_tex.get_height()\n",
        "    buff = 0.75 * height\n",
        "    arrow = Vector(height * RIGHT)\n",
        "    arrow.next_to(set_tex, RIGHT, buff=buff)\n",
        "    sum_value = Integer(sum(set_tex.values))\n",
        "    sum_value.set_color(sum_color)\n",
        "    sum_value.set_height(0.66 * height)\n",
        "    sum_value.next_to(arrow, RIGHT, buff=buff)\n",
        "\n",
        "    return VGroup(arrow, sum_value)\n",
        "\n",
        "\n",
        "def get_sum_animation(set_tex, sum_group, path_arc=-10 * DEGREES):\n",
        "    arrow, sum_value = sum_group\n",
        "\n",
        "    return AnimationGroup(\n",
        "        GrowArrow(arrow),\n",
        "        FadeTransform(\n",
        "            get_integer_parts(set_tex).copy(),\n",
        "            sum_value,\n",
        "            path_arc=path_arc,\n",
        "        ),\n",
        "    )\n",
        "\n",
        "\n",
        "def get_subset_highlights(set_tex, subset, stroke_color=YELLOW, stroke_width=2):\n",
        "    result = VGroup()\n",
        "    for value in subset:\n",
        "        if value not in set_tex.values:\n",
        "            continue\n",
        "        rect = SurroundingRectangle(\n",
        "            set_tex.get_part_by_tex(str(value)),\n",
        "            buff=0.05,\n",
        "            stroke_color=stroke_color,\n",
        "            stroke_width=stroke_width,\n",
        "        )\n",
        "        rect.round_corners(radius=rect.get_width() / 4)\n",
        "        result.add(rect)\n",
        "    return result\n",
        "\n",
        "\n",
        "def get_subsets(full_set):\n",
        "    return list(it.chain(*(\n",
        "        it.combinations(full_set, k)\n",
        "        for k in range(len(full_set) + 1)\n",
        "    )))\n",
        "\n",
        "\n",
        "def subset_to_int(subset):\n",
        "    return sum(2**(v - 1) for v in subset)\n",
        "\n",
        "\n",
        "def subset_sum_generating_function(full_set):\n",
        "    pass\n",
        "\n",
        "\n",
        "def get_question_title():\n",
        "    st = \"$\\\\{1, 2, 3, 4, 5, \\\\dots, 2{,}000\\\\}$\"\n",
        "    question = OldTexText(\n",
        "        f\"Find the number of subsets of {st},\\\\\\\\\"\n",
        "        \" the sum of whose elements is divisible by 5\",\n",
        "        isolate=[st]\n",
        "    )\n",
        "    set_tex = get_set_tex(range(1, 2001))\n",
        "    set_tex.set_color(BLUE)\n",
        "    set_tex.replace(question.get_part_by_tex(st))\n",
        "    question.replace_submobject(1, set_tex)\n",
        "    question.to_edge(UP)\n",
        "    return question\n",
        "\n",
        "\n",
        "def massive_int(num, n_cols=42, width=7):\n",
        "    total = VGroup(*(Integer(int(digit)) for digit in str(num)))\n",
        "    total.arrange_in_grid(h_buff=SMALL_BUFF, v_buff=1.5 * SMALL_BUFF, n_cols=n_cols)\n",
        "    for n in range(len(total) - 3, -3, -3):\n",
        "        comma = Tex(\",\")\n",
        "        triplet = total[n:n + 3]\n",
        "        triplet.arrange_to_fit_width(\n",
        "            triplet.get_width() - 2 * comma.get_width(),\n",
        "            about_edge=LEFT\n",
        "        )\n",
        "        comma.move_to(triplet.get_corner(DR) + 1.5 * comma.get_width() * RIGHT)\n",
        "        total.insert_submobject(n + 3, comma)\n",
        "    total[-1].set_opacity(0)\n",
        "    total.set_width(width)\n",
        "    return total\n",
        "\n",
        "\n",
        "def von_mangoldt_str(n):\n",
        "    factors = sympy.factorint(n)\n",
        "    if len(factors) == 1:\n",
        "        return f\"\\\\ln({list(factors.keys())[0]})\"\n",
        "    else:\n",
        "        return \"0\"\n",
        "\n",
        "# Scenes\n",
        "\n",
        "\n",
        "class PreviewFraming(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Setup\n",
        "        morty = self.teacher\n",
        "        ss = self.students\n",
        "\n",
        "        # top_text = Text(\"Question about whole numbers\")\n",
        "        # tt0 = top_text\n",
        "        # tt1 = VMobject()\n",
        "        top_text = Text(\"Today's puzzle (explained in a moment)\")\n",
        "        tt0 = top_text.select_part(\"Today's puzzle\")\n",
        "        tt1 = top_text.select_part(\"(explained in a moment)\")\n",
        "\n",
        "        top_text.to_edge(UP, buff=MED_SMALL_BUFF)\n",
        "        tt1.set_fill(GREY_B)\n",
        "        tt0.save_state()\n",
        "        tt0.set_x(0)\n",
        "        top_rect = Rectangle(\n",
        "            width=0.75 * FRAME_WIDTH,\n",
        "            height=0.125 * FRAME_WIDTH,\n",
        "        )\n",
        "        top_rect.set_fill(BLACK, 1)\n",
        "        top_rect.set_stroke(WHITE, 1)\n",
        "        top_rect.next_to(top_text, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            # FadeInFromPoint(top_rect, morty.get_corner(UR)),\n",
        "            DrawBorderThenFill(top_rect),\n",
        "            morty.change(\"raise_right_hand\", top_rect),\n",
        "            self.change_students(\n",
        "                \"erm\", \"thinking\", \"pondering\",\n",
        "                look_at=top_rect,\n",
        "            ),\n",
        "            Write(tt0)\n",
        "        )\n",
        "        self.wait(2)\n",
        "        self.play(\n",
        "            tt0.animate.restore(),\n",
        "            FadeIn(tt1, lag_ratio=0.1),\n",
        "            self.change_students(\n",
        "                \"pondering\", \"hesitant\", \"sassy\",\n",
        "                look_at=top_rect,\n",
        "            ),\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "        # Spoiler\n",
        "        spoiler_rect = ScreenRectangle()\n",
        "        spoiler_rect.set_fill(BLACK, 1)\n",
        "        spoiler_rect.set_stroke(WHITE, 1)\n",
        "        spoiler_rect.set_height(4.5)\n",
        "        spoiler_rect.to_corner(DL)\n",
        "        spoiler_rect.align_to(top_rect, LEFT)\n",
        "        spoiler_word = Text(\"Spoiler\", color=RED, font_size=60)\n",
        "        # spoiler_word = Text(\"Complex solution\", color=BLUE)\n",
        "        spoiler_word.next_to(spoiler_rect, RIGHT, buff=MED_LARGE_BUFF, aligned_edge=UP)\n",
        "        spoiler_word.shift(SMALL_BUFF * DOWN)\n",
        "\n",
        "        for pi in ss:\n",
        "            pi.generate_target()\n",
        "            pi.target.shift(2 * DOWN)\n",
        "            pi.target.change(\"horrified\", UP)\n",
        "            pi.target.set_opacity(0)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(spoiler_rect, DOWN),\n",
        "            LaggedStartMap(MoveToTarget, ss, run_time=1.5),\n",
        "            morty.change(\"tease\", ORIGIN),\n",
        "            Write(spoiler_word),\n",
        "        )\n",
        "        self.play(Blink(morty))\n",
        "        self.wait(3)\n",
        "        self.play(morty.change(\"surprised\", spoiler_rect))\n",
        "        self.play(Blink(morty))\n",
        "        self.wait(2)\n",
        "        self.play(morty.change(\"hesitant\", spoiler_rect))\n",
        "        self.wait()\n",
        "        self.play(Blink(morty))\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class UnreasonableUsefulness(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Title\n",
        "        pre_quote = Text(\n",
        "            \"The unreasonable effectiveness of\\n\"\n",
        "            \"mathematics in the natural sciences\",\n",
        "            t2c={\"mathematics\": BLUE, \"the natural sciences\": TEAL},\n",
        "            alignment=\"CENTER\"\n",
        "        )\n",
        "        quote = Text(\n",
        "            \"The unreasonable effectiveness of\\n\"\n",
        "            \"complex numbers in discrete math\",\n",
        "            t2c={\"complex numbers\": BLUE, \"discrete math\": TEAL},\n",
        "            alignment=\"CENTER\"\n",
        "        )\n",
        "        for text in pre_quote, quote:\n",
        "            text.to_edge(UP)\n",
        "\n",
        "        self.add(pre_quote)\n",
        "        self.wait()\n",
        "        self.remove(pre_quote)\n",
        "        quote_anim = LaggedStart(*(\n",
        "            FadeTransform(pre_quote.select_part(t0), quote.select_part(t1))\n",
        "            for t0, t1 in [\n",
        "                2 * [\"The unreasonable effectiveness of\"],\n",
        "                [\"mathematics\", \"complex numbers\"],\n",
        "                2 * [\"in\"],\n",
        "                [\"the natural sciences\", \"discrete math\"],\n",
        "            ]\n",
        "        ))\n",
        "\n",
        "        # Plane and numbers\n",
        "        plane = ComplexPlane((-3, 3), (-3, 3))\n",
        "        plane.set_height(5.5)\n",
        "        plane.to_corner(DL)\n",
        "        plane.add_coordinate_labels(font_size=20)\n",
        "        plane_title = Tex(\"\\\\mathds{C}\")\n",
        "        plane_title.next_to(plane.get_corner(UL), UR, SMALL_BUFF)\n",
        "\n",
        "        n, m = 8, 12\n",
        "        numbers = VGroup(*(Integer(n) for n in range(1, n * m + 1)))\n",
        "        numbers.arrange_in_grid(m, n, buff=MED_LARGE_BUFF)\n",
        "        numbers.match_height(plane)\n",
        "        numbers.match_y(plane).to_edge(RIGHT)\n",
        "\n",
        "        arrow = Arrow(plane, numbers)\n",
        "\n",
        "        self.play(\n",
        "            Write(plane, run_time=1, lag_ratio=0.01, stroke_color=WHITE, stroke_width=1),\n",
        "            Write(plane_title),\n",
        "            quote_anim,\n",
        "        )\n",
        "        self.play(\n",
        "            GrowArrow(arrow),\n",
        "            ShowIncreasingSubsets(numbers, run_time=5),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Highlight primes\n",
        "        prime_rects = VGroup()\n",
        "        for num in numbers:\n",
        "            num.generate_target()\n",
        "            if sympy.isprime(num.get_value()):\n",
        "                rect = SurroundingRectangle(num, buff=SMALL_BUFF)\n",
        "                rect.round_corners()\n",
        "                rect.set_stroke(TEAL, 1)\n",
        "                prime_rects.add(rect)\n",
        "            else:\n",
        "                num.target.set_opacity(0.25)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(MoveToTarget, numbers),\n",
        "            ShowIncreasingSubsets(prime_rects),\n",
        "            run_time=7,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Show zeta\n",
        "        zeta_def = Tex(\n",
        "            \"\\\\zeta(s) = \\\\sum_{n = 1}^\\\\infty {1 \\\\over n^s}\",\n",
        "            font_size=42,\n",
        "            tex_to_color_map={\"s\": YELLOW}\n",
        "        )\n",
        "        zeta_def.next_to(plane.c2p(-3, 3), DR)\n",
        "        zeta_def_highlight = VHighlight(\n",
        "            zeta_def,\n",
        "            color_bounds=(BLACK, BLACK),\n",
        "            max_stroke_addition=12,\n",
        "        )\n",
        "        for a, layer in zip(np.linspace(1, 0.2, 5), zeta_def_highlight):\n",
        "            layer.set_stroke(opacity=a)\n",
        "\n",
        "        zeta_spiril = ParametricCurve(\n",
        "            lambda t: plane.n2p(complex(mpmath.zeta(complex(0.5, t)))),\n",
        "            t_range=(0, 42),\n",
        "        )\n",
        "        zeta_spiril.set_stroke([YELLOW, YELLOW, RED], 2)\n",
        "\n",
        "        self.play(\n",
        "            ApplyMethod(\n",
        "                plane.coordinate_labels[-2:].set_opacity, 0,\n",
        "                time_span=(3, 4),\n",
        "            ),\n",
        "            FadeIn(zeta_def_highlight, time_span=(3, 4)),\n",
        "            Write(zeta_def, time_span=(2, 4)),\n",
        "            ShowCreation(zeta_spiril, rate_func=smooth, run_time=16),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class RiemannHypothesisMention(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.teacher_says(\n",
        "            \"This is what the $1M\\nRiemann Hypothesis\\nis all about\",\n",
        "            bubble_config=dict(width=4, height=3),\n",
        "            added_anims=[self.change_students(\n",
        "                \"erm\", \"happy\", \"thinking\",\n",
        "                look_at=self.screen,\n",
        "            )]\n",
        "        )\n",
        "        self.wait(3)\n",
        "        self.play_student_changes(\"pondering\", \"pondering\", \"tease\")\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class ZetaVideoWrapper(VideoWrapper):\n",
        "    title = \"From a previous video: Visualizing the Riemann Zeta Function\"\n",
        "\n",
        "\n",
        "class ToyVsRH(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Screens\n",
        "        self.add(FullScreenRectangle().set_fill(GREY_E, 1))\n",
        "        screens = ScreenRectangle().replicate(2)\n",
        "        screens.set_stroke(WHITE, 1)\n",
        "        screens.set_fill(BLACK, 1)\n",
        "        screens.set_height(3.5)\n",
        "        screens[0].to_corner(UL, buff=SMALL_BUFF)\n",
        "        screens[1].to_corner(DR, buff=SMALL_BUFF)\n",
        "\n",
        "        titles = VGroup(\n",
        "            Text(\"Our puzzle\"),\n",
        "            Text(\"Riemann Hypothesis\"),\n",
        "        )\n",
        "        for title, screen, vect in zip(titles, screens, [RIGHT, LEFT]):\n",
        "            title.next_to(screen, vect, buff=MED_LARGE_BUFF)\n",
        "        titles[0].shift(UP)\n",
        "        titles[1].shift(DOWN)\n",
        "        toy = Text(\"(toy problem)\")\n",
        "        toy.set_fill(GREY_B)\n",
        "        toy.next_to(titles[0], RIGHT)\n",
        "\n",
        "        self.add(screens)\n",
        "        self.add(titles)\n",
        "\n",
        "        # Distance\n",
        "        arrow = CubicBezier(\n",
        "            screens[0].get_right() + SMALL_BUFF * RIGHT,\n",
        "            screens[0].get_right() + 5 * RIGHT,\n",
        "            screens[1].get_left() + 5 * LEFT,\n",
        "            screens[1].get_left() + MED_SMALL_BUFF * LEFT,\n",
        "        )\n",
        "        arrow.add(ArrowTip().scale(0.5).move_to(arrow.get_end()))\n",
        "        arrow.set_color(TEAL)\n",
        "\n",
        "        arrow_label = Text(\"Long long\\ndistance\", font_size=36)\n",
        "        arrow_label.next_to(arrow.pfp(0.25), RIGHT)\n",
        "        arrow_label.set_color(TEAL)\n",
        "        or_is_it = Text(\"or is it?\", font_size=36)\n",
        "        or_is_it.next_to(arrow_label, DOWN, MED_LARGE_BUFF)\n",
        "        or_is_it.set_color(YELLOW)\n",
        "\n",
        "        self.play(ShowCreation(arrow))\n",
        "        self.play(Write(arrow_label, run_time=1))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeIn(toy, 0.5 * RIGHT)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeIn(or_is_it, 0.5 * DOWN))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class AnswerGuess(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Count total\n",
        "        title = get_question_title()\n",
        "\n",
        "        count = VGroup(Text(\"Total subsets: \"), Tex(\"2^{2{,}000}\"))\n",
        "        count[0].set_color(TEAL)\n",
        "        count.arrange(RIGHT, buff=MED_SMALL_BUFF, aligned_edge=DOWN)\n",
        "        count.scale(60 / 48)\n",
        "        count.next_to(title, DOWN, LARGE_BUFF)\n",
        "\n",
        "        self.add(title)\n",
        "        self.wait()\n",
        "        self.play(Write(count[0]))\n",
        "        self.play(\n",
        "            GrowFromCenter(count[1][0]),\n",
        "            FadeTransform(title[1][-6:-1].copy(), count[1][1:]),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Ask about why\n",
        "        count_rect = SurroundingRectangle(count, buff=MED_SMALL_BUFF)\n",
        "        count_rect.set_stroke(TEAL, 2)\n",
        "        randy = Randolph(height=1.5)\n",
        "        randy.flip()\n",
        "        randy.next_to(count_rect, RIGHT, LARGE_BUFF).shift(0.5 * DOWN)\n",
        "        randy.get_bubble(Text(\"Why?\", font_size=24), direction=LEFT, height=1.0, width=1.0)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(count_rect),\n",
        "            VFadeIn(randy),\n",
        "            randy.change(\"maybe\", count_rect),\n",
        "            Write(randy.bubble),\n",
        "            Write(randy.bubble.content),\n",
        "        )\n",
        "        self.play(Blink(randy))\n",
        "        self.wait()\n",
        "        self.play(randy.change(\"thinking\").look(DL))\n",
        "        self.play(Blink(randy))\n",
        "        randy.add(randy.bubble, randy.bubble.content)\n",
        "        self.wait()\n",
        "        self.play(*map(FadeOut, [randy, count_rect]))\n",
        "\n",
        "        # Show total digits\n",
        "        count.generate_target()\n",
        "        count.target.to_edge(LEFT)\n",
        "        eq = Tex(\"=\")\n",
        "        eq.next_to(count.target, RIGHT).match_y(count[1][0])\n",
        "\n",
        "        total = massive_int(2**2000)\n",
        "        total.next_to(eq, RIGHT).align_to(count, UP)\n",
        "\n",
        "        self.play(MoveToTarget(count), Write(eq))\n",
        "        self.play(ShowIncreasingSubsets(total, run_time=5))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(total, 0.1 * DOWN, lag_ratio=0.01),\n",
        "            FadeOut(eq),\n",
        "        )\n",
        "\n",
        "        # Guess 1 / 5\n",
        "        guess = VGroup(Text(\"Guess: \"), Tex(\"\\\\approx \\\\frac{1}{5} \\\\cdot 2^{2{,}000}\"))\n",
        "        guess[0].set_color(YELLOW)\n",
        "        guess.arrange(RIGHT)\n",
        "        guess.next_to(count, RIGHT, buff=2.5)\n",
        "        guess.match_y(count[0])\n",
        "\n",
        "        self.play(Write(guess[0]))\n",
        "        self.play(TransformMatchingShapes(count[1].copy(), guess[1], path_arc=30 * DEGREES))\n",
        "        self.wait()\n",
        "\n",
        "        # Simplify\n",
        "        small_set = get_set_tex(range(1, 6))\n",
        "        small_set.to_edge(UP)\n",
        "        simplify = Text(\"Simplify!\")\n",
        "        simplify.next_to(small_set, DOWN, MED_LARGE_BUFF)\n",
        "        simplify.set_color(YELLOW)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(\n",
        "                FadeOut, VGroup(count, guess),\n",
        "                lag_ratio=0.25,\n",
        "                run_time=1,\n",
        "            )\n",
        "        )\n",
        "        self.remove(title)\n",
        "        self.play(\n",
        "            FadeOut(title[0], scale=0.5),\n",
        "            FadeOut(title[2], scale=0.5),\n",
        "            set_tex_transform(title[1], small_set),\n",
        "            FadeIn(simplify, scale=2)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Ask questions\n",
        "        kw = dict(t2c={\n",
        "            \"construct\": YELLOW,\n",
        "            \"organize\": TEAL,\n",
        "        })\n",
        "        questions = VGroup(\n",
        "            Text(\"What are all\\nthe subsets?\", **kw),\n",
        "            Text(\"How do you\\norganize them?\", **kw),\n",
        "            Text(\"How do you\\nconstruct them?\", **kw),\n",
        "        )\n",
        "        questions.arrange(DOWN, buff=LARGE_BUFF, aligned_edge=LEFT)\n",
        "        questions.to_edge(LEFT).to_edge(DOWN, buff=LARGE_BUFF)\n",
        "\n",
        "        self.play(FadeTransform(simplify, questions[0]))\n",
        "        self.wait()\n",
        "        self.play(Write(questions[1], run_time=1))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformFromCopy(\n",
        "                questions[1].get_part_by_text(\"How do you\"),\n",
        "                questions[2].get_part_by_text(\"How do you\"),\n",
        "            ),\n",
        "            TransformFromCopy(\n",
        "                questions[1][-5:],\n",
        "                questions[2][-5:],\n",
        "            ),\n",
        "            FadeTransform(\n",
        "                questions[1].get_part_by_text(\"organize\").copy(),\n",
        "                questions[2].get_part_by_text(\"construct\"),\n",
        "            )\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class GoThroughAllSubsets(InteractiveScene):\n",
        "    n_searched = 2**6\n",
        "    rate = 1\n",
        "\n",
        "    def construct(self):\n",
        "        full_set = get_set_tex(range(1, 2001), max_shown=25)\n",
        "        full_set.set_width(0.9 * FRAME_WIDTH)\n",
        "        full_set.center()\n",
        "        full_set_elements = [sm for sm in full_set if isinstance(sm, Integer)]\n",
        "\n",
        "        sum_mob = Integer(0)\n",
        "        sum_mob.next_to(full_set, DOWN, buff=1.0)\n",
        "        sum_lhs = Text(\"Sum = \")\n",
        "        sum_lhs.next_to(sum_mob, LEFT)\n",
        "        sum_label = VGroup(sum_lhs, sum_mob)\n",
        "        sum_label.align_to(full_set, LEFT).shift(RIGHT)\n",
        "\n",
        "        counter = VGroup(\n",
        "            Text(\"Count so far: \"), Integer(0, edge_to_fix=LEFT)\n",
        "        )\n",
        "        counter.arrange(RIGHT)\n",
        "        counter.next_to(sum_mob, RIGHT)\n",
        "        counter.align_to(full_set, RIGHT).shift(LEFT)\n",
        "\n",
        "        for elem in full_set_elements:\n",
        "            elem.rect = SurroundingRectangle(elem, buff=0.05)\n",
        "            elem.rect.set_stroke(BLUE, 2)\n",
        "            elem.rect.round_corners()\n",
        "            elem.line = Line(elem.rect.get_bottom(), sum_mob.get_top(), buff=0.2)\n",
        "            elem.line.set_stroke(BLUE, 2)\n",
        "        self.add(full_set)\n",
        "        self.add(counter)\n",
        "        self.add(sum_label)\n",
        "\n",
        "        group = VGroup(\n",
        "            VGroup(),  # Rects\n",
        "            VGroup(),  # Lines\n",
        "            sum_mob,\n",
        "            counter[1],\n",
        "            VGroup(),  # Mark\n",
        "        )\n",
        "\n",
        "        n_tracker = ValueTracker(0)\n",
        "\n",
        "        all_counts = np.cumsum([\n",
        "            int(sum((int(bit) * n for n, bit in zip(it.count(1), reversed(bin(n)[2:])))) % 5 == 0)\n",
        "            for n in range(self.n_searched)\n",
        "        ])\n",
        "\n",
        "        def update_group(group):\n",
        "            n = int(n_tracker.get_value())\n",
        "            rects, lines, sum_mob, count, mark = group\n",
        "\n",
        "            bits = str(bin(n))[2:]\n",
        "            elems = []\n",
        "            subset = []\n",
        "            for i, elem, bit in zip(it.count(1), full_set_elements, reversed(bits)):\n",
        "                if bit == '1':\n",
        "                    elems.append(elem)\n",
        "                    subset.append(i)\n",
        "\n",
        "            total = sum(subset)\n",
        "            sum_mob.set_value(total)\n",
        "\n",
        "            rects.set_submobjects([elem.rect for elem in elems])\n",
        "            lines.set_submobjects([elem.line for elem in elems])\n",
        "\n",
        "            if total % 5 == 0:\n",
        "                count.set_value(all_counts[n])\n",
        "                count.set_color(GREEN)\n",
        "                sum_mob.set_color(GREEN)\n",
        "                check = Checkmark()\n",
        "                check.next_to(sum_mob, RIGHT)\n",
        "                mark.set_submobjects([check])\n",
        "            else:\n",
        "                sum_mob.set_color(WHITE)\n",
        "                mark.set_submobjects([])\n",
        "\n",
        "        self.add(group, n_tracker)\n",
        "        self.play(\n",
        "            n_tracker.animate.set_value(self.n_searched),\n",
        "            UpdateFromFunc(group, update_group),\n",
        "            run_time=self.n_searched / self.rate,\n",
        "            rate_func=linear,\n",
        "        )\n",
        "\n",
        "\n",
        "class GoThroughAllSubsetsFast(GoThroughAllSubsets):\n",
        "    n_searched = 2**13\n",
        "    rate = 120\n",
        "\n",
        "\n",
        "class TwoThousandBinaryChoices(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Build parts\n",
        "        full_set = get_set_tex(range(1, 2001), max_shown=25)\n",
        "        full_set.set_width(0.9 * FRAME_WIDTH)\n",
        "        full_set.center()\n",
        "        self.add(full_set)\n",
        "\n",
        "        elems = get_integer_parts(full_set)\n",
        "        elem_rects = VGroup(*(\n",
        "            SurroundingRectangle(elem, buff=0.05).round_corners()\n",
        "            for elem in elems\n",
        "        ))\n",
        "        elem_rects.set_stroke(BLUE, 2)\n",
        "\n",
        "        twos = VGroup(*(\n",
        "            Integer(2).match_width(elems[1]).next_to(er, UP)\n",
        "            for er in elem_rects\n",
        "        ))\n",
        "        dots = VGroup(*(\n",
        "            Tex(\"\\\\cdot\").move_to(midpoint(t1.get_right(), t2.get_left()))\n",
        "            for t1, t2 in zip(twos, twos[1:])\n",
        "        ))\n",
        "        dots.replace_submobject(-1, Tex(\"\\\\dots\").move_to(dots[-1]))\n",
        "        dots.add_to_back(VMobject())\n",
        "\n",
        "        choices = Text(\"choices\").match_height(twos)\n",
        "        VGroup(twos, dots, choices).set_color(TEAL)\n",
        "\n",
        "        # Label choices\n",
        "        words = Text(\"2,000 Binary choices\")\n",
        "        words.set_color(TEAL)\n",
        "        words.next_to(full_set, DOWN, buff=MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(ShowCreationThenFadeOut, elem_rects, lag_ratio=0.05),\n",
        "            FadeIn(words, 0.5 * DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Go through all choices\n",
        "        self.add(choices)\n",
        "        for rect, two, dot in zip(elem_rects, twos, dots):\n",
        "            choices.next_to(two, RIGHT, buff=0.2)\n",
        "            marks = VGroup(Checkmark(), Exmark())\n",
        "            marks.scale(0.5)\n",
        "            marks.next_to(rect, DOWN, SMALL_BUFF)\n",
        "            self.add(two, dot)\n",
        "            include = random.random() < 0.5\n",
        "            if include:\n",
        "                self.add(rect)\n",
        "                marks.submobjects.reverse()\n",
        "            self.play(ShowSubmobjectsOneByOne(marks.copy(), remover=True, run_time=0.5))\n",
        "            self.add(marks[-1])\n",
        "            self.wait(0.25)\n",
        "        self.remove(choices)\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class AskAboutGuess(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Number line\n",
        "        virt_N = 64\n",
        "        line = NumberLine(\n",
        "            (0, virt_N, 1),\n",
        "            tick_size=0.02,\n",
        "            longer_tick_multiple=4,\n",
        "            big_tick_numbers=range(0, virt_N + virt_N // 8, virt_N // 8),\n",
        "            width=FRAME_WIDTH - 2\n",
        "        )\n",
        "\n",
        "        line.move_to(2.0 * DOWN)\n",
        "\n",
        "        kw = dict(font_size=24)\n",
        "        line_labels = VGroup(\n",
        "            Tex(\"0\", **kw),\n",
        "            Tex(\"2^{1{,}998}\", **kw),\n",
        "            Tex(\"2^{1{,}999}\", **kw),\n",
        "            Tex(\"3 \\\\cdot 2^{1{,}998}\", **kw),\n",
        "            Tex(\"2^{2{,}000}\", **kw),\n",
        "        )\n",
        "        for n, label in zip(np.linspace(0, virt_N, 5), line_labels):\n",
        "            label.next_to(line.n2p(n), DOWN, MED_SMALL_BUFF)\n",
        "\n",
        "        self.add(line)\n",
        "        self.add(line_labels)\n",
        "\n",
        "        # Set label\n",
        "        title = get_question_title()\n",
        "        title.to_edge(UP)\n",
        "        self.add(title)\n",
        "        # set_tex = get_set_tex(range(1, 2001), max_shown=21)\n",
        "        # set_tex.scale(0.75)\n",
        "        # set_tex.to_edge(UP)\n",
        "        # self.add(set_tex)\n",
        "\n",
        "        # Arrow with labels\n",
        "        right_arrow = Vector(DOWN, color=BLUE)\n",
        "        right_arrow.next_to(line.n2p(virt_N), UP, buff=0)\n",
        "        right_label = Text(\"Total number\\nof subsets\", font_size=36)\n",
        "        right_label.next_to(right_arrow, UP)\n",
        "        right_label.shift_onto_screen(buff=MED_SMALL_BUFF)\n",
        "\n",
        "        left_arrow = right_arrow.copy()\n",
        "        left_arrow.set_color(YELLOW)\n",
        "        left_arrow.next_to(line.n2p(virt_N / 5), UP, buff=0)\n",
        "        left_label = OldTexText(\"Guess: \", \"$\\\\frac{1}{5} \\\\cdot 2^{2{,}000}$\", font_size=36)\n",
        "        left_label.next_to(left_arrow, UP)\n",
        "\n",
        "        self.add(right_label)\n",
        "        self.add(right_arrow)\n",
        "\n",
        "        self.play(\n",
        "            TransformFromCopy(right_arrow, left_arrow),\n",
        "            FadeTransform(right_label.copy(), left_label),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Not an integer\n",
        "        guess_part = left_label[1]\n",
        "        guess_rect = SurroundingRectangle(guess_part, buff=SMALL_BUFF)\n",
        "        guess_rect.round_corners()\n",
        "        guess_rect.set_stroke(RED, 2)\n",
        "        nonint = Text(\"Not an integer!\", color=RED)\n",
        "        nonint.next_to(guess_rect, UP)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(guess_rect),\n",
        "            Write(nonint)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # More or less\n",
        "        dot = GlowDot(color=TEAL)\n",
        "        dot.move_to(line.n2p(virt_N / 5))\n",
        "        tip = Triangle(start_angle=-PI / 2)\n",
        "        tip.set_stroke(width=0)\n",
        "        tip.set_fill(TEAL, 1)\n",
        "        tip.set_height(0.1)\n",
        "        tip.add_updater(lambda t: t.move_to(dot.get_center(), DOWN))\n",
        "\n",
        "        self.play(FadeIn(dot), FadeIn(tip))\n",
        "        for dist in [0.2, 1.5]:\n",
        "            for vect in [RIGHT, 2 * LEFT]:\n",
        "                self.play(dot.animate.shift(dist * vect))\n",
        "                self.add(Group(dot, tip).copy().clear_updaters().set_opacity(0.5))\n",
        "            self.wait()\n",
        "        for n in range(40):\n",
        "            dot.move_to(line.n2p(virt_N / 5 + random.uniform(-8, 8)))\n",
        "            self.wait(0.25)\n",
        "\n",
        "\n",
        "class WhoCares(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Who cares?\n",
        "        self.play(\n",
        "            PiCreatureSays(\n",
        "                self.students[2], \"Who cares?\", target_mode=\"angry\",\n",
        "                bubble_config=dict(direction=LEFT),\n",
        "            ),\n",
        "            self.teacher.change(\"guilty\"),\n",
        "            self.students[0].change(\"sassy\"),\n",
        "            self.students[0].change(\"hesitant\"),\n",
        "        )\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class ExampleWith5(InteractiveScene):\n",
        "    elem_colors = color_gradient([BLUE_B, BLUE_D], 5)\n",
        "\n",
        "    def construct(self):\n",
        "        # Add full set\n",
        "        N = 5\n",
        "        full_set = list(range(1, N + 1))\n",
        "        set_tex = get_set_tex(full_set)\n",
        "        set_tex.to_edge(UP)\n",
        "        self.add(set_tex)\n",
        "        self.wait()\n",
        "\n",
        "        # Construct all subsets\n",
        "        subsets = self.construct_all_subsets(set_tex)\n",
        "\n",
        "        # Show n choose k stacks\n",
        "        stacks = self.get_subset_stacks(full_set)\n",
        "\n",
        "        anims = []\n",
        "        for stack in stacks:\n",
        "            for new_subset in stack:\n",
        "                for subset in subsets:\n",
        "                    if set(subset.values) == set(new_subset.values):\n",
        "                        anims.append(FadeTransform(subset, new_subset))\n",
        "\n",
        "        self.play(LaggedStart(*anims, lag_ratio=0.05))\n",
        "        self.wait()\n",
        "\n",
        "        # Show their sums\n",
        "        sum_stacks = self.get_subset_sums(stacks)\n",
        "        covered_sums = []\n",
        "        n_selections = 6\n",
        "        for n in range(n_selections):\n",
        "            self.wait(note=f\"Example sum {n + 1} / {n_selections}\")\n",
        "            # Show sum based on what's in self.selection\n",
        "            anims = []\n",
        "            for stack, sum_stack in zip(stacks, sum_stacks):\n",
        "                for subset, sum_mob in zip(stack, sum_stack):\n",
        "                    if set(subset.get_family()).intersection(self.selection.get_family()):\n",
        "                        if sum_mob not in covered_sums:\n",
        "                            covered_sums.append(sum_mob)\n",
        "                            anims.append(get_sum_animation(subset, sum_mob))\n",
        "            self.clear_selection()\n",
        "            self.play(LaggedStart(*anims))\n",
        "        self.add(sum_stacks)\n",
        "\n",
        "        # Group by sum\n",
        "        self.highlight_rects = self.get_highlight_rects(stacks, sum_stacks)\n",
        "        self.highlight_rects.set_stroke(width=0)\n",
        "        self.group_by_sum(stacks, sum_stacks)\n",
        "        self.wait()\n",
        "\n",
        "        # Count Answer\n",
        "        highlights = VGroup()\n",
        "        for stack in self.common_sum_stacks[::5]:\n",
        "            for subset in stack:\n",
        "                highlights.add(VHighlight(subset, max_stroke_addition=10))\n",
        "\n",
        "        answer_word, answer_count = answer = VGroup(\n",
        "            Text(\"Answer: \"),\n",
        "            Integer(0)\n",
        "        )\n",
        "        answer.arrange(RIGHT)\n",
        "        answer.next_to(self.common_sum_stacks[0], UP, LARGE_BUFF)\n",
        "        answer_count.set_color(TEAL)\n",
        "\n",
        "        self.add(highlights, self.common_sum_stacks, answer)\n",
        "        self.play(\n",
        "            ShowIncreasingSubsets(highlights),\n",
        "            UpdateFromFunc(answer_count, lambda m: m.set_value(len(highlights))),\n",
        "            run_time=1.5\n",
        "        )\n",
        "        self.play(FadeOut(highlights))\n",
        "\n",
        "        # Contrast with 1/5\n",
        "        count = OldTexText(\n",
        "            \"Total subsets:\", \" $2^5 = $\", \" $32$\"\n",
        "        )\n",
        "        count.set_color_by_tex(\"32\", BLUE)\n",
        "        count.match_x(set_tex).match_y(answer)\n",
        "        counter = Integer(32)\n",
        "        counter.set_color(BLUE)\n",
        "        counter.replace(count[-1])\n",
        "\n",
        "        all_highlights = VGroup()\n",
        "        for stack in self.common_sum_stacks:\n",
        "            for subset in stack:\n",
        "                all_highlights.add(VHighlight(subset, max_stroke_addition=10))\n",
        "\n",
        "        fifth_arrow = Vector(RIGHT)\n",
        "        fifth_arrow.next_to(count, RIGHT)\n",
        "        fifth = Tex(\"\\\\times 1 / 5\", font_size=24)\n",
        "        fifth.next_to(fifth_arrow, UP, buff=SMALL_BUFF)\n",
        "        fifth_rhs = DecimalNumber(32 / 5, num_decimal_places=1)\n",
        "        fifth_rhs.next_to(fifth_arrow, RIGHT)\n",
        "\n",
        "        self.add(all_highlights, self.common_sum_stacks)\n",
        "        self.play(\n",
        "            FadeIn(count[:2]),\n",
        "            ShowIncreasingSubsets(all_highlights, run_time=2),\n",
        "            UpdateFromFunc(counter, lambda m: m.set_value(len(all_highlights))),\n",
        "        )\n",
        "        self.play(FadeOut(all_highlights))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            GrowArrow(fifth_arrow),\n",
        "            Write(fifth),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(count[-1].copy(), fifth_rhs, path_arc=-60 * DEGREES))\n",
        "        self.wait()\n",
        "        self.play(LaggedStartMap(FadeOut, VGroup(\n",
        "            answer, *count[:2], counter, fifth_arrow, fifth, fifth_rhs,\n",
        "        )))\n",
        "\n",
        "        # Show generating function\n",
        "        self.show_generating_function(set_tex)\n",
        "        self.transition_to_full_generating_function(set_tex)\n",
        "\n",
        "    def construct_all_subsets(self, set_tex):\n",
        "        # Preview binary choices\n",
        "        value_parts = VGroup(*(\n",
        "            get_part_by_value(set_tex, v) for v in range(1, 6)\n",
        "        ))\n",
        "        rects = VGroup(*(\n",
        "            SurroundingRectangle(vp, buff=0.1).round_corners()\n",
        "            for vp in value_parts\n",
        "        ))\n",
        "        rects.set_stroke(BLUE, 2)\n",
        "\n",
        "        words = Text(\"5 binary choices\")\n",
        "        words.next_to(set_tex, DOWN, buff=1.5)\n",
        "        lines = VGroup(*(\n",
        "            Line(words.get_top(), rect.get_bottom(), buff=0.15)\n",
        "            for rect in rects\n",
        "        ))\n",
        "        lines.match_style(rects)\n",
        "\n",
        "        def match_n(rects, n):\n",
        "            bits = it.chain(\n",
        "                str(bin(n)[-1:1:-1]),\n",
        "                it.repeat(\"0\")\n",
        "            )\n",
        "            for rect, bit in zip(rects, bits):\n",
        "                rect.set_stroke(opacity=float(bit == \"1\"))\n",
        "\n",
        "        self.add(rects)\n",
        "        self.play(\n",
        "            Write(words),\n",
        "            Write(lines),\n",
        "            UpdateFromAlphaFunc(\n",
        "                rects, lambda r, a: match_n(r, int(31 * a)),\n",
        "                run_time=4,\n",
        "                rate_func=linear,\n",
        "            )\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(rects),\n",
        "            LaggedStartMap(Uncreate, lines),\n",
        "            FadeOut(words, 0.1 * DOWN),\n",
        "        )\n",
        "\n",
        "        # Show construction\n",
        "        subsets = VGroup(get_set_tex([]))\n",
        "        for value in range(1, 6):\n",
        "            value_mob = get_part_by_value(set_tex, value)\n",
        "            marks = VGroup(Exmark(), Checkmark())\n",
        "            marks.match_height(value_mob)\n",
        "            marks.next_to(value_mob, DOWN)\n",
        "\n",
        "            subsets.generate_target()\n",
        "            added_subsets = VGroup(*(\n",
        "                get_set_tex([*ss.values, value]).move_to(ss)\n",
        "                for ss in subsets\n",
        "            ))\n",
        "            for ss in added_subsets:\n",
        "                self.color_set_tex(ss)\n",
        "                get_integer_parts(ss)[-1].set_opacity(0)\n",
        "\n",
        "            vect = [RIGHT, DOWN, RIGHT, DOWN, RIGHT][value - 1]\n",
        "            buff = [2.25, 0.75, 2.0, 0.75, 1.0][value - 1]\n",
        "            added_subsets.next_to(subsets, vect, buff=buff)\n",
        "            new_subsets = VGroup(*subsets.target, *added_subsets)\n",
        "            new_subsets.set_max_width(FRAME_WIDTH - 1)\n",
        "            new_subsets.center()\n",
        "            subsets_copy = subsets.copy()\n",
        "            for ssc, nss in zip(subsets_copy, added_subsets):\n",
        "                ssc.match_height(nss)\n",
        "                ssc.move_to(nss)\n",
        "\n",
        "            # self.wait()\n",
        "            elem = get_part_by_value(set_tex, value)\n",
        "            if value == 1:\n",
        "                self.play(set_tex_transform(set_tex, subsets[0]))\n",
        "                self.add(subsets)\n",
        "                self.wait()\n",
        "            self.play(\n",
        "                MoveToTarget(subsets, path_arc=30 * DEGREES),\n",
        "                ReplacementTransform(\n",
        "                    subsets.copy(),\n",
        "                    subsets_copy,\n",
        "                    path_arc=30 * DEGREES,\n",
        "                )\n",
        "            )\n",
        "            self.remove(subsets_copy)\n",
        "            self.play(\n",
        "                LaggedStart(*(\n",
        "                    Transform(\n",
        "                        elem.copy(),\n",
        "                        get_integer_parts(st)[-1].copy().set_opacity(1),\n",
        "                        remover=True,\n",
        "                    )\n",
        "                    for st in added_subsets\n",
        "                ), lag_ratio=0.1),\n",
        "                *(\n",
        "                    set_tex_transform(st1, st2)\n",
        "                    for st1, st2 in zip(subsets_copy, added_subsets)\n",
        "                ),\n",
        "                elem.animate.set_color(self.elem_colors[value - 1]),\n",
        "                FlashAround(elem, color=self.elem_colors[value - 1]),\n",
        "            )\n",
        "            self.remove(subsets_copy, new_subsets)\n",
        "            subsets.set_submobjects(list(new_subsets))\n",
        "            self.add(subsets)\n",
        "            subsets.set_opacity(1)\n",
        "            # self.wait()\n",
        "        self.wait()\n",
        "\n",
        "        # Equation\n",
        "        equation = Tex(\"2 \\\\cdot 2 \\\\cdot 2 \\\\cdot 2 \\\\cdot 2 = 2^5 = 32\")\n",
        "        equation.set_width(4)\n",
        "        equation.to_corner(UL)\n",
        "        equation.set_color(YELLOW)\n",
        "        self.play(Write(equation))\n",
        "        self.wait()\n",
        "        self.play(FadeOut(equation))\n",
        "\n",
        "        return subsets\n",
        "\n",
        "    def get_highlight_rects(self, stacks, sum_stacks):\n",
        "        rects = VGroup()\n",
        "        anims = []\n",
        "        for stack, sum_stack in zip(stacks, sum_stacks):\n",
        "            for set_tex, sum_group in zip(stack, sum_stack):\n",
        "                if sum(set_tex.values) % 5 == 0:\n",
        "                    rect = SurroundingRectangle(VGroup(set_tex, sum_group))\n",
        "                    rect.value = sum(set_tex.values)\n",
        "                    rects.add(rect)\n",
        "                else:\n",
        "                    anims.append(set_tex.animate.set_opacity(0.25))\n",
        "                    anims.append(sum_group.animate.set_opacity(0.25))\n",
        "        rects.set_stroke(TEAL, 2)\n",
        "        for rect in rects:\n",
        "            rect.round_corners()\n",
        "        return rects\n",
        "\n",
        "    def highlight_multiple_of_5(self, stacks, sum_stacks):\n",
        "        # Blah\n",
        "        rects = self.get_highlight_rects(stacks, sum_stacks)\n",
        "\n",
        "        counter = Integer(0, font_size=72)\n",
        "        counter.to_corner(UR)\n",
        "        counter.set_color(TEAL)\n",
        "\n",
        "        self.play(*anims, run_time=1)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeIn(rects, lag_ratio=0.9),\n",
        "            ChangeDecimalToValue(counter, len(rects)),\n",
        "            run_time=1.5\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        self.highlight_rects = rects\n",
        "        self.counter = counter\n",
        "\n",
        "    def group_by_sum(self, stacks, sum_stacks):\n",
        "        # Lock sums to subsets\n",
        "        subset_groups = VGroup()\n",
        "        for stack, sum_stack in zip(stacks, sum_stacks):\n",
        "            for set_tex, sum_group in zip(stack, sum_stack):\n",
        "                set_tex.sum_group = sum_group\n",
        "                sum_group.set_tex = set_tex\n",
        "                subset_groups.add(VGroup(set_tex, sum_group))\n",
        "\n",
        "        # Reorganize\n",
        "        common_sum_stacks = VGroup()\n",
        "        max_sum = max(sum(ssg[0].values) for ssg in subset_groups)\n",
        "        for n in range(max_sum + 1):\n",
        "            stack = VGroup(*filter(\n",
        "                lambda ssg: sum(ssg[0].values) == n,\n",
        "                subset_groups\n",
        "            ))\n",
        "            common_sum_stacks.add(stack)\n",
        "\n",
        "        common_sum_stacks.generate_target()\n",
        "        csst = common_sum_stacks.target\n",
        "        for stack in common_sum_stacks.target:\n",
        "            stack.arrange(DOWN, aligned_edge=RIGHT, buff=SMALL_BUFF)\n",
        "\n",
        "        csst.arrange_in_grid(4, 5, buff=MED_LARGE_BUFF, aligned_edge=RIGHT)\n",
        "        csst[10:15].set_y(np.mean([csst[5].get_y(DOWN), csst[15].get_y(UP)]))\n",
        "        csst.refresh_bounding_box()\n",
        "        csst.set_width(FRAME_WIDTH - 1)\n",
        "        csst.to_corner(DL)\n",
        "        csst.set_opacity(1)\n",
        "\n",
        "        # Create new rectangles\n",
        "        common_sum_rects = VGroup()\n",
        "        for stack in common_sum_stacks.target:\n",
        "            rect = SurroundingRectangle(stack, buff=SMALL_BUFF)\n",
        "            rect.round_corners(radius=0.05)\n",
        "            rect.value = sum(stack[0][0].values)\n",
        "            color = TEAL if rect.value % 5 == 0 else GREY_B\n",
        "            rect.set_stroke(color, 1)\n",
        "            common_sum_rects.add(rect)\n",
        "\n",
        "        rect_anims = []\n",
        "        for highlight_rect in self.highlight_rects:\n",
        "            for rect in common_sum_rects:\n",
        "                if rect.value == highlight_rect.value:\n",
        "                    rect_anims.append(Transform(highlight_rect, rect))\n",
        "        self.disable_interaction(common_sum_rects)\n",
        "\n",
        "        # Transition to common sum\n",
        "        self.play(\n",
        "            MoveToTarget(common_sum_stacks),\n",
        "            *rect_anims,\n",
        "            run_time=2\n",
        "        )\n",
        "        self.play(\n",
        "            FadeOut(self.highlight_rects),\n",
        "            FadeIn(common_sum_rects),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        self.subset_groups = subset_groups\n",
        "        self.common_sum_stacks = common_sum_stacks\n",
        "        self.common_sum_rects = common_sum_rects\n",
        "\n",
        "    def show_generating_function(self, set_tex):\n",
        "        # Setup expressions\n",
        "        css = self.common_sum_stacks\n",
        "        csr = self.common_sum_rects\n",
        "        lower_group = self.lower_group = VGroup(csr, css)\n",
        "\n",
        "        factored_terms = \"(1 + x^1)\", \"(1 + x^2)\", \"(1 + x^3)\", \"(1 + x^4)\", \"(1 + x^5)\"\n",
        "        factored = Tex(\"\".join(factored_terms), isolate=factored_terms)\n",
        "        expanded_terms = [\"1\"]\n",
        "        for n in range(1, 16):\n",
        "            k = len(css[n])\n",
        "            expanded_terms.append(str(k) + f\"x^{{{n}}}\")\n",
        "        expanded = Tex(\"+\".join(expanded_terms), isolate=[\"+\", *expanded_terms])\n",
        "        expanded.set_width(FRAME_WIDTH - 1)\n",
        "        factored.next_to(set_tex, DOWN, MED_LARGE_BUFF)\n",
        "        expanded.next_to(factored, DOWN, MED_LARGE_BUFF)\n",
        "        lhs = OldTex(\"p(x) = \")\n",
        "        lhs.next_to(factored, LEFT)\n",
        "\n",
        "        self.play(FadeIn(lhs))\n",
        "        for term, elem in zip(factored_terms, get_integer_parts(set_tex)):\n",
        "            part = factored.get_part_by_tex(term)\n",
        "            self.play(\n",
        "                FlashAround(elem, color=elem.get_color()),\n",
        "                FadeIn(part[:-2]),\n",
        "                FadeIn(part[-1]),\n",
        "            )\n",
        "            part[-2].match_style(elem)\n",
        "            self.play(FadeTransform(elem.copy(), part[-2]))\n",
        "            self.wait()\n",
        "        self.add(factored)\n",
        "\n",
        "        self.wait()\n",
        "        self.play(lower_group.animate.set_height(3.0, about_edge=DOWN))\n",
        "\n",
        "        # Emphasize 5 binary choices\n",
        "        parts = VGroup(*(\n",
        "            factored.get_part_by_tex(term)\n",
        "            for term in factored_terms\n",
        "        ))\n",
        "        rects = VGroup(*(\n",
        "            SurroundingRectangle(part, buff=0.05).round_corners()\n",
        "            for part in parts\n",
        "        ))\n",
        "        rects.set_stroke(BLUE, 2)\n",
        "        words = Text(\"5 binary choices\", color=BLUE)\n",
        "        words.next_to(rects, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(\n",
        "                VFadeInThenOut, rects,\n",
        "                lag_ratio=0.25,\n",
        "                run_time=4,\n",
        "            ),\n",
        "            Write(words),\n",
        "        )\n",
        "        self.play(FadeOut(words))\n",
        "\n",
        "        # Animate expansion\n",
        "        fac_term_parts = [factored.get_part_by_tex(term) for term in factored_terms]\n",
        "        expanded_parts = [expanded.get_part_by_tex(term) for term in expanded_terms]\n",
        "        super_expanded = VGroup()\n",
        "        super_expanded.next_to(factored, DOWN, MED_LARGE_BUFF)\n",
        "        collection_anims = []\n",
        "\n",
        "        subset_groups = self.subset_groups\n",
        "        subset_groups.submobjects.sort(\n",
        "            key=lambda ssg: sum(ssg[0].values)\n",
        "        )\n",
        "\n",
        "        for subset_group in subset_groups:\n",
        "            bits = [i + 1 in subset_group[0].values for i in range(5)]\n",
        "            top_terms = [\n",
        "                part[3:-1] if bit else part[1]\n",
        "                for bit, part in zip(bits, fac_term_parts)\n",
        "            ]\n",
        "            top_rects = VGroup(*(\n",
        "                # VHighlight(part, color_bounds=(BLUE, BLUE_E), max_stroke_addition=3.0)\n",
        "                SurroundingRectangle(part).set_stroke(BLUE, 2).round_corners()\n",
        "                for part in top_terms\n",
        "            ))\n",
        "            n = sum(b * k for k, b in zip(range(1, 6), bits))\n",
        "            if n == 0:\n",
        "                new_term = Tex(\"1\", font_size=36)\n",
        "                super_expanded.add(new_term)\n",
        "            else:\n",
        "                new_plus = Tex(\"+\", font_size=36)\n",
        "                new_term = Tex(f\"x^{{{n}}}\", font_size=36)\n",
        "                super_expanded.add(new_plus, new_term)\n",
        "                collection_anims.append(FadeOut(new_plus))\n",
        "            super_expanded.arrange(RIGHT, aligned_edge=DOWN, buff=SMALL_BUFF)\n",
        "            super_expanded.next_to(factored, DOWN, MED_LARGE_BUFF)\n",
        "            super_expanded.to_edge(LEFT)\n",
        "            if len(super_expanded) > 33:\n",
        "                super_expanded[33:].next_to(\n",
        "                    super_expanded[0], DOWN, MED_LARGE_BUFF, aligned_edge=LEFT\n",
        "                )\n",
        "            low_rect = SurroundingRectangle(new_term, buff=0.5 * SMALL_BUFF)\n",
        "            low_rect.set_stroke(BLUE, 2).round_corners()\n",
        "            collection_anims.append(\n",
        "                FadeTransform(new_term, expanded_parts[n], path_arc=10 * DEGREES)\n",
        "            )\n",
        "\n",
        "            self.add(top_rects)\n",
        "            self.add(super_expanded, low_rect)\n",
        "            subset_groups.set_opacity(0.25)\n",
        "            subset_group.set_opacity(1)\n",
        "            self.wait()\n",
        "            self.remove(top_rects, low_rect)\n",
        "        self.wait()\n",
        "\n",
        "        # Reorganize to expanded\n",
        "        lower_group.generate_target()\n",
        "        lower_group.target.set_height(4, about_edge=DOWN)\n",
        "        lower_group.target[1].set_opacity(1)\n",
        "        self.play(\n",
        "            LaggedStart(*collection_anims),\n",
        "            LaggedStartMap(FadeIn, expanded.get_parts_by_tex(\"+\")),\n",
        "            MoveToTarget(\n",
        "                lower_group,\n",
        "                rate_func=squish_rate_func(smooth, 0.5, 1.0)\n",
        "            ),\n",
        "            run_time=3,\n",
        "        )\n",
        "        self.add(expanded)\n",
        "        self.wait(note=\"Highlight multiples of 5\")\n",
        "\n",
        "        self.factored_func = VGroup(*lhs, *factored)\n",
        "        self.expanded_func = expanded\n",
        "\n",
        "    def transition_to_full_generating_function(self, set_tex):\n",
        "        # Expressions\n",
        "        factored = Tex(\n",
        "            \"f(x) = (1 + x^1)(1 + x^2)(1 + x^3) \\\\cdots \\\\left(1 + x^{1{,}999}\\\\right)\\\\left(1 + x^{2{,}000}\\\\right)\",\n",
        "        )\n",
        "        expanded = Tex(\n",
        "            \"f(x) = 1+x+x^{2}+2 x^{3}+2 x^{4}+ 3x^{5} +\\\\cdots + x^{2{,}001{,}000}\",\n",
        "            isolate=\"+\",\n",
        "        )\n",
        "        new_set_tex = get_set_tex(range(1, 2001))\n",
        "        new_set_tex.move_to(set_tex)\n",
        "        self.color_set_tex(new_set_tex)\n",
        "        get_integer_parts(new_set_tex)[-1].set_color(\n",
        "            interpolate_color(BLUE_E, BLUE_D, 0.5)\n",
        "        )\n",
        "\n",
        "        h_line = Line(LEFT, RIGHT).set_width(FRAME_WIDTH)\n",
        "        h_line.set_stroke(GREY_C, 1)\n",
        "        h_line.set_y(0.5)\n",
        "\n",
        "        factored_word = Text(\"Factored\", font_size=60, color=BLUE_B)\n",
        "        factored_word.next_to(set_tex, DOWN, MED_LARGE_BUFF)\n",
        "        factored.next_to(factored_word, DOWN, MED_LARGE_BUFF)\n",
        "        expanded_word = Text(\"Expanded\", font_size=60, color=TEAL)\n",
        "        expanded_word.next_to(h_line, DOWN, buff=1.25)\n",
        "        expanded.next_to(expanded_word, DOWN, MED_LARGE_BUFF)\n",
        "        for mob in [factored, factored_word, expanded, expanded_word]:\n",
        "            mob.to_edge(LEFT)\n",
        "\n",
        "        small_group = VGroup(set_tex, self.factored_func)\n",
        "        self.play(\n",
        "            small_group.animate.set_y(-1.5),\n",
        "            FadeOut(self.expanded_func, 2 * DOWN),\n",
        "            FadeOut(self.lower_group, DOWN),\n",
        "        )\n",
        "        self.play(TransformMatchingShapes(set_tex.copy(), new_set_tex))\n",
        "        self.play(FadeTransform(self.factored_func.copy(), factored))\n",
        "        self.wait()\n",
        "        for n, i, j in [(1, 5, 11), (2, 11, 17), (3, 17, 23), (2000, 36, 46)]:\n",
        "            value_part = get_part_by_value(new_set_tex, n)\n",
        "            self.play(\n",
        "                FadeTransform(value_part.copy(), factored[i + 4:j - 1].copy(), remover=True),\n",
        "                FlashAround(factored[i:j], color=BLUE),\n",
        "            )\n",
        "        self.add(factored)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Write(factored_word),\n",
        "            FadeOut(small_group, DOWN)\n",
        "        )\n",
        "        self.play(\n",
        "            FadeTransform(factored_word.copy(), expanded_word),\n",
        "            ShowCreation(h_line),\n",
        "        )\n",
        "        self.play(FadeIn(expanded, run_time=2, lag_ratio=0.5))\n",
        "        self.wait()\n",
        "\n",
        "        # Emphasize scale\n",
        "        words = OldTexText(\"Imagine collecting $2^{2{,}000}$ terms!\")\n",
        "        words.set_color(RED)\n",
        "        words.next_to(h_line, DOWN)\n",
        "        words.to_edge(RIGHT)\n",
        "        morty = Mortimer(height=2)\n",
        "        morty.next_to(words, DOWN, MED_LARGE_BUFF)\n",
        "        morty.to_edge(RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            VFadeIn(morty),\n",
        "            morty.change(\"surprised\", expanded),\n",
        "            Write(words)\n",
        "        )\n",
        "        self.play(Blink(morty))\n",
        "        self.wait()\n",
        "        self.play(FadeOut(words), FadeOut(morty))\n",
        "\n",
        "        # Show example term\n",
        "        n = 25\n",
        "        subsets = list(filter(\n",
        "            lambda s: sum(s) == n,\n",
        "            get_subsets(range(1, n + 1))\n",
        "        ))\n",
        "        coef = len(subsets)\n",
        "        term = OldTex(str(coef), f\"x^{{{n}}}\", \"+\", \"\\\\cdots\")\n",
        "        term[:2].set_color(TEAL)\n",
        "        term[2:].set_color(WHITE)\n",
        "        tail = expanded[-11:]\n",
        "        term.move_to(tail, DL)\n",
        "        tail.generate_target()\n",
        "        tail.target.next_to(term, RIGHT, buff=0.15, aligned_edge=DOWN)\n",
        "\n",
        "        self.play(\n",
        "            Write(term),\n",
        "            MoveToTarget(tail),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        subset_mobs = VGroup(*map(get_set_tex, subsets))\n",
        "        subset_mobs.arrange_in_grid(n_cols=10)\n",
        "        subset_mobs.set_width(FRAME_WIDTH - 1)\n",
        "        subset_mobs.to_edge(UP)\n",
        "        subset_mobs.set_color(TEAL)\n",
        "        top_rect = FullScreenFadeRectangle()\n",
        "        top_rect.set_fill(BLACK, opacity=0.9)\n",
        "        top_rect.set_height(4, about_edge=UP, stretch=True)\n",
        "\n",
        "        term_rect = SurroundingRectangle(term[:2])\n",
        "        term_rect.round_corners()\n",
        "        term_rect.set_stroke(YELLOW, 2)\n",
        "        term_words = Text(\"Is there a snazzy\\nway to deduce this?\", font_size=36)\n",
        "        term_words.next_to(term_rect, DOWN)\n",
        "        term_words.set_color(YELLOW)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(top_rect),\n",
        "            ShowIncreasingSubsets(subset_mobs, run_time=5)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            ShowCreation(term_rect),\n",
        "            Write(term_words),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStartMap(FadeOut, subset_mobs, shift=0.2 * UP),\n",
        "            FadeOut(top_rect, rate_func=squish_rate_func(smooth, 0.6, 1)),\n",
        "            run_time=3\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "    ##\n",
        "\n",
        "    def color_set_tex(self, set_tex):\n",
        "        for value in set_tex.values:\n",
        "            elem = get_part_by_value(set_tex, value)\n",
        "            if value - 1 < len(self.elem_colors):\n",
        "                elem.set_color(self.elem_colors[value - 1])\n",
        "\n",
        "    def get_subset_stacks(self, full_set, buff=3.5):\n",
        "        stacks = VGroup(*(\n",
        "            VGroup(*(\n",
        "                get_set_tex(subset)\n",
        "                for subset in it.combinations(full_set, k)\n",
        "            ))\n",
        "            for k in range(len(full_set) + 1)\n",
        "        ))\n",
        "        for stack in stacks:\n",
        "            stack.arrange(DOWN)\n",
        "            for ss in stack:\n",
        "                self.color_set_tex(ss)\n",
        "        stacks.arrange(RIGHT, buff=buff, aligned_edge=DOWN)\n",
        "\n",
        "        stacks[0].move_to(stacks[1]).align_to(stacks[2], UP)\n",
        "        stacks[4].align_to(stacks[3], UP)\n",
        "        stacks[5].match_x(stacks[4])\n",
        "\n",
        "        stacks.set_max_height(FRAME_HEIGHT - 3)\n",
        "        stacks.set_max_width(FRAME_WIDTH - 2)\n",
        "        stacks.center().to_edge(DOWN)\n",
        "        return stacks\n",
        "\n",
        "    def get_subset_sums(self, stacks):\n",
        "        return VGroup(*(\n",
        "            VGroup(*(\n",
        "                get_sum_group(set_tex)\n",
        "                for set_tex in stack\n",
        "            ))\n",
        "            for stack in stacks\n",
        "        ))\n",
        "\n",
        "\n",
        "class SpecifyEmptySet(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Ask\n",
        "        morty = self.teacher\n",
        "        ss = self.students\n",
        "        self.student_says(\n",
        "            \"Do we count\\nthe empty set?\",\n",
        "            bubble_config=dict(direction=RIGHT),\n",
        "            target_mode=\"raise_right_hand\",\n",
        "            added_anims=[\n",
        "                morty.change(\"happy\"),\n",
        "                ss[0].change(\"hesitant\"),\n",
        "                ss[0].change(\"pondering\"),\n",
        "            ]\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Facts\n",
        "        kw = dict(tex_to_color_map={\"\\\\{\\\\}\": YELLOW})\n",
        "        facts = VGroup(\n",
        "            Tex(\"\\\\text{We do count } \\\\{\\\\}\", **kw),\n",
        "            Tex(\"\\\\text{sum}(\\\\{\\\\}) = 0\", **kw),\n",
        "            OldTexText(\"0 is a multiple of 5\", **kw),\n",
        "        )\n",
        "        facts.next_to(morty.get_corner(UL), UP, MED_LARGE_BUFF)\n",
        "\n",
        "        last_facts = VGroup()\n",
        "        for fact in facts:\n",
        "            self.play(\n",
        "                FadeIn(fact, 0.5 * UP),\n",
        "                morty.change(\"raise_right_hand\", fact),\n",
        "                ss[0].change(\"pondering\", fact),\n",
        "                ss[1].change(\"pondering\", fact),\n",
        "                ss[2].change(\"pondering\", fact),\n",
        "                last_facts.animate.shift(UP)\n",
        "            )\n",
        "            self.wait()\n",
        "            last_facts.add(fact)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            RemovePiCreatureBubble(ss[2], target_mode=\"happy\"),\n",
        "            ss[0].change(\"thinking\"),\n",
        "            ss[1].change(\"tease\"),\n",
        "        )\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class ShowHypercubeConstruction(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Intro\n",
        "        v1 = np.array([1.5, 1.5, 0.5])\n",
        "        v2 = np.array([-2.5, 0.5, 1.5])\n",
        "        vects = 1.5 * np.array([\n",
        "            RIGHT, UP, OUT,\n",
        "            v1, v2,\n",
        "            1.5 * (v1 + 2 * OUT), 2 * (v2 + 2 * UP),\n",
        "            5 * v1, 5 * v2,\n",
        "        ])\n",
        "        colors = [GREEN_D, TEAL, BLUE_D, RED, PINK] * 2\n",
        "        curr_sets = VGroup(get_set_tex([]))\n",
        "        lines = VGroup()\n",
        "        frame = self.camera.frame\n",
        "\n",
        "        self.play(Write(curr_sets))\n",
        "        self.wait()\n",
        "\n",
        "        # Grow new sets\n",
        "        indices = list(range(1, 10))\n",
        "        for n, vect, color in zip(indices, vects, colors):\n",
        "            new_sets = VGroup(*(\n",
        "                get_set_tex([*st.values, n])\n",
        "                for st in curr_sets\n",
        "            ))\n",
        "            for ns in new_sets:\n",
        "                for value, c in zip(indices, colors):\n",
        "                    if value in ns.values:\n",
        "                        get_part_by_value(ns, value).set_color(c)\n",
        "                ns.set_backstroke()\n",
        "                if n >= 3:\n",
        "                    ns.rotate(70 * DEGREES, RIGHT)\n",
        "            curr_set_copies = curr_sets.copy()\n",
        "            curr_sets.generate_target()\n",
        "            new_lines = VGroup()\n",
        "            line_copies = VGroup()\n",
        "            for ns, cst, csc in zip(new_sets, curr_sets.target, curr_set_copies):\n",
        "                ns.move_to(cst)\n",
        "                ns.shift(vect)\n",
        "                cst.shift(-vect)\n",
        "                csc.move_to(ns)\n",
        "                new_lines.add(Line(\n",
        "                    cst.get_center(), ns.get_center(),\n",
        "                    # buff=MED_SMALL_BUFF + ns.length_over_dim(np.argmax(vect)),\n",
        "                    buff=MED_SMALL_BUFF + ns.get_height(),\n",
        "                    stroke_color=color,\n",
        "                    stroke_width=2,\n",
        "                ))\n",
        "            line_copies = lines.copy()\n",
        "            diff = new_sets[0].get_width() - curr_sets[0].get_width()\n",
        "            for line in line_copies:\n",
        "                if abs(line.get_vector()[0]) > 1e-2:\n",
        "                    line.set_width(line.get_width() - diff)\n",
        "                line.set_stroke(width=(1, 5, 5, 5, 1))\n",
        "            lines.generate_target()\n",
        "            line_copies.shift(vect)\n",
        "            lines.target.shift(-vect)\n",
        "            anims = [\n",
        "                MoveToTarget(curr_sets),\n",
        "                TransformFromCopy(curr_sets, curr_set_copies),\n",
        "                MoveToTarget(lines),\n",
        "                TransformFromCopy(lines, line_copies),\n",
        "                *map(GrowFromCenter, new_lines),\n",
        "            ]\n",
        "            if n == 3:\n",
        "                anims.append(ApplyMethod(\n",
        "                    frame.reorient, 10, 70,\n",
        "                    run_time=2,\n",
        "                ))\n",
        "                for st in [*curr_set_copies, *curr_sets.target]:\n",
        "                    st.rotate(70 * DEGREES, RIGHT)\n",
        "                frame.add_updater(lambda m, dt: frame.increment_theta(0.01 * dt))\n",
        "            if n >= 4:\n",
        "                anims.append(frame.animate.scale(1.5).reorient(-10, 70).move_to(2 * IN))\n",
        "            self.play(*anims)\n",
        "            self.remove(curr_set_copies)\n",
        "            self.play(*(\n",
        "                set_tex_transform(csc, ns)\n",
        "                for csc, ns in zip(curr_set_copies, new_sets)\n",
        "            ))\n",
        "            self.wait()\n",
        "\n",
        "            curr_sets.set_submobjects([*curr_sets, *new_sets])\n",
        "            curr_sets.set_backstroke()\n",
        "            lines.set_submobjects([*lines, *line_copies, *new_lines])\n",
        "            self.add(lines, curr_sets)\n",
        "            if n == 3:\n",
        "                for i in range(1, 4):\n",
        "                    self.highlight_direction(curr_sets, lines, i)\n",
        "        self.wait(5)\n",
        "\n",
        "    def styling(self):\n",
        "        # Style (To insert above)\n",
        "        everything = VGroup(*curr_sets.family_members_with_points(), *lines.family_members_with_points())\n",
        "        everything.sort(lambda p: -get_norm(p - self.frame.get_implied_camera_location()))\n",
        "        self.add(*everything)\n",
        "        for line in lines.family_members_with_points():\n",
        "            line.insert_n_curves(20)\n",
        "            line.set_stroke(width=(1, 7, 7, 7, 1))\n",
        "\n",
        "        curr_sets.set_fill(border_width=1.5)\n",
        "\n",
        "    def highlight_direction(self, set_texs, lines, index):\n",
        "        anims = []\n",
        "        for line in lines:\n",
        "            if np.argmax(line.get_vector()) == index - 1:\n",
        "                anims.append(ShowCreation(line))\n",
        "        self.play(LaggedStart(*anims, lag_ratio=0.25, run_time=1))\n",
        "        anims = []\n",
        "        for st in set_texs:\n",
        "            if index in st.values:\n",
        "                part = get_part_by_value(st, index)\n",
        "                outline = part.family_members_with_points()[0].copy()\n",
        "                outline.set_fill(opacity=0)\n",
        "                outline.set_stroke(YELLOW, 5)\n",
        "                anims.append(VShowPassingFlash(outline, time_width=2))\n",
        "        self.play(LaggedStart(*anims, lag_ratio=0.1, run_time=2))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class QuestionPolynomial(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Start\n",
        "        n_range = list(range(1, 6))\n",
        "        poly = Tex(\n",
        "            \"p(x) = \" + \"\".join(f\"(1 + x^{{{n}}})\" for n in n_range),\n",
        "            tex_to_color_map=dict(zip(\n",
        "                (f\"{{{n}}}\" for n in n_range),\n",
        "                color_gradient([BLUE_B, BLUE_D], 5)\n",
        "            )),\n",
        "            isolate=[\"x\"],\n",
        "        )\n",
        "        poly.move_to([-0.81438428, 2.25048456, 0.])\n",
        "        self.add(poly)\n",
        "\n",
        "        # Questions\n",
        "        questions = VGroup(\n",
        "            Text(\"Where does this\\ncome from?\", font_size=36),\n",
        "            Text(\"What do polynomials\\nhave to do with anything?\", font_size=36),\n",
        "            OldTexText(\"What is $x$?\", font_size=60, color=TEAL).set_backstroke(width=8),\n",
        "        )\n",
        "        pis = VGroup(*(Randolph(color=c, height=2.5) for c in [BLUE_C, BLUE_E, BLUE_D]))\n",
        "        pis.arrange(RIGHT, buff=LARGE_BUFF)\n",
        "        pis.to_corner(DL)\n",
        "\n",
        "        anims = []\n",
        "        for pi, mode, question in zip(pis, [\"maybe\", \"confused\", \"pleading\"], questions):\n",
        "            anim = PiCreatureSays(\n",
        "                pi, question,\n",
        "                target_mode=mode, look_at=poly,\n",
        "                bubble_config=dict(width=4, height=2.5),\n",
        "            )\n",
        "            pi.set_opacity(0)\n",
        "            anims.append(anim)\n",
        "            if pi is pis[1]:\n",
        "                anims.append(Animation(Mobject()))\n",
        "        self.play(LaggedStart(*anims, lag_ratio=0.9))\n",
        "\n",
        "        # Highlight xs\n",
        "        xs = poly.select_parts(\"x\")\n",
        "        rects = VGroup(*(SurroundingRectangle(x, buff=0.05).round_corners() for x in xs))\n",
        "        rects.set_stroke(TEAL, 2)\n",
        "\n",
        "        self.play(LaggedStartMap(ShowCreationThenFadeOut, rects, lag_ratio=0.1))\n",
        "        self.wait()\n",
        "\n",
        "        # x is just a symbol\n",
        "        words = OldTexText(\"$x$\", \" is just a symbol\")\n",
        "        words.to_edge(UP)\n",
        "        words[0].set_color(TEAL)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(\n",
        "                RemovePiCreatureBubble, pis,\n",
        "                look_at=poly,\n",
        "            ),\n",
        "            TransformFromCopy(xs[0], words[0]),\n",
        "            Write(words[1], time_span=(1, 2))\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Expansion\n",
        "        expansion = Tex(\"1+x^{1}+x^{2}+2 x^{3}+2 x^{4}+3 x^{5}+3 x^{6}+3 x^{7}+3 x^{8}+3 x^{9}+3 x^{10}+2 x^{11}+2 x^{12}+x^{13}+x^{14}+x^{15}\")\n",
        "        expansion.set_width(FRAME_WIDTH - 1)\n",
        "        expansion.next_to(poly, DOWN, MED_LARGE_BUFF)\n",
        "        expansion.set_x(0)\n",
        "\n",
        "        self.play(\n",
        "            TransformMatchingShapes(poly[5:].copy(), expansion, run_time=3, lag_ratio=0.01),\n",
        "            LaggedStart(*(pi.change(\"pondering\", expansion) for pi in pis))\n",
        "        )\n",
        "        self.play(LaggedStartMap(Blink, pis))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class PolynomialConstruction(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # (1 + x)\n",
        "        set_group = VGroup(\n",
        "            get_set_tex([]),\n",
        "            get_set_tex([1]),\n",
        "        )\n",
        "        set_group.scale(0.5)\n",
        "        curr_poly = Tex(\"(1 + x^1)\")\n",
        "        curr_poly[0].set_opacity(0)\n",
        "        curr_poly[-1].set_opacity(0)\n",
        "\n",
        "        for st, sym in zip(set_group, curr_poly[1::2]):\n",
        "            st.next_to(sym, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        self.add(curr_poly, set_group)\n",
        "\n",
        "        # Expand via subset iteration process\n",
        "        for n in range(2, 8):\n",
        "            cp_l, cp_r = curr_poly.replicate(2)\n",
        "            sg_l, sg_r = set_group.replicate(2)\n",
        "            plus = Tex(\"+\")\n",
        "            cp_l.next_to(plus, LEFT, LARGE_BUFF)\n",
        "            cp_r.next_to(plus, RIGHT, LARGE_BUFF)\n",
        "            sg_l.match_x(cp_l)\n",
        "            sg_r.match_x(cp_r)\n",
        "\n",
        "            self.remove(curr_poly, set_group)\n",
        "            added_anims = []\n",
        "            if n == 5:\n",
        "                added_anims.append(self.camera.frame.animate.set_height(10))\n",
        "            if n >= 6:\n",
        "                added_anims.append(self.camera.frame.animate.scale(1.4))\n",
        "                VGroup(cp_l, sg_l).shift(LEFT)\n",
        "                VGroup(cp_r, sg_r).shift(RIGHT)\n",
        "            self.play(\n",
        "                TransformFromCopy(curr_poly, cp_l),\n",
        "                TransformFromCopy(curr_poly, cp_r),\n",
        "                TransformFromCopy(set_group, sg_l),\n",
        "                TransformFromCopy(set_group, sg_r),\n",
        "                *added_anims\n",
        "            )\n",
        "            self.wait()\n",
        "            new_term = Tex(f\"x^{n}\")\n",
        "            new_poly = Tex(\"\".join([\n",
        "                f\"\\\\left(1 + x^{k}\\\\right)\"\n",
        "                for k in range(1, n + 1)\n",
        "            ]))\n",
        "            new_term.next_to(cp_r, LEFT, SMALL_BUFF)\n",
        "            new_term.align_to(cp_r.family_members_with_points()[1], DOWN)\n",
        "            new_sets = VGroup(*(\n",
        "                get_set_tex([*st.values, n])\n",
        "                for st in sg_r\n",
        "            ))\n",
        "            anims = [Write(new_term), Write(plus)]\n",
        "            for ns, s in zip(new_sets, sg_r):\n",
        "                ns.match_height(s)\n",
        "            new_sets.arrange_in_grid(\n",
        "                n_cols=2**int(np.ceil(np.log2(len(new_sets)) / 2))\n",
        "            )\n",
        "            new_sets.move_to(sg_r)\n",
        "            for ns, s in zip(new_sets, sg_r):\n",
        "                anims.append(set_tex_transform(s, ns))\n",
        "            if n == 2:\n",
        "                anims.append(cp_r.animate.set_opacity(1))\n",
        "\n",
        "            self.remove(sg_r)\n",
        "            self.play(*anims)\n",
        "            self.wait()\n",
        "\n",
        "            new_set_group = VGroup(*sg_l, *new_sets)\n",
        "            new_set_group.generate_target()\n",
        "            new_set_group.target.arrange_in_grid(\n",
        "                n_cols=2**int(np.ceil(np.log2(len(new_set_group)) / 2))\n",
        "            )\n",
        "            new_set_group.target.next_to(new_poly, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "            group = VGroup(cp_l, cp_r, plus, new_term)\n",
        "            self.play(group.animate.shift(2 * UP))\n",
        "            group_copy = group.copy()\n",
        "\n",
        "            self.add(group_copy)\n",
        "            self.play(\n",
        "                LaggedStart(\n",
        "                    Transform(\n",
        "                        cp_l, new_poly[:-6].copy().set_opacity(0),\n",
        "                        path_arc=30 * DEGREES,\n",
        "                        remover=True,\n",
        "                    ),\n",
        "                    ReplacementTransform(new_term, new_poly[-3:-1]),\n",
        "                    ReplacementTransform(cp_r, new_poly[:-6], path_arc=30 * DEGREES),\n",
        "                    ReplacementTransform(plus, new_poly[-4], path_arc=45 * DEGREES),\n",
        "                    Write(new_poly[-6:-4]),\n",
        "                    Write(new_poly[-1]),\n",
        "                ),\n",
        "                MoveToTarget(new_set_group),\n",
        "                run_time=2,\n",
        "            )\n",
        "            self.add(new_poly)\n",
        "            set_group = new_set_group\n",
        "            curr_poly = new_poly\n",
        "            self.play(FadeOut(group_copy))\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class GeneratingFunctions(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Title\n",
        "        title = Text(\"Generating functions!\", font_size=72)\n",
        "        title.to_edge(UP)\n",
        "        title.set_color(BLUE)\n",
        "        underline = Underline(title, buff=-0.05)\n",
        "        underline.scale(1.25)\n",
        "        underline.insert_n_curves(50)\n",
        "        underline.set_stroke(BLUE_B, width=[0, 3, 3, 3, 0])\n",
        "        self.play(\n",
        "            Write(title),\n",
        "            ShowCreation(underline),\n",
        "            run_time=1\n",
        "        )\n",
        "\n",
        "        # First poly\n",
        "        degree = 10\n",
        "        poly = OldTex(\n",
        "            \"f(x) = 1+1 x^{1}+1 x^{2}+2 x^{3}+2 x^{4}+\"\n",
        "            \"3 x^{5}+4 x^{6}+5x^{7}+6x^{8}+\"\n",
        "            \"8x^{9} + 10x^{10} + \\\\cdots\",\n",
        "            isolate=[\"=\", \"+\", \"x\"]\n",
        "        )\n",
        "        seps = [poly.get_part_by_tex(\"=\"), *poly.get_parts_by_tex(\"+\")]\n",
        "        shifter = 0.05\n",
        "        for sep in seps:\n",
        "            i = poly.submobjects.index(sep)\n",
        "            poly[i:].shift(shifter * LEFT)\n",
        "            poly[i + 1:].shift(shifter * LEFT)\n",
        "        poly.set_width(FRAME_WIDTH - 0.5)\n",
        "        poly.next_to(underline, DOWN, LARGE_BUFF)\n",
        "\n",
        "        self.add(poly)\n",
        "\n",
        "        subsets = get_subsets(list(range(1, degree + 1)))\n",
        "        subset_groups = VGroup().replicate(degree + 1)\n",
        "        for subset in subsets:\n",
        "            index = sum(subset)\n",
        "            if index <= degree:\n",
        "                subset_groups[index].add(get_set_tex(subset))\n",
        "\n",
        "        subset_groups.set_width(1.0)\n",
        "        subset_groups.set_color(BLUE_B)\n",
        "\n",
        "        self.play(FadeIn(poly, DOWN))\n",
        "        self.wait()\n",
        "\n",
        "        rects = VGroup()\n",
        "        for ssg, sep in zip(subset_groups, seps[:-1]):\n",
        "            coef = poly[poly.submobjects.index(sep) + 1]\n",
        "            ssg.arrange(DOWN, buff=SMALL_BUFF)\n",
        "            ssg.next_to(coef, DOWN, buff=MED_LARGE_BUFF)\n",
        "            rect = SurroundingRectangle(coef, buff=0.1)\n",
        "            rect.round_corners()\n",
        "            rect.set_stroke(BLUE, 1)\n",
        "            rects.add(rect)\n",
        "            coef.set_color(BLUE_B)\n",
        "\n",
        "            self.add(rect, ssg)\n",
        "            self.play(ShowIncreasingSubsets(\n",
        "                ssg,\n",
        "                int_func=np.ceil,\n",
        "                run_time=max(0.5, 0.1 * len(ssg)),\n",
        "                rate_func=linear,\n",
        "            ))\n",
        "            self.wait(0.5)\n",
        "            self.remove(rect)\n",
        "\n",
        "        # Fibbonacci poly\n",
        "        fib_poly = OldTex(\n",
        "            \"F(x) = 0+1 x^{1}+1 x^{2}+2 x^{3}+3 x^{4}+\"\n",
        "            \"5 x^{5}+ 8 x^{6} + 13 x^{7}+21 x^{8}+\\\\cdots\",\n",
        "            isolate=[\"=\", \"+\", \"x\"]\n",
        "        )\n",
        "        coefs = VGroup(*(\n",
        "            fib_poly[fib_poly.submobjects.index(sep) + 1]\n",
        "            for sep in (fib_poly.get_part_by_tex(\"=\"), *fib_poly.get_parts_by_tex(\"+\"))\n",
        "        ))\n",
        "        coefs.set_color(RED)\n",
        "        fib_poly.match_width(poly)\n",
        "        fib_poly.move_to(poly)\n",
        "\n",
        "        fib_name = Text(\"Fibonacci numbers\")\n",
        "        fib_name.match_color(coefs)\n",
        "        fib_name.next_to(fib_poly, DOWN, LARGE_BUFF)\n",
        "\n",
        "        coefs.set_opacity(0)\n",
        "        self.play(\n",
        "            FadeOut(poly, DOWN),\n",
        "            FadeIn(fib_poly, DOWN),\n",
        "            LaggedStartMap(FadeOut, subset_groups, shift=DOWN),\n",
        "            Write(fib_name),\n",
        "        )\n",
        "        coefs.set_opacity(1)\n",
        "        self.play(FadeIn(coefs, lag_ratio=0.5, run_time=3))\n",
        "        self.wait()\n",
        "\n",
        "        # Show Fibbonaci property\n",
        "        prop = Tex(\"f_{n} = f_{n - 1} + f_{n - 2}\")\n",
        "        func_prop1 = Tex(\"F(x) = xF(x) + x^2 F(x) + x\")\n",
        "        func_prop2 = Tex(\"F(x) = \\\\frac{x}{1 - x - x^2}\")\n",
        "\n",
        "        arrow = Tex(\"\\\\Updownarrow\")\n",
        "\n",
        "        prop.next_to(fib_poly, DOWN, LARGE_BUFF)\n",
        "        prop.shift(3 * RIGHT)\n",
        "        arrow.next_to(prop, DOWN)\n",
        "        func_prop1.next_to(arrow, DOWN)\n",
        "        func_prop2.next_to(func_prop1, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        def get_coef_arrows(n):\n",
        "            return VGroup(*(\n",
        "                Arrow(\n",
        "                    coefs[i].get_top(), coefs[n + 2].get_top(),\n",
        "                    path_arc=-75 * DEGREES,\n",
        "                    stroke_color=RED,\n",
        "                    stroke_width=3,\n",
        "                )\n",
        "                for i in (n, n + 1)\n",
        "            ))\n",
        "\n",
        "        coef_arrows = get_coef_arrows(0)\n",
        "\n",
        "        self.play(\n",
        "            fib_name.animate.to_edge(LEFT),\n",
        "            Write(prop),\n",
        "            ShowCreation(coef_arrows, lag_ratio=0.5, run_time=1.5),\n",
        "        )\n",
        "        self.wait()\n",
        "        for n in range(1, 7):\n",
        "            new_arrows = get_coef_arrows(n)\n",
        "            self.play(\n",
        "                FadeOut(coef_arrows),\n",
        "                ShowCreation(new_arrows, lag_ratio=0.5)\n",
        "            )\n",
        "            coef_arrows = new_arrows\n",
        "        self.play(\n",
        "            Write(arrow),\n",
        "            Write(func_prop1),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformMatchingShapes(func_prop1.copy(), func_prop2)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Show details\n",
        "        left_group = VGroup(prop, arrow, func_prop1, func_prop2)\n",
        "        details_box = Rectangle(7, 4.5)\n",
        "        details_box.set_fill(GREY_E, 1)\n",
        "        details_box.set_stroke(WHITE, 1)\n",
        "        details_box.to_corner(DR)\n",
        "        details_title = Text(\"Gritty details for the curious...\", font_size=36)\n",
        "        details_title.next_to(details_box.get_top(), DOWN, SMALL_BUFF)\n",
        "        details_box.add(details_title)\n",
        "\n",
        "        func_prop2.generate_target()\n",
        "        func_prop2.target.scale(0.5)\n",
        "        func_prop2.target.next_to(details_title, DOWN, MED_LARGE_BUFF).align_to(details_box, LEFT).shift(SMALL_BUFF * RIGHT)\n",
        "\n",
        "        rhs = Tex(\n",
        "            \" = {x \\\\over (1 - \\\\varphi x)(1 + \\\\frac{1}{\\\\varphi} x)}\"\n",
        "            \"= {1 / \\\\sqrt{5} \\\\over (1 - \\\\varphi x)} - {1 / \\\\sqrt{5} \\\\over (1 + \\\\frac{1}{\\\\varphi}x)}\",\n",
        "            font_size=24,\n",
        "        )\n",
        "        rhs.next_to(func_prop2.target, RIGHT, SMALL_BUFF, submobject_to_align=rhs[0])\n",
        "\n",
        "        expansion = Tex(\n",
        "            \"\\\\frac{1}{\\\\sqrt{5}}\\\\sum_{n = 0}^\\\\infty \\\\varphi^n x^n - \"\n",
        "            \"\\\\frac{1}{\\\\sqrt{5}}\\\\sum_{n = 0}^\\\\infty \\\\left({-1 \\\\over \\\\varphi}\\\\right)^n x^n\",\n",
        "            font_size=24\n",
        "        )\n",
        "        expansion.next_to(rhs, DOWN, MED_LARGE_BUFF)\n",
        "        expansion.match_x(details_box)\n",
        "\n",
        "        implication = Tex(\n",
        "            \"\\\\Rightarrow f_n = {\\\\varphi^n - (-1 / \\\\varphi)^n \\\\over \\\\sqrt{5}}\",\n",
        "            font_size=24,\n",
        "        )\n",
        "        implication.next_to(expansion, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            left_group.animate.to_edge(LEFT),\n",
        "            FadeOut(fib_name, LEFT),\n",
        "            FadeIn(details_box, LEFT, time_range=(0.5, 1.5))\n",
        "        )\n",
        "        self.play(MoveToTarget(func_prop2))\n",
        "        self.play(Write(rhs))\n",
        "        self.play(FadeIn(expansion, DOWN))\n",
        "        self.play(FadeIn(implication, DOWN))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class WideGraph(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Start\n",
        "        def func(x, n=10):\n",
        "            return np.product([1 + x**n for n in range(1, n + 1)])\n",
        "\n",
        "        plane = NumberPlane(\n",
        "            x_range=(-1, 1, 1),\n",
        "            y_range=(0, 10, 1),\n",
        "            width=FRAME_WIDTH - 1,\n",
        "            height=6,\n",
        "            background_line_style={\"stroke_width\": 1.5},\n",
        "            faded_line_ratio=10,\n",
        "        )\n",
        "        plane.to_edge(DOWN)\n",
        "        graph = plane.get_graph(func, (-1, 0.75))\n",
        "        graph.set_stroke(YELLOW, 2)\n",
        "        graph_label = OldTex(\"f(x)\")\n",
        "        graph_label.set_color(YELLOW)\n",
        "        graph_label.next_to(plane.i2gp(0.73, graph), LEFT)\n",
        "        graph_label.set_backstroke()\n",
        "\n",
        "        x_tracker = ValueTracker(0.75)\n",
        "        dot = GlowDot(color=WHITE)\n",
        "        dot.add_updater(lambda d: d.move_to(plane.i2gp(x_tracker.get_value(), graph)))\n",
        "\n",
        "        self.add(plane, graph, graph_label, dot)\n",
        "        self.add(x_tracker)\n",
        "        self.play(x_tracker.animate.set_value(0), run_time=3)\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class EvaluationTricks(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Setup function\n",
        "        def func(x, n=10):\n",
        "            return np.product([1 + x**n for n in range(1, n + 1)])\n",
        "\n",
        "        plane = NumberPlane(\n",
        "            (-1, 1),\n",
        "            (-10, 10, 5),\n",
        "            width=10,\n",
        "            faded_line_ratio=4,\n",
        "        )\n",
        "        plane.set_height(FRAME_HEIGHT)\n",
        "        plane.to_edge(LEFT, buff=0)\n",
        "        plane.add_coordinate_labels(x_values=[-1, 1], y_values=range(-10, 15, 5))\n",
        "        for cl in plane.x_axis.numbers:\n",
        "            cl.shift_onto_screen(buff=SMALL_BUFF)\n",
        "        graph = plane.get_graph(func, x_range=(-1, 1, 0.05))\n",
        "        graph.set_stroke(YELLOW, 2)\n",
        "        self.disable_interaction(plane)\n",
        "\n",
        "        tex_kw = dict(tex_to_color_map={\"x\": BLUE})\n",
        "        factored = Tex(\"f(x) = (1 + x)(1 + x^2)(1 + x^3) \\\\cdots (1 + x^{2{,}000})\", **tex_kw)\n",
        "        factored.to_corner(UR)\n",
        "        expanded = VGroup(\n",
        "            Tex(\"f(x) = \", **tex_kw),\n",
        "            Tex(\"\\\\sum_{n = 0}^{N} c_n x^n\", **tex_kw),\n",
        "            # Tex(\"= 1+x+x^{2}+2 x^{3}+2 x^{4}+ \\\\cdots\", **tex_kw)\n",
        "            Tex(\"= c_0 + c_1 x + c_2 x^{2} + c_3 x^{3} + \\\\cdots\", **tex_kw)\n",
        "        )\n",
        "        expanded.arrange(RIGHT, buff=0.2)\n",
        "        expanded.next_to(factored, DOWN, LARGE_BUFF, LEFT)\n",
        "\n",
        "        factored_label = Text(\"What we know\", color=TEAL_B)\n",
        "        expanded_label = Text(\"What we want\", color=TEAL_C)\n",
        "        for label, expr in [(factored_label, factored), (expanded_label, expanded)]:\n",
        "            label.next_to(expr, LEFT, LARGE_BUFF)\n",
        "            expr.arrow = Arrow(label, expr)\n",
        "\n",
        "        self.add(factored)\n",
        "        self.play(\n",
        "            Write(factored_label),\n",
        "            ShowCreation(factored.arrow),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(factored.copy(), expanded))\n",
        "        self.play(\n",
        "            Write(expanded_label),\n",
        "            ShowCreation(expanded.arrow),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Black box\n",
        "        lhs = expanded[0]\n",
        "        rhs = expanded[2]\n",
        "        box = SurroundingRectangle(rhs[1:])\n",
        "        box.set_stroke(WHITE, 1)\n",
        "        box.set_fill(GREY_E, 1)\n",
        "        q_marks = Tex(\"?\").get_grid(1, 7, buff=0.7)\n",
        "        q_marks.move_to(box)\n",
        "        box.add(q_marks)\n",
        "\n",
        "        self.play(FadeIn(box, lag_ratio=0.25, run_time=2))\n",
        "        self.wait()\n",
        "\n",
        "        # Show example evaluations\n",
        "        x_tracker = ValueTracker(0.5)\n",
        "        get_x = x_tracker.get_value\n",
        "        dot = GlowDot(color=WHITE)\n",
        "        dot.add_updater(lambda m: m.move_to(plane.i2gp(get_x(), graph)))\n",
        "        line = Line(DOWN, UP).set_stroke(WHITE, 1)\n",
        "        line.add_updater(lambda l: l.put_start_and_end_on(\n",
        "            plane.c2p(get_x(), 0),\n",
        "            plane.i2gp(get_x(), graph)\n",
        "        ))\n",
        "\n",
        "        self.play(\n",
        "            Write(plane, lag_ratio=0.01),\n",
        "            LaggedStartMap(FadeOut, VGroup(factored_label, expanded_label, factored.arrow, expanded.arrow)),\n",
        "        )\n",
        "        self.play(ShowCreation(graph))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            ShowCreation(line),\n",
        "            FadeInFromPoint(dot, line.get_start()),\n",
        "        )\n",
        "        self.play(x_tracker.animate.set_value(-0.5), run_time=2)\n",
        "        self.play(x_tracker.animate.set_value(0.7), run_time=2)\n",
        "        self.wait()\n",
        "\n",
        "        # Plug in 0\n",
        "        f0 = Tex(\"f(0) = 1\", tex_to_color_map={\"0\": BLUE})\n",
        "        f0[-1].set_opacity(0)\n",
        "        f0.next_to(expanded, DOWN, LARGE_BUFF, aligned_edge=LEFT)\n",
        "\n",
        "        c0_rhs = Tex(\"= c_0\")\n",
        "        c0_rhs.next_to(f0, RIGHT)\n",
        "        c0_rhs.shift(0.05 * DOWN)\n",
        "\n",
        "        self.play(FadeTransform(lhs.copy(), f0))\n",
        "        self.play(x_tracker.animate.set_value(0))\n",
        "        self.wait(note=\"Move box out of the way\")\n",
        "        f0.set_opacity(1)\n",
        "        self.play(Write(f0[-1]))\n",
        "        self.add(f0)\n",
        "        self.wait()\n",
        "        self.play(Write(c0_rhs))\n",
        "        f0.add(c0_rhs)\n",
        "\n",
        "        # Take derivative at 0\n",
        "        dkw = dict(tex_to_color_map={\"0\": BLUE})\n",
        "        f_prime_0 = Tex(\"f'(0) = c_1\", **dkw)\n",
        "        f_prime_n = Tex(\"\\\\frac{1}{n!} f^{(n)}(0) = c_n\", **dkw)\n",
        "        f_prime_0.next_to(f0, RIGHT, buff=1.5)\n",
        "        f_prime_n.next_to(f_prime_0, DOWN, MED_LARGE_BUFF, LEFT)\n",
        "\n",
        "        tan_line = plane.get_graph(lambda x: x + 1)\n",
        "        tan_line.set_stroke(PINK, 2, 0.8)\n",
        "\n",
        "        self.play(FadeTransform(f0.copy(), f_prime_0))\n",
        "        self.add(tan_line, dot)\n",
        "        self.play(ShowCreation(tan_line))\n",
        "        self.wait(note=\"Comment on derivative\")\n",
        "\n",
        "        self.play(FadeTransform(f_prime_0.copy(), f_prime_n))\n",
        "        self.wait(note=\"Comment on this being a nightmare\")\n",
        "\n",
        "        crosses = VGroup(*map(Cross, (f_prime_0, f_prime_n)))\n",
        "        crosses.insert_n_curves(20)\n",
        "        self.play(ShowCreation(crosses))\n",
        "        self.wait()\n",
        "        self.play(LaggedStartMap(FadeOut, VGroup(f_prime_0, f_prime_n, *crosses)))\n",
        "\n",
        "        # Plug in 1\n",
        "        f1 = Tex(\n",
        "            \"f({1}) \\\\,=\\\\, 2^{2{,}000} \\\\,=\\\\, c_0 + c_1 + c_2 + c_3 + \\\\cdots + c_N\",\n",
        "            tex_to_color_map={\n",
        "                \"2^{2{,}000}\": TEAL,\n",
        "                \"{1}\": BLUE,\n",
        "                \"=\": WHITE,\n",
        "            }\n",
        "        )\n",
        "        f1.move_to(f0, LEFT)\n",
        "        self.play(\n",
        "            TransformFromCopy(factored[:5], f1[:5]),\n",
        "            f0.animate.shift(2 * DOWN),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Write(f1[5:11]),\n",
        "            x_tracker.animate.set_value(1)\n",
        "        )\n",
        "        self.wait(note=\"Comment on factored form\")\n",
        "        self.play(Write(f1[11:]))\n",
        "        self.add(f1)\n",
        "\n",
        "        # Plug in -1\n",
        "        fm1 = self.load_mobject(\"f_of_neg1.mob\")\n",
        "        # fm1 = Tex(\n",
        "        #     \"f({-1}) \\\\,=\\\\, {0} \\\\,=\\\\,\"\n",
        "        #     \"c_0 - c_1 + c_2 - c_3 + \\\\cdots + c_N\",\n",
        "        #     tex_to_color_map={\n",
        "        #         \"{-1}\": RED,\n",
        "        #         \"{0}\": TEAL,\n",
        "        #         \"=\": WHITE,\n",
        "        #     }\n",
        "        # )\n",
        "        fm1.next_to(f1, DOWN, LARGE_BUFF, LEFT)\n",
        "\n",
        "        self.play(\n",
        "            TransformMatchingShapes(f1[:5].copy(), fm1[:5]),\n",
        "            FadeOut(f0, DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Write(fm1[5:7]),\n",
        "            ApplyMethod(x_tracker.set_value, -1, run_time=3)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(fm1[7:]))\n",
        "        self.wait()\n",
        "\n",
        "        # Show filtration expression\n",
        "        f1_group = VGroup(f1, fm1)\n",
        "        self.play(\n",
        "            FadeOut(expanded),\n",
        "            FadeOut(box),\n",
        "            f1_group.animate.move_to(expanded, UL),\n",
        "        )\n",
        "\n",
        "        h_line = Line(LEFT, RIGHT).match_width(f1_group)\n",
        "        h_line.set_stroke(GREY_B, 3)\n",
        "        h_line.next_to(f1_group, DOWN, MED_LARGE_BUFF)\n",
        "        h_line.stretch(1.05, 0, about_edge=LEFT)\n",
        "\n",
        "        filter_expr = Tex(\n",
        "            \"{1 \\\\over 2} \\\\Big(f({1}) + f({-1})\\\\Big)\"\n",
        "            \"= c_0 + c_2 + c_4 + \\\\cdots + c_{N}\",\n",
        "            tex_to_color_map={\n",
        "                \"{1}\": BLUE,\n",
        "                \"{-1}\": RED,\n",
        "            }\n",
        "        )\n",
        "        filter_expr.next_to(h_line, DOWN, MED_LARGE_BUFF)\n",
        "        filter_expr.align_to(f1_group, LEFT)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(h_line),\n",
        "            TransformFromCopy(f1[:4], filter_expr[4:8]),\n",
        "            TransformFromCopy(fm1[:4], filter_expr[9:14]),\n",
        "            Write(filter_expr[:4]),\n",
        "            Write(filter_expr[8]),\n",
        "            Write(filter_expr[14:16]),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(filter_expr[16:]))\n",
        "        self.wait()\n",
        "\n",
        "        # Clarify goal\n",
        "        parens = Tex(\"()\")\n",
        "        words = OldTexText(\"Some clever\\\\\\\\evaluation of $f$\", font_size=36)\n",
        "        words.set_color(WHITE)\n",
        "        parens.match_height(words)\n",
        "        parens[0].next_to(words, LEFT, buff=SMALL_BUFF)\n",
        "        parens[1].next_to(words, RIGHT, buff=SMALL_BUFF)\n",
        "        desire = VGroup(\n",
        "            VGroup(parens, words),\n",
        "            Tex(\"= c_0 + c_5 + c_{10} + \\\\cdots + c_{N}\")\n",
        "        )\n",
        "        desire.arrange(RIGHT)\n",
        "        desire.next_to(expanded, DOWN, 1.0, LEFT)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(expanded),\n",
        "            FadeOut(f1_group, DOWN),\n",
        "            Uncreate(h_line),\n",
        "            filter_expr.animate.to_edge(DOWN),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeIn(desire, DOWN),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Show random values of f\n",
        "        self.play(\n",
        "            x_tracker.animate.set_value(0.5),\n",
        "            FadeOut(tan_line),\n",
        "        )\n",
        "        self.wait(0.5)\n",
        "        for n in range(8):\n",
        "            self.play(\n",
        "                x_tracker.animate.set_value(random.uniform(-1, 1)),\n",
        "                run_time=0.5,\n",
        "            )\n",
        "            self.wait(0.5)\n",
        "        self.play(FadeOut(dot), FadeOut(line))\n",
        "\n",
        "        # Indicator on x^n\n",
        "        new_rhs = expanded[1]\n",
        "        rect = SurroundingRectangle(new_rhs.get_part_by_tex(\"x^n\"), buff=0.05)\n",
        "        rect.set_stroke(BLUE_B, 2)\n",
        "        rect.round_corners()\n",
        "\n",
        "        outcomes = VGroup(\n",
        "            OldTexText(\"$1$ if $\\\\; 5 \\\\mid n$\", font_size=36, color=GREEN),\n",
        "            OldTexText(\"$0$ if $\\\\; 5 \\\\nmid n$\", font_size=36, color=RED_D),\n",
        "        )\n",
        "        outcomes.arrange(DOWN, buff=0.75, aligned_edge=LEFT)\n",
        "        outcomes.next_to(new_rhs, RIGHT, 1.5, UP)\n",
        "        arrows = VGroup(*(\n",
        "            Arrow(\n",
        "                rect.get_right(), outcome.get_left(),\n",
        "                buff=0.25,\n",
        "                color=outcome.get_color(),\n",
        "                stroke_width=2.0\n",
        "            )\n",
        "            for outcome in outcomes\n",
        "        ))\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(rect),\n",
        "            FadeOut(expanded[2]),\n",
        "        )\n",
        "        self.wait(0.25)\n",
        "        for arrow, outcome in zip(arrows, outcomes):\n",
        "            self.play(\n",
        "                ShowCreation(arrow),\n",
        "                GrowFromPoint(outcome, rect.get_right())\n",
        "            )\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class MotivateRootsOfUnity(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add generating function\n",
        "        pieces = [\"f(x)\", \"=\"]\n",
        "        n_range = list(range(0, 7))\n",
        "        for n in n_range:\n",
        "            pieces.extend([f\"c_{{{n}}}\", f\"x^{{{n}}}\", \"+\"])\n",
        "        pieces.extend([\"\\\\cdots\"])\n",
        "        polynomial = OldTex(\"\".join(pieces), isolate=pieces)\n",
        "        polynomial.to_edge(UP)\n",
        "\n",
        "        exp_parts = VGroup(*(\n",
        "            polynomial.get_part_by_tex(f\"x^{{{n}}}\")\n",
        "            for n in n_range\n",
        "        ))\n",
        "\n",
        "        self.add(polynomial)\n",
        "\n",
        "        # Add f(-1)\n",
        "        m1_pieces = [\n",
        "            p.replace(\"(x)\", \"x\").replace(\"x\", \"\\\\left(-1\\\\right)\")\n",
        "            for p in pieces\n",
        "        ]\n",
        "        fm1 = OldTex(\"\".join(m1_pieces), isolate=pieces)\n",
        "        fm1.set_color_by_tex(\"-1\", GREY_B)\n",
        "        fm1[0].set_color(WHITE)\n",
        "        fm1[0][2:4].set_color(GREY_B)\n",
        "        fm1.next_to(polynomial, DOWN, MED_LARGE_BUFF)\n",
        "        fm1.set_width(polynomial.get_width() + 1.0)\n",
        "        fm1_powers = fm1[3::3]\n",
        "        # fm1_coefs = fm1[2::3]\n",
        "\n",
        "        short_fm1 = Tex(\n",
        "            \"f({-1}) = c_0 - c_1 + c_2 - c_3 + c_4 - c_5 + c_6 - c_7 + c_8 - \\\\cdots\",\n",
        "            tex_to_color_map={\"{-1}\": GREY_B}\n",
        "        )\n",
        "        short_fm1.scale(fm1[0].get_height() / short_fm1[:5].get_height())\n",
        "        short_fm1.next_to(fm1, DOWN, MED_LARGE_BUFF, aligned_edge=LEFT)\n",
        "\n",
        "        # Real number line\n",
        "        line = NumberLine((-4, 4), unit_size=2)\n",
        "        line.move_to(2 * DOWN)\n",
        "        line.add_numbers()\n",
        "\n",
        "        morty = Mortimer(height=1.5)\n",
        "        morty.next_to(line, UP, SMALL_BUFF).to_edge(RIGHT, buff=1.5)\n",
        "\n",
        "        self.play(\n",
        "            Transform(polynomial.copy(), fm1, lag_ratio=0.01, run_time=2, remover=True),\n",
        "            Write(line),\n",
        "            PiCreatureSays(\n",
        "                morty, OldTexText(\"Visualize the\\\\\\\\rotations\", font_size=36),\n",
        "                bubble_config=dict(width=3, height=2)\n",
        "            ),\n",
        "        )\n",
        "        self.add(fm1)\n",
        "        self.play(Blink(morty))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            morty.change(\"pondering\", fm1).shift(UP),\n",
        "            line.animate.shift(UP),\n",
        "            FadeOut(VGroup(morty.bubble, morty.bubble.content), 0.5 * UP),\n",
        "        )\n",
        "\n",
        "        # Show oscillation\n",
        "        v1 = Arrow(line.n2p(0), line.n2p(1), buff=0, color=BLUE)\n",
        "        vm1 = Arrow(line.n2p(0), line.n2p(-1), buff=0, color=RED)\n",
        "        vect = v1.copy()\n",
        "        neg1_powers = [\n",
        "            Tex(f\"(-1)^{{{n}}}\")\n",
        "            for n in range(8)\n",
        "        ]\n",
        "        for n, neg1_power in enumerate(neg1_powers):\n",
        "            v = [v1, vm1][n % 2]\n",
        "            neg1_power.next_to(v, UP)\n",
        "\n",
        "        power = neg1_powers[0].copy()\n",
        "\n",
        "        for n in range(7):\n",
        "            self.play(\n",
        "                FlashAround(fm1_powers[n]),\n",
        "                fm1_powers[n].animate.set_color([BLUE, RED][n % 2])\n",
        "            )\n",
        "            if n == 0:\n",
        "                self.play(\n",
        "                    FadeTransform(fm1_powers[n].copy(), vect),\n",
        "                    FadeTransform(fm1_powers[n].copy(), power),\n",
        "                    morty.change(\"surprised\").shift(2 * RIGHT).set_opacity(0),\n",
        "                )\n",
        "                self.remove(morty)\n",
        "            else:\n",
        "                self.play(\n",
        "                    Transform(vect, [v1, vm1][n % 2], path_arc=PI),\n",
        "                    Transform(power, neg1_powers[n], path_arc=PI / 2),\n",
        "                )\n",
        "            self.wait()\n",
        "        self.play(\n",
        "            Write(fm1[-2:]),\n",
        "            FadeOut(power),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeIn(short_fm1, lag_ratio=0.5, run_time=2))\n",
        "        self.wait()\n",
        "\n",
        "        # Bring in complex plane\n",
        "        plane_unit = 1.75\n",
        "        plane = ComplexPlane(\n",
        "            (-3, 3), (-2, 2),\n",
        "            axis_config=dict(unit_size=plane_unit)\n",
        "        )\n",
        "        plane.move_to(line.n2p(0) - plane.n2p(0))\n",
        "        plane.add_coordinate_labels(font_size=24)\n",
        "\n",
        "        plane_label = Text(\"Complex plane\", font_size=36)\n",
        "        plane_label.set_backstroke()\n",
        "        plane_label.next_to(plane.get_corner(UL), DR, SMALL_BUFF)\n",
        "\n",
        "        self.add(plane, polynomial, vect)\n",
        "        sf = plane_unit / line.get_unit_size()\n",
        "        self.play(\n",
        "            Write(plane, lag_ratio=0.01),\n",
        "            FadeOut(fm1),\n",
        "            FadeOut(short_fm1),\n",
        "            line.animate.scale(sf).set_opacity(0),\n",
        "            vect.animate.set_color(YELLOW).scale(sf, about_edge=LEFT),\n",
        "        )\n",
        "        self.remove(line)\n",
        "        self.play(Write(plane_label))\n",
        "        self.wait()\n",
        "\n",
        "        # Preview roots of unity\n",
        "        unit_circle = Circle(radius=plane_unit)\n",
        "        unit_circle.move_to(plane.n2p(0))\n",
        "        unit_circle.set_stroke(GREY, 2)\n",
        "\n",
        "        points = [\n",
        "            plane.n2p(np.exp(complex(0, angle)))\n",
        "            for angle in np.arange(0, TAU, TAU / 5)\n",
        "        ]\n",
        "        dots = GlowDots(points)\n",
        "\n",
        "        pentagon = Polygon(*points)\n",
        "        pentagon.set_stroke(TEAL, 1)\n",
        "        pentagon.set_fill(TEAL, 0.25)\n",
        "        pentagon.save_state()\n",
        "        pentagon.set_opacity(0)\n",
        "\n",
        "        self.add(pentagon, unit_circle, vect, dots)\n",
        "        self.play(\n",
        "            ShowCreation(unit_circle),\n",
        "            ShowCreation(dots)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(pentagon.animate.restore())\n",
        "        self.wait()\n",
        "\n",
        "        last_rect = VMobject()\n",
        "        for n in range(14):\n",
        "            if n == 0:\n",
        "                continue\n",
        "            if n < len(exp_parts):\n",
        "                exp_part = exp_parts[n]\n",
        "            else:\n",
        "                exp_part = polynomial[-3:]\n",
        "            rect = SurroundingRectangle(exp_part, buff=0.05)\n",
        "            rect.round_corners()\n",
        "            rect.set_stroke(YELLOW, 2)\n",
        "            self.play(\n",
        "                FadeOut(last_rect),\n",
        "                ShowCreation(rect),\n",
        "                ApplyMethod(\n",
        "                    vect.put_start_and_end_on,\n",
        "                    plane.n2p(0), points[n % 5],\n",
        "                    path_arc=TAU / 5,\n",
        "                )\n",
        "            )\n",
        "            last_rect = rect\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class FifthRootsOfUnity(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Setup plane\n",
        "        plane = ComplexPlane((-2, 2), (-2, 2))\n",
        "        plane.set_height(FRAME_HEIGHT - 0.5)\n",
        "        plane.add_coordinate_labels(font_size=24)\n",
        "        for coord in plane.coordinate_labels:\n",
        "            coord.shift_onto_screen(buff=SMALL_BUFF)\n",
        "            coord.set_fill(WHITE)\n",
        "        plane.to_edge(LEFT, buff=0.1)\n",
        "        self.disable_interaction(plane)\n",
        "\n",
        "        unit_circle = Circle(radius=plane.x_axis.get_unit_size())\n",
        "        unit_circle.move_to(plane.get_origin())\n",
        "        unit_circle.set_stroke(GREY_C, 2)\n",
        "        self.disable_interaction(unit_circle)\n",
        "\n",
        "        complex_plane_title = Text(\"Complex plane\", font_size=42)\n",
        "        complex_plane_title.next_to(plane.get_corner(UL), DR, buff=SMALL_BUFF)\n",
        "        complex_plane_title.set_backstroke(width=8)\n",
        "\n",
        "        self.add(plane)\n",
        "        self.add(unit_circle)\n",
        "        self.add(complex_plane_title)\n",
        "\n",
        "        # Setup roots\n",
        "        roots = [np.exp(complex(0, n * TAU / 5)) for n in range(5)]\n",
        "        root_points = list(map(plane.n2p, roots))\n",
        "        root_dots = Group(*(\n",
        "            GlowDot(point)\n",
        "            for point in root_points\n",
        "        ))\n",
        "        root_lines = VGroup(*(\n",
        "            Arrow(\n",
        "                plane.get_origin(), point, buff=0,\n",
        "                stroke_width=2,\n",
        "                stroke_color=YELLOW,\n",
        "                stroke_opacity=0.7\n",
        "            )\n",
        "            for point in root_points\n",
        "        ))\n",
        "        self.disable_interaction(root_dots)\n",
        "\n",
        "        pentagon = Polygon(*root_points)\n",
        "        pentagon.set_stroke(TEAL, 2)\n",
        "        pentagon.set_fill(TEAL, 0.25)\n",
        "        self.add(pentagon)\n",
        "\n",
        "        # Add function label\n",
        "        function = Tex(\n",
        "            \"f(x) = \\\\sum_{n = 0}^N c_n x^n\",\n",
        "            tex_to_color_map={\"x\": BLUE}\n",
        "        )\n",
        "        function.move_to(midpoint(plane.get_right(), RIGHT_SIDE))\n",
        "        function.to_edge(UP, buff=MED_SMALL_BUFF)\n",
        "        self.add(function)\n",
        "\n",
        "        # Roots of unity\n",
        "        arc = Arc(0, TAU / 5, radius=0.2, arc_center=plane.get_origin())\n",
        "        arc.set_stroke(WHITE, 2)\n",
        "        arc_label = Tex(\"2\\\\pi / 5\", font_size=24)\n",
        "        arc_label.next_to(arc.pfp(0.5), UR, buff=SMALL_BUFF)\n",
        "        arc_label.set_color(GREY_A)\n",
        "\n",
        "        root_kw = dict(\n",
        "            tex_to_color_map={\"\\\\zeta\": YELLOW},\n",
        "            isolate=[\"\\\\cos(72^\\\\circ)\", \"\\\\sin(72^\\\\circ)\"],\n",
        "            font_size=36,\n",
        "        )\n",
        "        zeta_labels = VGroup(\n",
        "            Tex(\"\\\\zeta^0 = 1\", **root_kw),\n",
        "            Tex(\"\\\\zeta\", **root_kw),\n",
        "            Tex(\"\\\\zeta^2\", **root_kw),\n",
        "            Tex(\"\\\\zeta^3\", **root_kw),\n",
        "            Tex(\"\\\\zeta^4\", **root_kw),\n",
        "        )\n",
        "        zeta_labels.set_backstroke(width=4)\n",
        "        for point, label in zip(root_points, zeta_labels):\n",
        "            vect = normalize(point - plane.get_origin())\n",
        "            if point is root_points[0]:\n",
        "                vect = UR\n",
        "            label.next_to(point, vect, buff=SMALL_BUFF)\n",
        "        exp_rhs = Tex(\" = e^{2\\\\pi i / 5}\", **root_kw)\n",
        "        trig_rhs = Tex(\"= \\\\cos(72^\\\\circ) + i\\\\cdot \\\\sin(72^\\\\circ)\", **root_kw)\n",
        "        last = zeta_labels[1]\n",
        "        for rhs in exp_rhs, trig_rhs:\n",
        "            rhs.set_backstroke(width=4)\n",
        "            rhs.next_to(last, RIGHT, SMALL_BUFF)\n",
        "            last = rhs\n",
        "        exp_rhs.shift((trig_rhs[0].get_y() - exp_rhs[0].get_y()) * UP)\n",
        "\n",
        "        self.play(\n",
        "            FadeInFromPoint(\n",
        "                root_dots[1], plane.n2p(1),\n",
        "                path_arc=TAU / 5,\n",
        "            ),\n",
        "            pentagon.animate.set_fill(opacity=0.1)\n",
        "        )\n",
        "        self.play(Write(zeta_labels[1]))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            ShowCreation(arc), Write(arc_label),\n",
        "            TransformFromCopy(root_lines[0], root_lines[1], path_arc=-TAU / 5)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(exp_rhs))\n",
        "        self.wait()\n",
        "\n",
        "        # Show trig\n",
        "        x_line = Line(plane.n2p(0), plane.n2p(math.cos(TAU / 5)))\n",
        "        y_line = Line(plane.n2p(math.cos(TAU / 5)), plane.n2p(np.exp(complex(0, TAU / 5))))\n",
        "        x_line.set_stroke(RED, 2)\n",
        "        y_line.set_stroke(PINK, 2)\n",
        "        low_cos = Tex(\"\\\\cos(72^\\\\circ)\", font_size=24)\n",
        "        low_sin = Tex(\"\\\\sin(72^\\\\circ)\", font_size=24)\n",
        "        low_cos.next_to(x_line, DOWN, SMALL_BUFF, aligned_edge=LEFT)\n",
        "        low_cos.shift(SMALL_BUFF * RIGHT)\n",
        "        low_sin.next_to(y_line, RIGHT, SMALL_BUFF)\n",
        "        VGroup(low_cos, low_sin).set_backstroke(BLACK)\n",
        "\n",
        "        self.play(Write(trig_rhs))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformFromCopy(trig_rhs.select_part(\"\\\\cos(72^\\\\circ)\"), low_cos),\n",
        "            ShowCreation(x_line),\n",
        "            FadeOut(arc_label)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformFromCopy(trig_rhs.select_part(\"\\\\sin(72^\\\\circ)\"), low_sin),\n",
        "            ShowCreation(y_line),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        self.play(LaggedStartMap(FadeOut, VGroup(\n",
        "            trig_rhs, x_line, low_cos, y_line, low_sin\n",
        "        )))\n",
        "\n",
        "        # Show all roots of unity\n",
        "        for i in range(2, 6):\n",
        "            self.play(*(\n",
        "                TransformFromCopy(group[i - 1], group[i % 5], path_arc=-TAU / 5)\n",
        "                for group in [root_lines, root_dots, zeta_labels]\n",
        "            ))\n",
        "            self.wait()\n",
        "\n",
        "        # Name the roots of unity\n",
        "        title = OldTexText(\"``Fifth roots of unity''\")\n",
        "        title.set_color(YELLOW)\n",
        "        title.match_y(plane)\n",
        "        title.match_x(function)\n",
        "        equation = OldTex(\"z^5 = 1\")\n",
        "        equation.set_color(WHITE)\n",
        "        equation.next_to(title, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            Write(title),\n",
        "            LaggedStart(*(\n",
        "                FlashAround(zl, time_width=1.5)\n",
        "                for zl in zeta_labels\n",
        "            ), lag_ratio=0.1, run_time=3)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeIn(equation, 0.5 * DOWN))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStartMap(FadeOut, VGroup(title, equation), shift=DOWN),\n",
        "            FadeOut(VGroup(arc, arc_label)),\n",
        "        )\n",
        "\n",
        "        # Key expression\n",
        "        expr = Tex(\"+\".join([f\"f(\\\\zeta^{{{n}}})\" for n in range(5)]), **root_kw)\n",
        "        expr.next_to(function, DOWN, LARGE_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            TransformMatchingShapes(function[:4].copy(), expr, run_time=1.5),\n",
        "            FadeOut(pentagon),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Examples, f(x) = x, f(x) = x^2, etc.\n",
        "        ex_kw = dict(tex_to_color_map={\"{x}\": BLUE}, font_size=36)\n",
        "        example_texts = [\n",
        "            Tex(\n",
        "                \"\\\\text{Example: } f({x}) = {x}\" + (\"^\" + str(n) if n > 1 else \"\"),\n",
        "                **ex_kw\n",
        "            )\n",
        "            for n in range(1, 6)\n",
        "        ]\n",
        "        example_sums = [\n",
        "            Tex(\n",
        "                \"+\".join([f\"\\\\zeta^{{{k * n}}}\" for n in range(5)]) + (\"=5\" if k == 5 else \"=0\"),\n",
        "                **root_kw\n",
        "            )\n",
        "            for k in range(1, 6)\n",
        "        ]\n",
        "\n",
        "        def update_root_lines(rl):\n",
        "            for line, dot in zip(rl, root_dots):\n",
        "                line.put_start_and_end_on(plane.get_center(), dot.get_center())\n",
        "            return rl\n",
        "\n",
        "        root_lines.add_updater(update_root_lines)\n",
        "\n",
        "        for k, ex_text, ex_sum in zip(it.count(1), example_texts, example_sums):\n",
        "            ex_text.next_to(expr, DOWN, LARGE_BUFF)\n",
        "            ex_sum.next_to(ex_text, DOWN, LARGE_BUFF)\n",
        "\n",
        "            if k == 1:\n",
        "                self.play(Write(ex_text))\n",
        "                self.wait()\n",
        "                self.play(FadeTransform(expr.copy(), ex_sum))\n",
        "                root_lines.save_state()\n",
        "                self.wait(note=\"Move root vectors tip to tail (next animation they restore)\")\n",
        "                self.play(root_lines.animate.restore())\n",
        "                self.wait()\n",
        "            else:\n",
        "                self.play(\n",
        "                    FadeOut(example_texts[k - 2], 0.5 * UP),\n",
        "                    FadeIn(ex_text, 0.5 * UP),\n",
        "                    FadeOut(example_sums[k - 2])\n",
        "                )\n",
        "                self.wait()\n",
        "                self.play(FadeTransform(expr.copy(), ex_sum))\n",
        "                self.wait()\n",
        "                # Show permutation\n",
        "                arrows = VGroup(*(\n",
        "                    Arrow(root_dots[n], root_dots[(k * n) % 5], buff=0, stroke_width=3)\n",
        "                    for n in range(1, 5)\n",
        "                ))\n",
        "                arrows.set_opacity(0.8)\n",
        "                for arrow in arrows:\n",
        "                    self.play(ShowCreation(arrow))\n",
        "                    self.wait()\n",
        "                self.play(FadeOut(arrows))\n",
        "                # Animate kth power\n",
        "                self.animate_kth_power(\n",
        "                    plane,\n",
        "                    root_dots, k,\n",
        "                )\n",
        "                self.wait()\n",
        "\n",
        "        # Emphasize the upshot\n",
        "        example = VGroup(example_texts[-1], example_sums[-1])\n",
        "        example.generate_target()\n",
        "        example.target.arrange(DOWN)\n",
        "        example.target.match_x(expr)\n",
        "        example.target.to_edge(DOWN)\n",
        "        brace = Brace(expr, DOWN, color=GREY_B)\n",
        "\n",
        "        func_kw = dict(tex_to_color_map={\"x\": BLUE})\n",
        "        relations = VGroup(\n",
        "            Tex(\"x^n \\\\rightarrow 0 \\\\qquad \\\\text{ if } 5 \\\\nmid n\", **func_kw),\n",
        "            Tex(\"x^n \\\\rightarrow 5 \\\\qquad \\\\text{ if } 5 \\\\mid n\", **func_kw),\n",
        "        )\n",
        "        relations.arrange(DOWN)\n",
        "        relations.next_to(brace, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            GrowFromCenter(brace),\n",
        "            MoveToTarget(example)\n",
        "        )\n",
        "        for relation in relations:\n",
        "            self.play(Write(relation))\n",
        "            self.wait()\n",
        "\n",
        "        # Write answer expression\n",
        "        relation_group = VGroup(expr, brace, relations)\n",
        "\n",
        "        answer = Tex(\n",
        "            \"c_0 + c_5 + c_{10} + \\\\cdots\"\n",
        "            \"=\\\\frac{1}{5}\\\\sum_{k = 0}^4 f(\\\\zeta^k)\",\n",
        "            tex_to_color_map={\"\\\\zeta\": YELLOW}\n",
        "        )\n",
        "        answer.set_width(5)\n",
        "        answer.next_to(function, DOWN, LARGE_BUFF)\n",
        "        answer_rect = SurroundingRectangle(answer, buff=0.2)\n",
        "        answer_rect.round_corners()\n",
        "        answer_rect.set_stroke(YELLOW, 2)\n",
        "        self.disable_interaction(answer_rect)\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(example, DOWN),\n",
        "            relation_group.animate.set_width(4.5).to_edge(DOWN),\n",
        "            Write(answer)\n",
        "        )\n",
        "        self.play(\n",
        "            VShowPassingFlash(answer_rect.copy()),\n",
        "            FadeIn(answer_rect)\n",
        "        )\n",
        "        self.add(answer_rect, answer)\n",
        "        self.wait()\n",
        "\n",
        "        # Bring back original definition\n",
        "        factored = Tex(\n",
        "            \"f(x) = (1 + x)(1 + x^2)(1 + x^3)(1 + x^4)(1 + x^5)\\\\cdots\\\\left(1 + x^{2{,}000}\\\\right)\",\n",
        "            **func_kw\n",
        "        )\n",
        "        factored.to_edge(UP)\n",
        "\n",
        "        lower_group = VGroup(\n",
        "            VGroup(answer_rect, answer),\n",
        "            relation_group,\n",
        "        )\n",
        "        lower_group.generate_target()\n",
        "        lower_group.target.arrange(RIGHT, buff=MED_LARGE_BUFF)\n",
        "        lower_group.target.set_width(8.5)\n",
        "        lower_group.target.to_corner(DR)\n",
        "\n",
        "        plane_group = Group(\n",
        "            plane, unit_circle,\n",
        "            root_lines, root_dots, zeta_labels, exp_rhs,\n",
        "            complex_plane_title\n",
        "        )\n",
        "        plane_group.generate_target()\n",
        "        plane_group.target.set_height(4.5, about_edge=DL)\n",
        "\n",
        "        self.play(\n",
        "            Write(factored),\n",
        "            function.animate.next_to(factored, DOWN, buff=0.4, aligned_edge=LEFT),\n",
        "            MoveToTarget(lower_group),\n",
        "            MoveToTarget(plane_group),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Evaluate f at zeta\n",
        "        eq_kw = dict(\n",
        "            tex_to_color_map={\"\\\\zeta\": YELLOW, \"{z}\": GREY_A},\n",
        "        )\n",
        "        f_zeta = Tex(\n",
        "            \"f(\\\\zeta) = \\\\Big(\"\n",
        "            \"(1+\\\\zeta)(1+\\\\zeta^{2})(1+\\\\zeta^{3})(1+\\\\zeta^{4})(1+\\\\zeta^{5})\"\n",
        "            \"\\\\Big)^{400}\",\n",
        "            **eq_kw\n",
        "        )\n",
        "        f_zeta.next_to(factored, DOWN, aligned_edge=LEFT)\n",
        "\n",
        "        expr_copy = expr.copy()\n",
        "        expr_copy.generate_target()\n",
        "        expr_copy.target.scale(2).next_to(plane, RIGHT, LARGE_BUFF, UP)\n",
        "        fz1 = expr_copy.target[6:11]\n",
        "        fz1_rect = SurroundingRectangle(fz1, buff=SMALL_BUFF).round_corners()\n",
        "        fz1_rect.set_stroke(TEAL, 2)\n",
        "\n",
        "        want_label = Text(\"What we want\")\n",
        "        want_label.next_to(expr_copy.target, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(LaggedStart(MoveToTarget(expr_copy), Write(want_label)))\n",
        "        self.wait()\n",
        "        self.play(ShowCreation(fz1_rect))\n",
        "        self.play(\n",
        "            TransformFromCopy(fz1, f_zeta[:5]),\n",
        "            FadeOut(function, DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(*map(FadeOut, [expr_copy, fz1_rect, want_label]))\n",
        "        for i, n in zip([5, 10, 16, 22, 28], it.chain([5], it.cycle([6]))):\n",
        "            self.play(TransformFromCopy(factored[i:i + n], f_zeta[i + 1:i + n + 1]))\n",
        "        self.wait()\n",
        "        self.play(Write(f_zeta[5]), Write(f_zeta[35:]))\n",
        "        self.wait(note=\"Shift zeta values on next move\")\n",
        "\n",
        "        # Visualize roots moving\n",
        "        shift_vect = plane.n2p(1) - plane.n2p(0)\n",
        "        zp1_labels = VGroup(*(\n",
        "            Tex(f\"\\\\zeta^{{{n}}} + 1\", **root_kw)\n",
        "            for n in range(5)\n",
        "        ))\n",
        "        zp1_labels.match_height(zeta_labels[0])\n",
        "        for zp1_label, z_label in zip(zp1_labels, zeta_labels):\n",
        "            zp1_label.set_backstroke(width=5)\n",
        "            zp1_label.move_to(z_label, DL)\n",
        "            zp1_label.shift(shift_vect)\n",
        "        zp1_labels[0].next_to(root_dots[0].get_center() + shift_vect, UL, SMALL_BUFF)\n",
        "\n",
        "        new_circle = unit_circle.copy()\n",
        "        new_circle.set_stroke(GREY_B, opacity=0.5)\n",
        "        self.disable_interaction(new_circle)\n",
        "        self.replace(unit_circle, unit_circle, new_circle)\n",
        "\n",
        "        self.remove(zeta_labels)\n",
        "        self.play(\n",
        "            root_dots.animate.shift(shift_vect),\n",
        "            new_circle.animate.shift(shift_vect),\n",
        "            TransformFromCopy(zeta_labels, zp1_labels),\n",
        "            FadeOut(exp_rhs),\n",
        "            run_time=2,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Estimate answer\n",
        "        faders = VGroup(lower_group, f_zeta[:6], f_zeta[-4:], factored)\n",
        "        faders.save_state()\n",
        "\n",
        "        estimate = Tex(\n",
        "            \"= 2 \\\\cdot L_1^2 \\\\cdot L_2^2\",\n",
        "            isolate=[\"= 2\", \"\\\\cdot L_1^2\", \"\\\\cdot L_2^2\"],\n",
        "            **eq_kw\n",
        "        )\n",
        "        roughly_two = Tex(\"\\\\approx 2\")\n",
        "        estimate.next_to(plane, RIGHT, buff=1.5, aligned_edge=UP)\n",
        "        roughly_two.next_to(estimate, DOWN, MED_LARGE_BUFF, LEFT)\n",
        "\n",
        "        L1_label = Tex(\"L_1\", font_size=24)\n",
        "        L2_label = Tex(\"L_2\", font_size=24)\n",
        "        L1_label.next_to(root_lines[1].pfp(0.75), DR, buff=0.05)\n",
        "        L2_label.next_to(root_lines[2].get_center(), LEFT, SMALL_BUFF)\n",
        "        VGroup(L1_label, L2_label).set_backstroke()\n",
        "\n",
        "        root_groups = Group(*(\n",
        "            Group(*parts)\n",
        "            for parts in zip(root_dots, root_lines, zp1_labels)\n",
        "        ))\n",
        "\n",
        "        self.wait()\n",
        "        self.play(faders.animate.fade(0.75))\n",
        "        self.remove(faders)\n",
        "        self.add(*faders)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            root_groups[1:].animate.set_opacity(0.1),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(estimate.select_part(\"= 2\")))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            root_groups[0].animate.set_opacity(0.1),\n",
        "            root_groups[1:5:3].animate.set_opacity(1),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(L1_label))\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(L1_label.copy(), estimate.select_part(\"\\\\cdot L_1^2\")))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            root_groups[1:5:3].animate.set_opacity(0.1),\n",
        "            root_groups[2:4].animate.set_opacity(1),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(L2_label))\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(L2_label.copy(), estimate.select_part(\"\\\\cdot L_2^2\")))\n",
        "        self.wait()\n",
        "        self.play(root_groups.animate.set_opacity(1))\n",
        "        self.wait()\n",
        "        self.play(Write(roughly_two))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(estimate),\n",
        "            FadeOut(roughly_two),\n",
        "            faders.animate.restore(),\n",
        "        )\n",
        "\n",
        "        # Setup for the trick\n",
        "        box = Rectangle(\n",
        "            height=plane.get_height(),\n",
        "            width=abs(plane.get_right()[0] - RIGHT_SIDE[0]) - 1,\n",
        "        )\n",
        "        box.set_stroke(WHITE, 1)\n",
        "        box.set_fill(GREY_E, 1)\n",
        "        box.next_to(plane, RIGHT, buff=0.5)\n",
        "        self.disable_interaction(box)\n",
        "        trick_title = Text(\"The trick\")\n",
        "        trick_title.next_to(box.get_top(), DOWN, SMALL_BUFF)\n",
        "\n",
        "        subsets = get_subsets(range(1, 6))\n",
        "        binom_pairs = [\n",
        "            (f_zeta[i], f_zeta[j:k])\n",
        "            for i, j, k in [(7, 9, 10), (12, 14, 16), (18, 20, 22), (24, 26, 28), (30, 32, 34)]\n",
        "        ]\n",
        "        rect_groups = VGroup(*(\n",
        "            VGroup(*(\n",
        "                SurroundingRectangle(bp[int(n + 1 in ss)], buff=SMALL_BUFF).round_corners().set_stroke(TEAL, 2)\n",
        "                for n, bp in enumerate(binom_pairs)\n",
        "            ))\n",
        "            for ss in subsets\n",
        "        ))\n",
        "        terms = VGroup(*(\n",
        "            Tex(f\"\\\\zeta^{{{sum(ss)}}}\")\n",
        "            for ss in subsets\n",
        "        ))\n",
        "        terms.arrange_in_grid(4, 8, buff=MED_LARGE_BUFF)\n",
        "        terms.set_width(7)\n",
        "        terms.next_to(plane, RIGHT, LARGE_BUFF, UP)\n",
        "        for term in terms:\n",
        "            term[0].set_color(YELLOW)\n",
        "            plus = Tex(\"+\", font_size=36)\n",
        "            plus.next_to(term, RIGHT, buff=(0.15 if term in terms[:25] else 0.05))\n",
        "            term.add(plus)\n",
        "        terms[-1].remove(terms[-1][-1])\n",
        "        term_rects = VGroup(*(\n",
        "            SurroundingRectangle(term).round_corners().set_stroke(TEAL, 2)\n",
        "            for term in terms\n",
        "        ))\n",
        "\n",
        "        self.play(FadeOut(lower_group, DOWN))\n",
        "        self.play(\n",
        "            ShowSubmobjectsOneByOne(rect_groups, int_func=np.ceil),\n",
        "            ShowSubmobjectsOneByOne(term_rects, int_func=np.ceil),\n",
        "            ShowIncreasingSubsets(terms, int_func=np.ceil),\n",
        "            run_time=8,\n",
        "            rate_func=linear,\n",
        "        )\n",
        "        self.play(FadeOut(rect_groups[-1]), FadeOut(term_rects[-1]))\n",
        "        self.wait()\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(terms, DOWN),\n",
        "            Write(box),\n",
        "            Write(trick_title),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # The trick\n",
        "        root_kw[\"tex_to_color_map\"][\"{z}\"] = GREY_A\n",
        "        root_kw[\"tex_to_color_map\"][\"{-1}\"] = GREY_A\n",
        "        root_kw[\"tex_to_color_map\"][\"=\"] = WHITE\n",
        "        texs = [\n",
        "            \"{z}^5 - 1 = ({z} - \\\\zeta^0)({z} - \\\\zeta^1)({z} - \\\\zeta^2)({z} - \\\\zeta^3)({z} - \\\\zeta^4)\",\n",
        "            \"({-1})^5 - 1 = ({-1} - \\\\zeta^0)({-1} - \\\\zeta^1)({-1} - \\\\zeta^2)({-1} - \\\\zeta^3)({-1} - \\\\zeta^4)\",\n",
        "            \"2 = (1 + \\\\zeta^0)(1 + \\\\zeta^1)(1 + \\\\zeta^2)(1 + \\\\zeta^3)(1 + \\\\zeta^4)\",\n",
        "        ]\n",
        "        equations = VGroup(*(Tex(tex, **root_kw) for tex in texs))\n",
        "        equations[1].set_width(box.get_width() - 0.5)\n",
        "        equations.arrange(DOWN, buff=0.75)\n",
        "        equals_x = equations[0].get_part_by_tex(\"=\").get_x()\n",
        "        for eq in equations[1:]:\n",
        "            eq.shift((equals_x - eq.get_part_by_tex(\"=\").get_x()) * RIGHT)\n",
        "        equations.next_to(trick_title, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(Write(equations[0]))\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(equations[0].copy(), equations[1]))\n",
        "        self.wait()\n",
        "        self.play(FadeTransform(equations[1].copy(), equations[2]))\n",
        "        self.wait()\n",
        "\n",
        "        # Show value of 2\n",
        "        brace = Brace(f_zeta[6:35], DOWN).set_color(WHITE)\n",
        "        brace.stretch(0.75, 1, about_edge=UP)\n",
        "        two_label = brace.get_tex(\"2\").set_color(WHITE)\n",
        "        self.play(GrowFromCenter(brace))\n",
        "        self.play(TransformFromCopy(equations[2][0], two_label))\n",
        "        self.wait()\n",
        "        self.play(LaggedStartMap(FadeOut, VGroup(box, trick_title, *equations)))\n",
        "        self.play(FadeIn(lower_group))\n",
        "        self.wait()\n",
        "\n",
        "        # Evaluate answer\n",
        "        ans_group, expr_group = lower_group\n",
        "        self.play(\n",
        "            ans_group.animate.scale(0.5, about_edge=UL),\n",
        "            expr_group.animate.scale(1.5, about_edge=DR),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        parts = [expr.get_part_by_tex(f\"f(\\\\zeta^{{{n}}})\") for n in range(5)]\n",
        "        arrows = VGroup(*(\n",
        "            Vector(0.5 * UP).next_to(part, UP, SMALL_BUFF)\n",
        "            for part in parts\n",
        "        ))\n",
        "        values = VGroup(\n",
        "            Tex(\"2^{2{,}000}\", font_size=36),\n",
        "            *(Tex(\"2^{400}\", font_size=36) for x in range(4))\n",
        "        )\n",
        "        for value, arrow in zip(values, arrows):\n",
        "            value.next_to(arrow, UP, SMALL_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(arrows[1]),\n",
        "            FadeIn(values[1], 0.5 * UP)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStartMap(ShowCreation, arrows[2:], lag_ratio=0.5),\n",
        "            LaggedStartMap(FadeIn, values[2:], shift=0.5 * UP, lag_ratio=0.5),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            ShowCreation(arrows[0]),\n",
        "            FadeIn(values[0], 0.5 * UP)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.remove(arrows, values)\n",
        "        expr_group.add(*arrows, *values)\n",
        "\n",
        "        # Rescale answer group\n",
        "        plane_group = Group(\n",
        "            plane, unit_circle, new_circle,\n",
        "            root_lines, root_dots, zp1_labels,\n",
        "            complex_plane_title,\n",
        "        )\n",
        "\n",
        "        ans_group.generate_target()\n",
        "        ans_group.target.set_width(6.5, about_edge=LEFT)\n",
        "        ans_group.target.next_to(brace, DOWN)\n",
        "        ans_group.target.shift(1 * LEFT)\n",
        "        ans_group.target[0].set_stroke(opacity=0)\n",
        "\n",
        "        f_zeta_rhs = OldTex(\"=2^{400}\").set_color(WHITE)\n",
        "        f_zeta_rhs.next_to(f_zeta, RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            MoveToTarget(ans_group),\n",
        "            expr_group.animate.scale(1 / 1.5, about_edge=DR),\n",
        "            plane_group.animate.scale(0.7, about_edge=DL),\n",
        "            TransformMatchingShapes(two_label, f_zeta_rhs),\n",
        "            FadeOut(brace),\n",
        "            run_time=2\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Final answer\n",
        "        final_answer = Tex(\n",
        "            \"= \\\\frac{1}{5}\\\\Big(\"\n",
        "            \"2^{2{,}000} + 4 \\\\cdot 2^{400}\\\\Big)\"\n",
        "        )\n",
        "        final_answer.next_to(answer, RIGHT)\n",
        "\n",
        "        final_answer_rect = SurroundingRectangle(final_answer[1:], buff=0.2)\n",
        "        final_answer_rect.round_corners()\n",
        "        final_answer_rect.set_stroke(YELLOW, 2)\n",
        "        self.disable_interaction(final_answer_rect)\n",
        "\n",
        "        self.play(\n",
        "            Write(final_answer[:5]),\n",
        "            Write(final_answer[-1]),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeTransform(values.copy(), final_answer[5:-1])\n",
        "        )\n",
        "        self.play(ShowCreation(final_answer_rect))\n",
        "        self.wait(note=\"Comment on dominant term\")\n",
        "\n",
        "        # Smaller case\n",
        "        box = Rectangle(\n",
        "            width=(RIGHT_SIDE[0] - plane.get_right()[0]) - 1,\n",
        "            height=plane.get_height()\n",
        "        )\n",
        "        box.to_corner(DR)\n",
        "        box.align_to(plane, DOWN)\n",
        "        box.set_stroke(WHITE, 1)\n",
        "        box.set_fill(GREY_E, 1)\n",
        "        set_tex = get_set_tex(range(1, 6))\n",
        "        set_tex.next_to(box.get_left(), RIGHT, SMALL_BUFF)\n",
        "\n",
        "        rhs = Tex(\n",
        "            \"\\\\rightarrow \\\\frac{1}{5}\"\n",
        "            \"\\\\Big(2^5 + 4 \\\\cdot 2^1\\\\Big)\"\n",
        "            \"= \\\\frac{1}{5}(32 + 8)\"\n",
        "            \"=8\"\n",
        "        )\n",
        "        rhs.scale(0.9)\n",
        "        rhs.next_to(set_tex, RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(expr_group),\n",
        "            Write(box),\n",
        "            Write(set_tex),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            Write(rhs[0]),\n",
        "            FadeTransform(final_answer.copy(), rhs[1:13])\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(rhs[13:]))\n",
        "        self.wait()\n",
        "\n",
        "    def animate_kth_power(self, plane, dots, k):\n",
        "        # Try the rotation\n",
        "        angles = np.angle([plane.p2n(dot.get_center()) for dot in dots])\n",
        "        angles = angles % TAU\n",
        "        paths = [\n",
        "            ParametricCurve(\n",
        "                lambda t: plane.n2p(np.exp(complex(0, interpolate(angle, k * angle, t)))),\n",
        "                t_range=(0, 1, 0.01),\n",
        "            )\n",
        "            for angle in angles\n",
        "        ]\n",
        "        dots.save_state()\n",
        "        # pentagon.add_updater(lambda p: p.set_points_as_corners([\n",
        "        #     d.get_center() for d in [*dots, dots[0]]\n",
        "        # ]))\n",
        "\n",
        "        self.play(*(\n",
        "            MoveAlongPath(dot, path)\n",
        "            for dot, path in zip(dots, paths)\n",
        "        ), run_time=4)\n",
        "        if k == 5:\n",
        "            self.wait()\n",
        "            self.play(dots.animate.restore())\n",
        "        else:\n",
        "            # self.play(FadeOut(pentagon))\n",
        "            dots.restore()\n",
        "            # self.play(FadeInFromDown(pentagon))\n",
        "        # pentagon.clear_updaters()\n",
        "\n",
        "    def get_highlight(self, mobject):\n",
        "        result = super().get_highlight(mobject)\n",
        "        if isinstance(mobject, Arrow):\n",
        "            result.set_stroke(width=result.get_stroke_width())\n",
        "        return result\n",
        "\n",
        "\n",
        "class RepeatingPowersOfUnity(InteractiveScene):\n",
        "    n_steps = 25\n",
        "\n",
        "    def construct(self):\n",
        "        # Setup plane\n",
        "        plane = ComplexPlane((-2, 2), (-2, 2))\n",
        "        plane.set_height(FRAME_HEIGHT - 0.5)\n",
        "        plane.add_coordinate_labels(font_size=24)\n",
        "        for coord in plane.coordinate_labels:\n",
        "            coord.shift_onto_screen(buff=SMALL_BUFF)\n",
        "            coord.set_fill(WHITE)\n",
        "        plane.to_edge(LEFT, buff=0.1)\n",
        "        self.disable_interaction(plane)\n",
        "\n",
        "        unit_circle = Circle(radius=plane.x_axis.get_unit_size())\n",
        "        unit_circle.move_to(plane.get_origin())\n",
        "        unit_circle.set_stroke(GREY_C, 2)\n",
        "        self.disable_interaction(unit_circle)\n",
        "\n",
        "        complex_plane_title = Text(\"Complex plane\", font_size=42)\n",
        "        complex_plane_title.next_to(plane.get_corner(UL), DR, buff=SMALL_BUFF)\n",
        "        complex_plane_title.set_backstroke(width=8)\n",
        "\n",
        "        self.add(plane)\n",
        "        self.add(unit_circle)\n",
        "        self.add(complex_plane_title)\n",
        "\n",
        "        # Setup roots\n",
        "        roots = [np.exp(complex(0, n * TAU / 5)) for n in range(5)]\n",
        "        root_points = list(map(plane.n2p, roots))\n",
        "        root_dots = Group(*(\n",
        "            GlowDot(point)\n",
        "            for point in root_points\n",
        "        ))\n",
        "        root_lines = VGroup(*(\n",
        "            Arrow(\n",
        "                plane.get_origin(), point, buff=0,\n",
        "                stroke_width=2,\n",
        "                stroke_color=YELLOW,\n",
        "                stroke_opacity=0.7\n",
        "            )\n",
        "            for point in root_points\n",
        "        ))\n",
        "        self.disable_interaction(root_dots)\n",
        "\n",
        "        pentagon = Polygon(*root_points)\n",
        "        pentagon.set_stroke(TEAL, 2)\n",
        "        pentagon.set_fill(TEAL, 0.25)\n",
        "        self.add(pentagon)\n",
        "\n",
        "        # Labels\n",
        "        zeta_labels = VGroup()\n",
        "        for n in range(self.n_steps):\n",
        "            label = Tex(\"\\\\zeta^2\")\n",
        "            label[0].set_color(YELLOW)\n",
        "            exp = Integer(n)\n",
        "            exp.match_height(label[1])\n",
        "            exp.move_to(label[1], DL)\n",
        "            label.replace_submobject(1, exp)\n",
        "            point = root_points[n % 5]\n",
        "            vect = normalize(point - plane.get_origin())\n",
        "            if n % 5 == 0:\n",
        "                vect = UR\n",
        "            label.next_to(point, vect, buff=SMALL_BUFF)\n",
        "            zeta_labels.add(label)\n",
        "        zeta_labels.set_backstroke(width=4)\n",
        "\n",
        "        # Animations\n",
        "        line = root_lines[0].copy()\n",
        "        dot = root_dots[0].copy()\n",
        "        label = zeta_labels[0].copy()\n",
        "\n",
        "        self.add(line, dot, label)\n",
        "        self.wait()\n",
        "\n",
        "        for n in range(1, self.n_steps):\n",
        "            self.play(\n",
        "                Transform(line, root_lines[n % 5]),\n",
        "                Transform(dot, root_dots[n % 5]),\n",
        "                Transform(label, zeta_labels[n]),\n",
        "                path_arc=TAU / 5\n",
        "            )\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class JustifyLinearity(InteractiveScene):\n",
        "    n_terms = 8\n",
        "\n",
        "    def construct(self):\n",
        "        # Create polynomials\n",
        "        x_poly = self.get_polynomial(\"{x}\", BLUE)\n",
        "        x_poly.to_edge(UP)\n",
        "\n",
        "        zeta_polys = VGroup(*(\n",
        "            self.get_polynomial(\"\\\\zeta\", YELLOW, exp_multiple=n)\n",
        "            for n in range(5)\n",
        "        ))\n",
        "        zeta_polys.arrange(DOWN, buff=0.65, aligned_edge=LEFT)\n",
        "        zeta_polys.next_to(x_poly, DOWN, LARGE_BUFF)\n",
        "        x_poly.align_to(zeta_polys, LEFT)\n",
        "        polys = VGroup(x_poly, *zeta_polys)\n",
        "\n",
        "        # Align parts\n",
        "        low_poly = polys[-1]\n",
        "        for poly in polys[:-1]:\n",
        "            for i1, i2 in zip(poly.sep_indices, low_poly.sep_indices):\n",
        "                shift = (low_poly[i2].get_x(LEFT) - poly[i1].get_x(LEFT)) * RIGHT\n",
        "                poly[i1].shift(shift / 2)\n",
        "                poly[i1 + 1:].shift(shift)\n",
        "\n",
        "        # Discuss complexity\n",
        "        simple_examples = VGroup(*(\n",
        "            Tex(f\"f(x) = x^{{{n}}}\", tex_to_color_map={\"x\": BLUE}, font_size=36)\n",
        "            for n in range(1, 6)\n",
        "        ))\n",
        "        simple_examples.arrange(DOWN, aligned_edge=LEFT)\n",
        "        simple_examples.move_to(4 * RIGHT + DOWN)\n",
        "        simple_box = SurroundingRectangle(simple_examples, buff=MED_SMALL_BUFF)\n",
        "        simple_box.set_fill(GREY_E, 1)\n",
        "        simple_box.set_stroke(WHITE, 1)\n",
        "        simple_label = Text(\"Simple examples\")\n",
        "        simple_label.next_to(simple_box, UP, SMALL_BUFF)\n",
        "        simple_box.match_width(simple_label, stretch=True)\n",
        "        simple_group = VGroup(simple_box, simple_label, simple_examples)\n",
        "\n",
        "        randy = Randolph(height=2)\n",
        "        randy.align_to(simple_box, DOWN)\n",
        "        randy.to_edge(LEFT)\n",
        "\n",
        "        self.add(simple_group)\n",
        "        self.play(\n",
        "            PiCreatureSays(\n",
        "                randy, OldTexText(\"But $f$ is more\\\\\\\\complicated than that!\", font_size=36),\n",
        "                bubble_config=dict(width=4, height=2),\n",
        "                target_mode=\"pleading\",\n",
        "            )\n",
        "        )\n",
        "        self.play(\n",
        "            Write(x_poly),\n",
        "            randy.change(\"sad\", x_poly),\n",
        "        )\n",
        "        self.play(Blink(randy))\n",
        "        self.wait()\n",
        "\n",
        "        # Prepare for grid sum\n",
        "        lhss = VGroup(*(\n",
        "            poly[:poly.sep_indices[0]]\n",
        "            for poly in zeta_polys\n",
        "        ))\n",
        "        lhss.save_state()\n",
        "        plusses = Tex(\"+\", font_size=36).replicate(len(lhss) - 1)\n",
        "        group = VGroup(*it.chain(*zip(lhss, plusses)))\n",
        "        group.add(lhss[-1])\n",
        "        group.arrange(RIGHT, buff=MED_SMALL_BUFF)\n",
        "        group.next_to(x_poly, DOWN, LARGE_BUFF)\n",
        "\n",
        "        plusses.generate_target()\n",
        "        for plus, lhs1, lhs2 in zip(plusses.target, lhss.saved_state, lhss.saved_state[1:]):\n",
        "            plus.move_to(midpoint(lhs1.get_bottom(), lhs2.get_top()))\n",
        "            plus.scale(0.7)\n",
        "\n",
        "        self.play(\n",
        "            Write(group),\n",
        "            FadeOut(VGroup(randy.bubble, randy.bubble.content)),\n",
        "            simple_group.animate.to_edge(DOWN),\n",
        "        )\n",
        "        self.wait()\n",
        "        for mob in x_poly, group:\n",
        "            self.play(\n",
        "                FlashAround(mob, time_width=2, run_time=2, color=mob[2].get_fill_color()),\n",
        "                randy.change(\"pondering\", mob),\n",
        "            )\n",
        "            self.wait()\n",
        "        self.play(\n",
        "            lhss.animate.restore(),\n",
        "            MoveToTarget(plusses),\n",
        "            FadeOut(randy),\n",
        "            FadeOut(simple_group),\n",
        "            path_arc=-90 * DEGREES,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Write all right hand sides\n",
        "        anims = []\n",
        "        for poly in zeta_polys:\n",
        "            anims.append(FadeTransformPieces(\n",
        "                x_poly[x_poly.sep_indices[0]:].copy(),\n",
        "                poly[poly.sep_indices[0]:],\n",
        "            ))\n",
        "        self.play(LaggedStart(*anims, lag_ratio=0.1, run_time=2))\n",
        "        self.wait()\n",
        "\n",
        "        # Highlight columns\n",
        "        lower_sum = VGroup()\n",
        "        lp = polys[-1]\n",
        "        for j in range(len(x_poly.sep_indices) - 1):\n",
        "            polys.generate_target()\n",
        "            col = VGroup()\n",
        "            for poly in polys.target:\n",
        "                col.add(poly[poly.sep_indices[j] + 1:poly.sep_indices[j + 1]])\n",
        "            polys.target.set_fill(opacity=0.5)\n",
        "            col.set_fill(opacity=1)\n",
        "\n",
        "            if j % 5 == 0:\n",
        "                term = Tex(f\"5c_{j}\", font_size=36)\n",
        "            else:\n",
        "                term = Tex(\"0\", font_size=36)\n",
        "            i1, i2 = lp.sep_indices[j:j + 2]\n",
        "            term.next_to(VGroup(lp[i1], lp[i2]), DOWN, buff=0.7)\n",
        "            plus = Tex(\"+\", font_size=36)\n",
        "            plus.next_to(lp[i1], DOWN, buff=0.7)\n",
        "            if j == 0:\n",
        "                plus.set_opacity(0)\n",
        "            else:\n",
        "                plus.move_to(midpoint(lower_sum.get_right(), term.get_left()))\n",
        "            lower_sum.add(plus, term)\n",
        "\n",
        "            self.play(\n",
        "                FlashAround(col, time_width=2),\n",
        "                MoveToTarget(polys),\n",
        "                plusses.animate.set_fill(opacity=0.5),\n",
        "            )\n",
        "            self.wait()\n",
        "            self.play(\n",
        "                Write(plus),\n",
        "                *(\n",
        "                    FadeTransform(piece.copy(), term)\n",
        "                    for piece in col[1:]\n",
        "                )\n",
        "            )\n",
        "            self.wait()\n",
        "        self.play(polys.animate.set_opacity(1))\n",
        "        self.wait()\n",
        "\n",
        "    def get_polynomial(self, input_tex, color, exp_multiple=None, font_size=36):\n",
        "        if exp_multiple is not None:\n",
        "            tex = f\"f({input_tex}^{exp_multiple}) =\"\n",
        "        else:\n",
        "            tex = f\"f({input_tex}) = \"\n",
        "            exp_multiple = 1\n",
        "        tex += \"c_0 + \"\n",
        "        for n in range(1, self.n_terms):\n",
        "            tex += f\"c_{{{n}}}{input_tex}^{{{exp_multiple * n}}} + \"\n",
        "        tex += \"\\\\cdots\"\n",
        "        result = Tex(\n",
        "            tex,\n",
        "            tex_to_color_map={\n",
        "                input_tex: color,\n",
        "                \"+\": WHITE,\n",
        "                \"=\": WHITE,\n",
        "            },\n",
        "            font_size=font_size,\n",
        "        )\n",
        "        result.sep_indices = [\n",
        "            result.submobjects.index(part.family_members_with_points()[0])\n",
        "            for part in (*result.get_parts_by_tex(\"=\"), *result.get_parts_by_tex(\"+\"))\n",
        "        ]\n",
        "        # result.arrange(RIGHT, aligned_edge=DOWN)\n",
        "        return result\n",
        "\n",
        "\n",
        "class Recap(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Step labels\n",
        "        steps = VGroup(*(Text(f\"{n}.\") for n in range(1, 5)))\n",
        "        VGroup(*reversed(steps)).arrange_to_fit_height(6, DOWN)\n",
        "        steps.set_y(0)\n",
        "        steps.to_edge(LEFT)\n",
        "\n",
        "        # Question\n",
        "        set_part = \"$\\\\{1,\\\\dots,2000\\\\}$\"\n",
        "        kw = dict(font_size=40)\n",
        "        question = OldTexText(\n",
        "            f\"Find the number of subsets of {set_part} whose sum is divisible by 5\",\n",
        "            tex_to_color_map={set_part: BLUE},\n",
        "            **kw\n",
        "        )\n",
        "        question.set_width(FRAME_WIDTH - 1.5)\n",
        "        question.next_to(steps[0], buff=MED_SMALL_BUFF)\n",
        "        question.shift(0.025 * DOWN)\n",
        "        self.play(Write(question), Write(steps[0]))\n",
        "        self.wait()\n",
        "\n",
        "        # Polynomial\n",
        "        factored_tex = \"(1 + x)(1 + x^2)(1 + x^3)\\\\cdots\\\\big(1 + x^{2{,}000}\\\\big)\"\n",
        "        rhs_tex = \"\\\\sum_{n = 0}^\\\\infty c_n x^n\"\n",
        "        poly = Tex(\n",
        "            f\"f(x) &= {factored_tex} = {rhs_tex}\",\n",
        "            isolate=[factored_tex, rhs_tex, \"c_n\", \"=\"],\n",
        "            **kw,\n",
        "        )\n",
        "        poly.next_to(steps[1], RIGHT)\n",
        "        poly.shift((steps[1].get_y() - poly[0].get_y()) * UP)\n",
        "\n",
        "        cn_part = poly.select_part(\"c_n\")\n",
        "        cn_rect = SurroundingRectangle(cn_part, buff=0.05)\n",
        "        cn_rect.round_corners()\n",
        "        cn_rect.set_stroke(TEAL, 2)\n",
        "        cn_label = OldTexText(\"How many subsets sum to $n$\", font_size=30)\n",
        "        cn_label.set_color(TEAL)\n",
        "        cn_label.next_to(cn_rect, UP, MED_LARGE_BUFF, aligned_edge=LEFT)\n",
        "        cn_arrow = Arrow(cn_rect.get_top(), cn_label[0][:5], color=TEAL, buff=0.1)\n",
        "\n",
        "        self.play(FadeIn(poly, lag_ratio=0.1), Write(steps[1]))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            ShowCreation(cn_rect),\n",
        "            ShowCreation(cn_arrow),\n",
        "        )\n",
        "        self.play(FadeIn(cn_label, 0.25 * UP))\n",
        "        self.wait()\n",
        "\n",
        "        # Evaluation\n",
        "        evaluation = Tex(\n",
        "            \"c_{0} + c_{5} + c_{10} + c_{15} + \\\\cdots = \"\n",
        "            \"\\\\frac{1}{5}\\\\Big(f(\\\\zeta^0) + f(\\\\zeta^1) + f(\\\\zeta^2) + f(\\\\zeta^3) + f(\\\\zeta^4) \\\\Big)\",\n",
        "            tex_to_color_map={\n",
        "                re.compile(r\"c_{.+?}\"): TEAL,\n",
        "                \"\\\\zeta\": YELLOW,\n",
        "            },\n",
        "            isolate=[re.compile(r\"f(.+?)\")],\n",
        "            **kw\n",
        "        )\n",
        "        evaluation.next_to(steps[2], RIGHT)\n",
        "\n",
        "        self.play(Write(evaluation), Write(steps[2]))\n",
        "        self.wait()\n",
        "\n",
        "        # f(zeta)\n",
        "        rhs = \"\\\\Big(\" + \"\".join(f\"(1 + \\\\zeta^{n})\" for n in range(1, 6)) + \"\\\\Big)^{400}\"\n",
        "        fz = Tex(\n",
        "            f\"f(\\\\zeta) = {rhs}\",\n",
        "            tex_to_color_map={\"\\\\zeta\": YELLOW},\n",
        "            isolate=[\"f(\\\\zeta)\", \"=\", rhs],\n",
        "            **kw,\n",
        "        )\n",
        "        fz.next_to(steps[3], RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            TransformFromCopy(\n",
        "                evaluation.select_part(\"f(\\\\zeta^1)\"),\n",
        "                fz.select_part(\"f(\\\\zeta)\"),\n",
        "            ),\n",
        "            Write(fz.select_part(\"=\")),\n",
        "            Write(steps[3]),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(Write(fz.select_part(rhs)))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ReflectOnNumericalAnswer(InteractiveScene):\n",
        "    def construct(self):\n",
        "        pass\n",
        "\n",
        "\n",
        "class ReflectOnGeneratingFunctions(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Sequence\n",
        "        subsets = get_subsets(list(range(1, 16)))\n",
        "        seq = [\n",
        "            sum(sum(s) == n for s in subsets)\n",
        "            for n in range(1, 15)\n",
        "        ]\n",
        "        seq_mobs = VGroup(*map(Integer, seq))\n",
        "        seq_mobs.scale(0.9)\n",
        "        seq_mobs.add(Tex(\"\\\\cdots\"))\n",
        "        seq_mobs.arrange(RIGHT, aligned_edge=DOWN)\n",
        "        seq_mobs.arrange_to_fit_width(FRAME_WIDTH - 1)\n",
        "        seq_mobs.move_to(UP)\n",
        "\n",
        "        brace = Brace(seq_mobs, UP)\n",
        "        brace_label = Text(\"Sequence we want to understand\")\n",
        "        brace_label.next_to(brace, UP)\n",
        "\n",
        "        self.play(\n",
        "            Write(brace_label, run_time=1),\n",
        "            GrowFromCenter(brace),\n",
        "            ShowIncreasingSubsets(seq_mobs),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Put into a polynomial\n",
        "        poly_str = \" + \".join((\n",
        "            f\"{s} x^{{{n}}}\"\n",
        "            for n, s in enumerate(seq)\n",
        "        ))\n",
        "        poly_str += \"+ \\\\cdots\"\n",
        "        poly = Tex(\n",
        "            poly_str,\n",
        "            tex_to_color_map={\"x\": BLUE, \"+\": WHITE},\n",
        "        )\n",
        "        poly.set_width(FRAME_WIDTH - 1)\n",
        "        poly.next_to(seq_mobs, DOWN, buff=LARGE_BUFF)\n",
        "\n",
        "        plus_indices = [-1, *(poly.submobjects.index(p[0]) for p in poly.select_parts(\"+\"))]\n",
        "        coefs = VGroup(*[\n",
        "            poly[i + 1:i + 1 + len(str(n))]\n",
        "            for i, n in zip(plus_indices, seq)\n",
        "        ])\n",
        "        self.play(\n",
        "            LaggedStart(*(\n",
        "                Transform(sm.copy(), coef.copy(), remover=True)\n",
        "                for sm, coef in zip(seq_mobs, coefs)\n",
        "            )),\n",
        "            LaggedStart(*(\n",
        "                FadeIn(sm, scale=3.0)\n",
        "                for sm in poly\n",
        "                if not set(sm.get_family()).intersection(coefs.get_family())\n",
        "            )),\n",
        "            run_time=2\n",
        "        )\n",
        "        self.add(poly)\n",
        "        self.wait()\n",
        "\n",
        "        # Make way\n",
        "        self.play(\n",
        "            poly.animate.to_edge(UP),\n",
        "            FadeOut(VGroup(seq_mobs, brace, brace_label), 2.5 * UP),\n",
        "        )\n",
        "\n",
        "        # Evaluate on complex plane\n",
        "        in_plane = ComplexPlane((-3, 3), (-3, 3))\n",
        "        out_plane = ComplexPlane(\n",
        "            (-10, 10), (-10, 10), background_line_style=dict(stroke_width=1),\n",
        "            faded_line_ratio=0,\n",
        "        )\n",
        "        plane_labels = VGroup(Text(\"Input\"), Text(\"Output\"))\n",
        "        for plane, vect, label in zip([in_plane, out_plane], [DL, DR], plane_labels):\n",
        "            plane.add_coordinate_labels(font_size=20)\n",
        "            plane.set_height(5)\n",
        "            plane.to_corner(vect)\n",
        "            label.scale(0.75)\n",
        "            label.set_color(GREY_A)\n",
        "            label.next_to(plane, UP)\n",
        "\n",
        "        arrow = Arrow(in_plane.get_right(), out_plane.get_left(), path_arc=-45 * DEGREES)\n",
        "        arrow.shift(UP)\n",
        "\n",
        "        in_dot = GlowDot(in_plane.n2p(-1), color=YELLOW)\n",
        "        out_dot = GlowDot(out_plane.n2p(0), color=RED)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(in_plane),\n",
        "            Write(plane_labels[0]),\n",
        "            FadeIn(in_dot),\n",
        "        )\n",
        "        self.play(\n",
        "            ShowCreation(arrow),\n",
        "            FadeTransform(in_plane.copy(), out_plane, path_arc=-30 * DEGREES),\n",
        "            TransformFromCopy(*plane_labels, path_arc=30 * DEGREES),\n",
        "            TransformFromCopy(in_dot, out_dot, path_arc=30 * DEGREES),\n",
        "        )\n",
        "        self.add(out_dot)\n",
        "\n",
        "        # Paths\n",
        "        def get_z():\n",
        "            return in_plane.p2n(in_dot.get_center())\n",
        "\n",
        "        def func(z):\n",
        "            return np.prod([1 + z**n for n in range(10)])\n",
        "\n",
        "        out_dot.add_updater(lambda od: od.move_to(out_plane.n2p(func(get_z()))))\n",
        "\n",
        "        arc = ParametricCurve(lambda t: in_plane.n2p(np.exp(complex(0, PI - t))), t_range=(0, TAU))\n",
        "        # arc_image = ParametricCurve(lambda t: out_plane.n2p(func(np.exp(complex(0, PI - t)))), t_range=(0, TAU, 0.01))\n",
        "        # arc.set_stroke(YELLOW, 2)\n",
        "        # arc_image.set_stroke(RED, 1)\n",
        "\n",
        "\n",
        "        paths = [\n",
        "            TracingTail(in_dot, stroke_color=YELLOW, stroke_width=(0, 3), time_traced=16),\n",
        "            TracingTail(out_dot, stroke_color=RED, stroke_width=(0, 1.5), time_traced=16),\n",
        "        ]\n",
        "        self.add(*paths)\n",
        "        self.wait(16)\n",
        "        self.play(\n",
        "            MoveAlongPath(in_dot, arc.copy()),\n",
        "            run_time=16,\n",
        "            rate_func=linear,\n",
        "        )\n",
        "        self.wait(10)\n",
        "\n",
        "\n",
        "class GeneratingFunctionForPrimes(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Title\n",
        "        title = Text(\"A prime generating function?\")\n",
        "        title.to_edge(UP, buff=MED_SMALL_BUFF)\n",
        "        title.set_backstroke()\n",
        "        underline = Underline(title, buff=-0.05)\n",
        "        underline.stretch(1.25, 0)\n",
        "        underline.insert_n_curves(20)\n",
        "        underline.set_stroke(WHITE, [0, 3, 3, 3, 0])\n",
        "        self.add(underline, title)\n",
        "\n",
        "        # Attempt sequence\n",
        "        n_range = range(1, 12)\n",
        "        piece_groups = [\n",
        "            [str(int(sympy.isprime(n))) + f\"\\\\cdot x^{{{n}}} \" for n in n_range],\n",
        "            [str(int(sympy.isprime(n))) + f\"\\\\cdot {{{n}}}^x \" for n in n_range],\n",
        "            [str(int(sympy.isprime(n))) + f\"\\\\cdot {{{n}}}^s \" for n in n_range],\n",
        "            [\"{ \" + str(int(sympy.isprime(n))) + f\" \\\\over  {{{n}}}^s }}\" for n in n_range],\n",
        "            [\"{ \" + von_mangoldt_str(n) + f\" \\\\over  {{{n}}}^s }}\" for n in n_range],\n",
        "            [f\"{{1 \\\\over  {{{n}}}^s }}\" for n in range(1, 14)],\n",
        "        ]\n",
        "        lines = VGroup()\n",
        "        for pieces in piece_groups:\n",
        "            line = Tex(\" + \".join([*pieces, \"\\\\cdots\"]), isolate=[*pieces, \"+\"])\n",
        "            line.set_width(FRAME_WIDTH - 1)\n",
        "            for n, piece in zip(it.count(1), pieces):\n",
        "                part = line.select_part(piece)\n",
        "                if sympy.isprime(n):\n",
        "                    part.set_color(GREEN)\n",
        "                elif len(sympy.factorint(n)) == 1 and \"ln\" in piece:\n",
        "                    part.set_color(TEAL)\n",
        "            lines.add(line)\n",
        "            line.pieces = pieces\n",
        "\n",
        "        lines[0].shift(2 * UP)\n",
        "        lines[4].shift(2.5 * DOWN)\n",
        "\n",
        "        arrows = VGroup(\n",
        "            Arrow(lines[0], lines[1]),\n",
        "            Arrow(lines[3], lines[4]),\n",
        "        )\n",
        "        for arrow in arrows:\n",
        "            arrow.label = Text(\"or rather...\", font_size=36)\n",
        "            arrow.label.next_to(arrow, RIGHT)\n",
        "\n",
        "        self.play(Write(lines[0]))\n",
        "        self.wait()\n",
        "        for i, l1, l2 in zip(it.count(), lines[0:4], lines[1:5]):\n",
        "            added_anims = []\n",
        "            if i in [1, 2]:\n",
        "                self.remove(l1)\n",
        "            elif i in [0, 3]:\n",
        "                arrow = arrows[i // 3]\n",
        "                added_anims.append(GrowArrow(arrow))\n",
        "                added_anims.append(Write(arrow.label))\n",
        "            self.play(\n",
        "                *(\n",
        "                    TransformMatchingShapes(l1.select_part(p1).copy(), l2.select_part(p2))\n",
        "                    for p1, p2 in zip(l1.pieces, l2.pieces)\n",
        "                ),\n",
        "                ReplacementTransform(l1.select_parts(\"+\").copy(), l2.select_parts(\"+\")),\n",
        "                ReplacementTransform(l1.select_parts(\"\\\\cdots\").copy(), l2.select_parts(\"\\\\cdots\")),\n",
        "                *added_anims,\n",
        "            )\n",
        "            self.wait()\n",
        "\n",
        "        # Sweep away\n",
        "        series = lines[4]\n",
        "        self.play(\n",
        "            series.animate.move_to(UP),\n",
        "            FadeOut(VGroup(lines[0], arrows[0], arrows[0].label), UP),\n",
        "            FadeOut(VGroup(lines[3], arrows[1], arrows[1].label), 0.5 * UP),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Name Dirichlet series\n",
        "        gf_part = title.select_part(\"generating function?\")\n",
        "        strike = Line().replace(gf_part, dim_to_match=0)\n",
        "        strike.set_stroke(RED, 5)\n",
        "        dirichlet = Text(\"Dirichlet series\")\n",
        "        dirichlet.set_color(BLUE)\n",
        "        dirichlet.next_to(gf_part, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(strike),\n",
        "        )\n",
        "        self.play(FadeIn(dirichlet, DOWN))\n",
        "        self.wait()\n",
        "\n",
        "        # Von Mangoldt\n",
        "        vm_name = Text(\"Von Mangoldt function: \")\n",
        "        vm_def = VGroup(\n",
        "            Tex(\"\\\\Lambda(n)= \\\\log p & \\\\text { if } n=p^{k} \\\\text { for some prime } p \\\\text { and integer } k \\\\geq 1\"),\n",
        "            Tex(\"\\\\Lambda(n)= 0 & \\\\text { otherwise }\")\n",
        "        )\n",
        "        vm_def.arrange(DOWN, aligned_edge=LEFT)\n",
        "        vm = VGroup(vm_name, vm_def)\n",
        "        vm.arrange(RIGHT)\n",
        "        vm_name.align_to(vm_def[0], DOWN)\n",
        "        vm.set_width(FRAME_WIDTH - 1)\n",
        "        vm.next_to(series, DOWN, LARGE_BUFF)\n",
        "\n",
        "        self.play(Write(vm_name, run_time=1))\n",
        "        self.wait()\n",
        "        for part in vm_def:\n",
        "            self.play(FadeIn(part))\n",
        "            self.wait()\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(vm),\n",
        "            FadeOut(VGroup(title, underline, strike), 0.5 * UP),\n",
        "            FadeOut(dirichlet, UP),\n",
        "            series.animate.move_to(2 * UP),\n",
        "        )\n",
        "\n",
        "        # Contrast with zeta\n",
        "        zeta_series = lines[5]\n",
        "        zeta_series.center()\n",
        "        zeta_series.set_color(WHITE)\n",
        "        zeta_brace = Brace(zeta_series, DOWN, buff=SMALL_BUFF)\n",
        "        zeta_sym = OldTex(\"\\\\zeta(s)\")\n",
        "        zeta_sym.next_to(zeta_brace, DOWN)\n",
        "        zeta_group = VGroup(zeta_series, zeta_brace, zeta_sym)\n",
        "\n",
        "        series_brace = Brace(series, DOWN, buff=SMALL_BUFF)\n",
        "        series_label = Tex(\"-{\\\\zeta'(s) \\\\over \\\\zeta(s)}\")\n",
        "        series_label.next_to(series_brace, DOWN)\n",
        "\n",
        "        self.play(FadeIn(zeta_series, DOWN))\n",
        "        self.play(\n",
        "            GrowFromCenter(zeta_brace),\n",
        "            Write(zeta_sym)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            GrowFromCenter(series_brace),\n",
        "            Write(series_label),\n",
        "            zeta_group.animate.shift(1.5 * DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Show the complex plane\n",
        "        pass\n",
        "\n",
        "\n",
        "class DirichletSeries(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Framing\n",
        "        h_line = Line().set_width(FRAME_WIDTH)\n",
        "        h_line.set_stroke(WHITE, 1)\n",
        "        titles = VGroup(\n",
        "            Text(\"Our puzzle\", font_size=36),\n",
        "            Text(f\"Studying primes\", font_size=36),\n",
        "        )\n",
        "        titles[0].to_corner(UL, buff=MED_SMALL_BUFF)\n",
        "        titles[1].next_to(h_line, DOWN).align_to(titles[0], LEFT)\n",
        "\n",
        "        self.add(titles, h_line)\n",
        "\n",
        "        # Show series\n",
        "        n_range = list(range(1, 14))\n",
        "        coef_texs = [von_mangoldt_str(n) for n in n_range]\n",
        "        denom_texs = [f\"{{{n}}}^s\" for n in n_range]\n",
        "        series_terms = [f\"{{ {coef} \\\\over  {denom} }}\" for coef, denom in zip(coef_texs, denom_texs)]\n",
        "        series = Tex(\n",
        "            \" + \".join(series_terms) + \"+ \\\\cdots\",\n",
        "            isolate=[\"+\", *coef_texs, *denom_texs]\n",
        "        )\n",
        "\n",
        "        series.set_width(FRAME_WIDTH - 1)\n",
        "        series.next_to(h_line, DOWN, buff=2.0)\n",
        "\n",
        "        plusses = series.select_parts(\"+\")\n",
        "        denoms = VGroup(*(series.select_part(dt) for dt in denom_texs))\n",
        "        plus_indices = [series.submobjects.index(plus[0]) for plus in plusses]\n",
        "        denom_indices = [series.submobjects.index(denom[0]) for denom in denoms]\n",
        "        coefs = VGroup()\n",
        "        overs = VGroup()\n",
        "        for i, j, k in zip((-1, *plus_indices), denom_indices, plus_indices):\n",
        "            coefs.add(series[i + 1:j - 1])\n",
        "            overs.add(series[j - 1])\n",
        "\n",
        "        for n, coef, denom in zip(n_range, coefs, denoms):\n",
        "            if sympy.isprime(n):\n",
        "                color = YELLOW\n",
        "            elif len(sympy.factorint(n)) == 1:\n",
        "                color = TEAL\n",
        "            else:\n",
        "                color = WHITE\n",
        "            coef.set_color(color)\n",
        "            denom.set_color(color)\n",
        "\n",
        "        coefs.save_state()\n",
        "        coefs.shift(DOWN)\n",
        "\n",
        "        numbers = VGroup(*(Integer(n, font_size=36) for n in n_range))\n",
        "        arrows = VGroup()\n",
        "        for number, coef_part in zip(numbers, coefs):\n",
        "            number.next_to(coef_part, UP, buff=LARGE_BUFF)\n",
        "            arrows.add(Arrow(number, coef_part, stroke_width=2))\n",
        "        arrows.set_stroke(GREY_B)\n",
        "\n",
        "        vm_def = Tex(\"n \\\\rightarrow \\\\log p & \\\\text { if } n=p^{k} \\\\text { for some prime } p \\\\text { and integer } k \\\\geq 1\")\n",
        "        vm_def.scale(0.5)\n",
        "        vm_def.next_to(h_line, DOWN)\n",
        "        vm_def.to_edge(RIGHT)\n",
        "        details = Text(\"(Why this sequence? That's a story for another day...)\")\n",
        "        details.scale(0.5)\n",
        "        details.set_color(GREY_B)\n",
        "        details.next_to(vm_def, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            ShowIncreasingSubsets(numbers),\n",
        "            ShowIncreasingSubsets(arrows),\n",
        "            ShowIncreasingSubsets(coefs),\n",
        "            FadeIn(vm_def, time_span=(1, 2)),\n",
        "            run_time=3,\n",
        "            rate_func=linear,\n",
        "        )\n",
        "        self.play(FadeIn(details, 0.5 * DOWN))\n",
        "        self.wait(3)\n",
        "        self.play(\n",
        "            coefs.animate.restore(),\n",
        "            *(\n",
        "                ReplacementTransform(number, denom)\n",
        "                for number, denom in zip(numbers, denoms)\n",
        "            ),\n",
        "            *(FadeOut(arrow, scale=0.2) for arrow in arrows),\n",
        "            Write(overs, time_range=(0.75, 1.75)),\n",
        "            Write(plusses, time_range=(0.75, 1.75)),\n",
        "        )\n",
        "        self.add(series)\n",
        "        self.wait()\n",
        "\n",
        "        # Name Dirichlet\n",
        "        series.generate_target()\n",
        "        series.target.shift(0.5 * UP)\n",
        "        brace = Brace(series.target, DOWN)\n",
        "        name = Text(\"Dirichlet series\")\n",
        "        name.next_to(brace, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            MoveToTarget(series),\n",
        "            GrowFromCenter(brace),\n",
        "        )\n",
        "        self.play(Write(name))\n",
        "        self.wait(2)\n",
        "\n",
        "        # Move everything up\n",
        "        func_name = Tex(\"f(s) = -\\\\zeta'(s) / \\\\zeta(s)\", font_size=36)\n",
        "        func_name.next_to(brace, DOWN)\n",
        "        func_name.set_opacity(0)\n",
        "\n",
        "        self.play(LaggedStart(\n",
        "            FadeOut(h_line, 3 * UP),\n",
        "            FadeOut(titles[0], UP),\n",
        "            FadeOut(titles[1], 3 * UP),\n",
        "            FadeOut(vm_def, 2 * UP),\n",
        "            FadeOut(details, 2 * UP),\n",
        "            FadeOut(name, 3 * UP),\n",
        "            VGroup(series, brace, func_name).animate.set_opacity(1).to_edge(UP),\n",
        "            lag_ratio=0.01\n",
        "        ))\n",
        "        self.wait()\n",
        "\n",
        "        # Complex plane\n",
        "        kw = dict(background_line_style={\"stroke_width\": 1})\n",
        "        in_plane, out_plane = planes = VGroup(\n",
        "            ComplexPlane((-5, 5), (-4, 4), **kw),\n",
        "            ComplexPlane((-3, 3), (-3, 3), **kw),\n",
        "        )\n",
        "        plane_labels = VGroup(Text(\"Input\"), Text(\"Output\"))\n",
        "        for label, plane, vect in zip(plane_labels, planes, [DL, DR]):\n",
        "            plane.set_height(4)\n",
        "            plane.add_coordinate_labels(font_size=12)\n",
        "            plane.to_corner(vect)\n",
        "            label.scale(0.7)\n",
        "            label.set_color(GREY_A)\n",
        "            label.next_to(plane, UP)\n",
        "\n",
        "        arrow = Arrow(in_plane.get_right(), out_plane.get_left(), path_arc=-45 * DEGREES)\n",
        "        arrow.align_to(in_plane, UP).shift(DOWN)\n",
        "        f_label = Tex(\"f(s)\", font_size=36)\n",
        "        f_label.next_to(arrow.pfp(0.5), DOWN)\n",
        "\n",
        "        in_dot = GlowDot(in_plane.n2p(0.5), color=YELLOW)\n",
        "        out_dot = GlowDot(out_plane.n2p(2), color=RED)\n",
        "\n",
        "        def get_z():\n",
        "            return in_plane.p2n(in_dot.get_center())\n",
        "\n",
        "        def func(z):\n",
        "            ep = 1e-3\n",
        "            zeta = mpmath.zeta(z)\n",
        "            dzeta = (mpmath.zeta(z + ep) - zeta) / ep\n",
        "            return -dzeta / zeta\n",
        "\n",
        "        out_dot.add_updater(lambda d: d.move_to(out_plane.n2p(func(get_z()))))\n",
        "\n",
        "        v_line = ParametricCurve(lambda t: in_plane.n2p(complex(2, t)), t_range=(-4, 4, 0.01))\n",
        "        v_line.set_stroke(YELLOW, 2)\n",
        "        out_line = v_line.copy()\n",
        "        out_line.set_stroke(RED, 2)\n",
        "        out_line.add_updater(lambda m: m.set_points([\n",
        "            out_plane.n2p(func(in_plane.p2n(p)))\n",
        "            for p in v_line.get_points()\n",
        "        ]))\n",
        "\n",
        "        # Complex mapping\n",
        "        self.disable_interaction(in_plane, out_plane)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(in_plane),\n",
        "            FadeIn(out_plane),\n",
        "            FadeIn(plane_labels),\n",
        "            FadeIn(in_dot)\n",
        "        )\n",
        "        self.play(\n",
        "            ShowCreation(arrow),\n",
        "            FadeIn(f_label, RIGHT + 0.2 * UP),\n",
        "            TransformFromCopy(in_dot, out_dot, path_arc=45 * DEGREES)\n",
        "        )\n",
        "        self.play(\n",
        "            in_dot.animate.move_to(v_line.get_start()),\n",
        "            run_time=2,\n",
        "        )\n",
        "        in_dot.add_updater(lambda d: d.move_to(v_line.get_end()))\n",
        "        self.add(v_line, out_line)\n",
        "        self.play(\n",
        "            ShowCreation(v_line),\n",
        "            ShowCreation(out_line),\n",
        "            run_time=5,\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            v_line.animate.move_to(in_plane.n2p(-1)),\n",
        "            run_time=6\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class AskAboutComplex(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Ask\n",
        "        morty = self.teacher\n",
        "        ss = self.students\n",
        "        self.student_says(\"Why complex\\nnumbers?\")\n",
        "        self.play(\n",
        "            ss[0].change(\"pondering\"),\n",
        "            ss[1].change(\"erm\"),\n",
        "            morty.change(\"tease\"),\n",
        "        )\n",
        "        self.wait(2)\n",
        "        self.play(\n",
        "            RemovePiCreatureBubble(ss[2], target_mode=\"erm\", look_at=morty.eyes),\n",
        "            morty.change(\"hesitant\"),\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "        # Hidden information\n",
        "        kw = dict(tex_to_color_map={\n",
        "            \"x\": BLUE,\n",
        "            \"{0}\": BLUE,\n",
        "            \"{1}\": BLUE,\n",
        "            \"{-1}\": BLUE,\n",
        "        })\n",
        "        fx, f0, f1, fm1 = lines = VGroup(\n",
        "            Tex(\"f(x) = \\\\sum_{n = 0}^N c_n x^n\", **kw),\n",
        "            Tex(\"f({0}) = c_0\", **kw),\n",
        "            Tex(\"f({1}) = c_0 + c_1 + c_2 + \\\\cdots + c_n\", **kw),\n",
        "            Tex(\"f({-1}) = c_0 - c_1 + c_2 - \\\\cdots + c_n\", **kw),\n",
        "        )\n",
        "        lines.arrange(DOWN, buff=MED_LARGE_BUFF, aligned_edge=LEFT)\n",
        "        lines.set_height(4)\n",
        "        lines[0].next_to(lines[1], LEFT, LARGE_BUFF)\n",
        "        lines.next_to(morty, UL).to_edge(UP)\n",
        "\n",
        "        self.play(\n",
        "            morty.change(\"raise_right_hand\"),\n",
        "            FadeInFromPoint(fx, morty.get_center(), run_time=2),\n",
        "            ss[1].change(\"hesitant\", lines)\n",
        "        )\n",
        "        for line in lines[1:]:\n",
        "            self.play(FadeIn(line, 0.5 * DOWN))\n",
        "        self.wait()\n",
        "        self.play(morty.change(\"tease\"))\n",
        "        self.wait()\n",
        "\n",
        "        # Blank check\n",
        "        new_line = Tex(\n",
        "            \"f(\\\\dots) = \\\\text{(more information)}\",\n",
        "            tex_to_color_map={\"\\\\dots\": BLUE}\n",
        "        )\n",
        "        new_line.match_height(lines[-1])\n",
        "        new_line.next_to(lines[-1], DOWN, MED_LARGE_BUFF, aligned_edge=LEFT)\n",
        "\n",
        "        dots_in_set = Tex(\n",
        "            \"x \\\\in \\\\mathds{R}\",\n",
        "            isolate=[\"\\\\mathds{R}\", \"\\\\dots\"],\n",
        "            tex_to_color_map={\"x\": BLUE},\n",
        "            font_size=60\n",
        "        )\n",
        "        dots_in_set.next_to(morty, UR, MED_LARGE_BUFF).shift_onto_screen()\n",
        "        set_part = dots_in_set.select_part(\"\\\\mathds{R}\")\n",
        "        C_set = Tex(\"\\\\mathds{C}\", color=TEAL, font_size=60)\n",
        "        C_set.move_to(set_part)\n",
        "\n",
        "        self.play(\n",
        "            Write(new_line),\n",
        "            self.change_students(\n",
        "                \"thinking\", \"hesitant\", \"pondering\",\n",
        "                look_at=new_line,\n",
        "            ),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformFromCopy(\n",
        "                new_line.select_part(\"\\\\dots\"),\n",
        "                dots_in_set.select_part(\"x\"),\n",
        "                path_arc=-45 * DEGREES,\n",
        "            ),\n",
        "            morty.change(\"raise_left_hand\", dots_in_set),\n",
        "        )\n",
        "        self.play(Write(dots_in_set[1:]))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            morty.change(\"shruggie\"),\n",
        "            ss[0].change(\"pondering\"),\n",
        "            ss[2].change(\"hesitant\"),\n",
        "            FadeOut(dots_in_set.select_part(\"\\\\mathds{R}\"), UP),\n",
        "            FadeIn(C_set, UP),\n",
        "        )\n",
        "        self.wait(5)\n",
        "\n",
        "\n",
        "class ReferenceFilter(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Grid\n",
        "        c_grid = Tex(\"c_{10}\").get_grid(10, 10, buff=MED_LARGE_BUFF)\n",
        "        c_grid.set_height(FRAME_HEIGHT - 1)\n",
        "\n",
        "        for n, c_mob in zip(it.count(1), c_grid):\n",
        "            sub = Integer(n)\n",
        "            sub.match_height(c_mob[1:])\n",
        "            sub.move_to(c_mob[1:], UL)\n",
        "            c_mob.remove(*c_mob[1:])\n",
        "            c_mob.add(sub)\n",
        "\n",
        "        self.play(FadeIn(c_grid, run_time=2, lag_ratio=0.025))\n",
        "        c_grid.generate_target()\n",
        "        c_grid.target.set_opacity(0.25)\n",
        "        c_grid.target[4::5].set_fill(TEAL, 1)\n",
        "        self.play(MoveToTarget(c_grid, run_time=2, lag_ratio=0.025))\n",
        "        self.wait()\n",
        "\n",
        "        # Name frequency\n",
        "        c_grid.generate_target()\n",
        "        c_grid.target.set_height(4.0)\n",
        "        c_grid.target.set_y(0).to_edge(LEFT)\n",
        "        freq_label = Text(\"Frequency question\")\n",
        "        freq_label.next_to(c_grid.target, UP, MED_LARGE_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            MoveToTarget(c_grid),\n",
        "            Write(freq_label),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Roots of unity (to be overlaid)\n",
        "        uc_label = OldTexText(\"Values of the form $e^{it}$\")\n",
        "        uc_label.match_y(freq_label, UP)\n",
        "        uc_label.set_x(-freq_label.get_x())\n",
        "\n",
        "        arrow = Vector(2.0 * RIGHT).next_to(c_grid, RIGHT)\n",
        "        self.play(ShowCreation(arrow), Write(uc_label))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class PracticeQuestions(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Blah\n",
        "        division = VGroup(Line().set_width(FRAME_WIDTH), Line(UP, DOWN).set_height(FRAME_HEIGHT))\n",
        "        division.set_stroke(WHITE, 1)\n",
        "        self.disable_interaction(division)\n",
        "        self.add(division)\n",
        "\n",
        "        questions = VGroup(\n",
        "            self.load_mobject(\"Question1.mob\"),\n",
        "            self.load_mobject(\"Question2.mob\"),\n",
        "            self.load_mobject(\"Question3.mob\"),\n",
        "            self.load_mobject(\"Question4.mob\"),\n",
        "        )\n",
        "\n",
        "        self.play(LaggedStartMap(FadeIn, questions, lag_ratio=0.25, run_time=2))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "# Quick filler\n",
        "\n",
        "class ProblemStatement(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Title\n",
        "        title = Text(\"Useless puzzles with useful lessons\", font_size=60)\n",
        "        title.to_edge(UP)\n",
        "        title.set_color(BLUE_C)\n",
        "        underline = Underline(title, buff=-0.05)\n",
        "        underline.insert_n_curves(20)\n",
        "        underline.set_stroke(width=[1, 3, 3, 3, 1])\n",
        "        words = VGroup(*(\n",
        "            title.get_part_by_text(text)\n",
        "            for text in title.get_text().split(\" \")\n",
        "        ))\n",
        "\n",
        "        morty = self.teacher\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart(*(\n",
        "                FadeInFromPoint(word, morty.get_corner(UL))\n",
        "                for word in words\n",
        "            )),\n",
        "            morty.change(\"raise_right_hand\", title),\n",
        "            self.change_students(\"happy\", \"thinking\", \"happy\", look_at=title)\n",
        "        )\n",
        "        self.remove(words)\n",
        "        self.add(title)\n",
        "        self.play(ShowCreation(underline))\n",
        "        self.wait(2)\n",
        "        self.play_student_changes(\"pondering\", \"erm\", \"tease\", look_at=title)\n",
        "        self.wait(3)\n",
        "\n",
        "        # Statement\n",
        "        statement = get_question_title()\n",
        "        set_tex = statement[1]\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(statement),\n",
        "            self.change_students(*3 * [\"pondering\"], look_at=statement),\n",
        "            FadeOut(VGroup(title, underline), UP)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStart(*(\n",
        "                FlashAround(int_part)\n",
        "                for int_part in get_integer_parts(set_tex)\n",
        "            ), lag_ratio=0.05, run_time=3),\n",
        "            self.change_students(\"erm\", \"sassy\", \"confused\", look_at=statement),\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "        # Example subsets\n",
        "        subsets = VGroup(\n",
        "            get_set_tex([3, 1, 4]),\n",
        "            get_set_tex([2, 3, 5]),\n",
        "            get_set_tex(range(1, 2000, 2)),\n",
        "        )\n",
        "        subsets.move_to(UP)\n",
        "        sum_wrappers = VGroup(*map(get_sum_wrapper, subsets))\n",
        "        mode_triples = [\n",
        "            (\"erm\", \"pondering\", \"plain\"),\n",
        "            (\"pondering\", \"thinking\", \"pondering\"),\n",
        "            (\"thinking\", \"happy\", \"thinking\"),\n",
        "        ]\n",
        "\n",
        "        sum_groups = VGroup()\n",
        "        for subset, sum_wrapper, mode_triple in zip(subsets, sum_wrappers, mode_triples):\n",
        "            self.play(\n",
        "                morty.change(\"tease\", subset),\n",
        "                self.change_students(*mode_triple, look_at=subset),\n",
        "                set_tex_transform(set_tex, subset),\n",
        "            )\n",
        "            elem_rects = VGroup(*(\n",
        "                SurroundingRectangle(\n",
        "                    get_part_by_value(set_tex, value)\n",
        "                ).set_stroke(TEAL, 2).round_corners()\n",
        "                for value in subset.values\n",
        "            ))\n",
        "            self.play(LaggedStartMap(ShowCreation, elem_rects, lag_ratio=0.5))\n",
        "\n",
        "            self.wait()\n",
        "            self.play(\n",
        "                Write(sum_wrapper),\n",
        "                morty.change(\"hooray\" if subset is subsets[-1] else \"tease\", subset),\n",
        "            )\n",
        "            self.wait(2)\n",
        "            mark = Checkmark() if sum(subset.values) % 5 == 0 else Exmark()\n",
        "            sum_wrapper.refresh_bounding_box()\n",
        "            mark.next_to(sum_wrapper, RIGHT)\n",
        "            self.play(Write(mark))\n",
        "            self.wait()\n",
        "            anims = [FadeOut(elem_rects)]\n",
        "\n",
        "            sum_group = VGroup(subset, sum_wrapper, mark)\n",
        "\n",
        "            if subset is subsets[0]:\n",
        "                self.play(\n",
        "                    sum_group.animate.scale(0.5).to_edge(LEFT).set_y(2),\n",
        "                    *anims\n",
        "                )\n",
        "            else:\n",
        "                self.play(\n",
        "                    sum_group.animate.scale(0.5).next_to(sum_groups, DOWN, MED_LARGE_BUFF, LEFT),\n",
        "                    *anims\n",
        "                )\n",
        "            sum_groups.add(sum_group)\n",
        "\n",
        "        self.play(\n",
        "            self.change_students(\n",
        "                \"erm\", \"confused\", \"hesitant\",\n",
        "                look_at=statement,\n",
        "            )\n",
        "        )\n",
        "\n",
        "        # Who cares?\n",
        "        statement.generate_target()\n",
        "        statement.target.scale(0.5)\n",
        "        statement.target.to_corner(UL)\n",
        "        title.set_opacity(0)\n",
        "        title.scale(0.5)\n",
        "        title.generate_target()\n",
        "        title.target.set_opacity(1)\n",
        "        title.target.scale(2)\n",
        "        title.target.next_to(self.hold_up_spot, UP, MED_LARGE_BUFF)\n",
        "        title.target.to_edge(RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            PiCreatureSays(\n",
        "                self.students[2], \"Who cares?\", target_mode=\"angry\",\n",
        "                bubble_config=dict(direction=LEFT),\n",
        "            ),\n",
        "            morty.change(\"guilty\"),\n",
        "            MoveToTarget(statement),\n",
        "            FadeOut(sum_groups, LEFT)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            RemovePiCreatureBubble(\n",
        "                self.students[2],\n",
        "                target_mode=\"plain\",\n",
        "                look_at=ORIGIN,\n",
        "            ),\n",
        "            morty.change(\"sassy\", self.students[2].eyes),\n",
        "            self.change_students(\n",
        "                \"pondering\", \"pondering\",\n",
        "                look_at=ORIGIN,\n",
        "            ),\n",
        "            MoveToTarget(title),\n",
        "        )\n",
        "        self.play(Blink(morty))\n",
        "        self.play(\n",
        "            FlashAround(title, time_width=1),\n",
        "            morty.change(\"raise_right_hand\"),\n",
        "        )\n",
        "        self.wait()\n",
        "        return\n",
        "\n",
        "        # Start simpler\n",
        "        small_set = get_set_tex(range(1, 6))\n",
        "        small_set.to_edge(UP)\n",
        "\n",
        "        case_words = Text(\"Start simple\")\n",
        "        case_words.next_to(small_set, DOWN)\n",
        "        case_words.set_color(BLUE)\n",
        "\n",
        "        self.play(\n",
        "            statement.animate.set_y(0),\n",
        "            set_tex_transform(set_tex, small_set),\n",
        "            LaggedStartMap(\n",
        "                FadeOut, self.pi_creatures, shift=DOWN,\n",
        "            ),\n",
        "            FadeOut(self.background),\n",
        "            Write(case_words),\n",
        "            run_time=2,\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(FadeOut(statement), FadeOut(case_words))\n",
        "\n",
        "\n",
        "class TopicRolidex(InteractiveScene):\n",
        "    def construct(self):\n",
        "        words = VGroup(\n",
        "            Text(\"Algebra\"),\n",
        "            Text(\"Number theory\"),\n",
        "            Text(\"Analysis\"),\n",
        "            Text(\"Topology\"),\n",
        "            Text(\"Geometry\"),\n",
        "            Text(\"Combinatorics\"),\n",
        "            Text(\"Group theory\"),\n",
        "        )\n",
        "        words.set_submobject_colors_by_gradient(BLUE, GREEN, YELLOW)\n",
        "        words.arrange(DOWN, aligned_edge=LEFT)\n",
        "        words.next_to(ORIGIN, DR)\n",
        "        words.shift(UP)\n",
        "\n",
        "        def update_words(ws):\n",
        "            for word in ws:\n",
        "                word.set_opacity(1.0 - clip(1.25 * abs(word.get_y()), 0, 1))\n",
        "\n",
        "        words.add_updater(update_words)\n",
        "\n",
        "        lhs = Text(\"Example in \")\n",
        "        lhs.center()\n",
        "        words.next_to(lhs, RIGHT, submobject_to_align=words[0])\n",
        "        self.add(lhs)\n",
        "\n",
        "        self.add(words)\n",
        "        self.play(\n",
        "            words.animate.shift(-words[-2].get_y() * UP),\n",
        "            UpdateFromFunc(words, update_words),\n",
        "            run_time=4\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class IMOLogo(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Intro\n",
        "        logo = ImageMobject(\"IMO_logo\")\n",
        "        logo.set_width(3)\n",
        "        logo.to_corner(UL, buff=0.25)\n",
        "        us_flag = ImageMobject(\"US_Flag\")\n",
        "        us_flag.set_height(0.5 * logo.get_height())\n",
        "        us_flag.move_to(logo)\n",
        "\n",
        "        title = Text(\"International\\nMath\\nOlympiad\")\n",
        "        title.next_to(logo, DOWN).to_edge(LEFT)\n",
        "\n",
        "        self.play(FadeIn(us_flag, scale=0.75))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(us_flag, UP),\n",
        "            FadeIn(logo, UP),\n",
        "            Write(title, run_time=1.5),\n",
        "        )\n",
        "        title.set_stroke(background=True)\n",
        "        self.play(title.animate.set_backstroke(width=5))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class BookQuestionHighlight(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Temp\n",
        "        img = ImageMobject(\"/Users/grant/Dropbox/3Blue1Brown/videos/2022/puzzles/subsets/images/BookQuestion.jpg\")\n",
        "        img.set_height(FRAME_HEIGHT)\n",
        "        self.disable_interaction(img)\n",
        "\n",
        "        # Highlight\n",
        "        rect = FullScreenFadeRectangle(fill_color=BLACK, fill_opacity=0.975)\n",
        "        lil_rect = Rectangle(5, 0.55)\n",
        "        lil_rect.move_to([-0.2, 0, 0])\n",
        "        lil_rect.reverse_points()\n",
        "        rect.append_vectorized_mobject(lil_rect)\n",
        "\n",
        "        self.play(\n",
        "            FlashAround(\n",
        "                lil_rect,\n",
        "                color=BLACK,\n",
        "                stroke_width=5,\n",
        "                time_width=1.5,\n",
        "                buff=0,\n",
        "                run_time=2,\n",
        "            ),\n",
        "            FadeIn(rect, time_span=(0.5, 2)),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Title\n",
        "        title = get_question_title()\n",
        "        title.set_backstroke(width=7)\n",
        "\n",
        "        self.play(\n",
        "            FadeTransform(lil_rect.copy().set_opacity(0), title)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStart(*(\n",
        "                FlashAround(int_part)\n",
        "                for int_part in get_integer_parts(title[1])\n",
        "            ), lag_ratio=0.05, run_time=3),\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "        last_part = title[-1][-12:]\n",
        "        self.play(\n",
        "            FlashUnder(last_part, color=TEAL, buff=0, time_width=1.5, run_time=2),\n",
        "            last_part.animate.set_fill(TEAL),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ConfusedPi(InteractiveScene):\n",
        "    def construct(self):\n",
        "        randy = Randolph(mode=\"erm\", height=2)\n",
        "        self.play(randy.change(\"maybe\").look(UP))\n",
        "        self.play(Blink(randy))\n",
        "        self.wait()\n",
        "        self.play(randy.change(\"pondering\").look(DL))\n",
        "        self.play(Blink(randy))\n",
        "        self.wait(2)\n",
        "\n",
        "\n",
        "class HowManyIntotal(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.teacher_says(\n",
        "            OldTexText(\"How many total\\\\\\\\subsets are there?\"),\n",
        "            bubble_config=dict(width=4, height=3),\n",
        "            added_anims=[self.change_students(\n",
        "                \"happy\", \"pondering\", \"tease\",\n",
        "                look_at=self.screen,\n",
        "            )],\n",
        "            run_time=2,\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class StrangeTurnsFraming(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Title\n",
        "        self.add(FullScreenRectangle())\n",
        "\n",
        "        screens = Square().replicate(2)\n",
        "        screens.set_stroke(WHITE, 1)\n",
        "        screens.set_fill(BLACK, 1)\n",
        "        screens.set_height(5.5)\n",
        "        screens.arrange_to_fit_width(FRAME_WIDTH - 2)\n",
        "        screens.to_edge(DOWN, buff=LARGE_BUFF)\n",
        "\n",
        "        titles = VGroup(*(\n",
        "            Text(f\"Strange turn {n}\", font_size=48)\n",
        "            for n in [1, 2]\n",
        "        ))\n",
        "        for title, screen in zip(titles, screens):\n",
        "            title.next_to(screen, UP)\n",
        "\n",
        "        self.add(screens)\n",
        "        for title in reversed(titles):\n",
        "            self.play(FadeIn(title, 0.5 * UP))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class IsThereAGeometry(InteractiveScene):\n",
        "    def construct(self):\n",
        "        randy = Randolph(height=1.5)\n",
        "        randy.shift(RIGHT)\n",
        "\n",
        "        self.play(PiCreatureBubbleIntroduction(\n",
        "            randy, OldTexText(\"Is there a\\\\\\\\geometric structure?\"),\n",
        "            target_mode=\"pondering\",\n",
        "            look_at=[10, -3, 0],\n",
        "            bubble_type=ThoughtBubble,\n",
        "            bubble_config=dict(width=3, height=1.75)\n",
        "        ))\n",
        "        for x in range(2):\n",
        "            self.play(Blink(randy))\n",
        "            self.wait(2)\n",
        "            self.play(randy.change(\"thinking\"))\n",
        "\n",
        "\n",
        "class RotationAnnotation(InteractiveScene):\n",
        "    def construct(self):\n",
        "        arc = Arc(0, PI, radius=0.5)\n",
        "        label = Integer(180, unit=\"^\\\\circ\", font_size=24)\n",
        "        label.next_to(arc.pfp(0.25), UR, SMALL_BUFF)\n",
        "\n",
        "        morty = Mortimer(height=1.5)\n",
        "        morty.next_to(arc, RIGHT, LARGE_BUFF, aligned_edge=DOWN)\n",
        "\n",
        "        self.play(\n",
        "            CountInFrom(label, 0),\n",
        "            ShowCreation(arc),\n",
        "            PiCreatureSays(\n",
        "                morty, OldTexText(\"Think about\\\\\\\\the half turn\", font_size=24),\n",
        "                look_at=arc,\n",
        "                bubble_config=dict(width=2, height=1.5)\n",
        "            )\n",
        "        )\n",
        "        self.play(Blink(morty))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class SimpleQuestionTitle(InteractiveScene):\n",
        "    def construct(self):\n",
        "        self.add(get_question_title())\n",
        "\n",
        "\n",
        "class FinalAnswerTitle(InteractiveScene):\n",
        "    def construct(self):\n",
        "        answer = Tex(\"\\\\frac{1}{5}\\\\big(2^{2{,}000} + 4 \\\\cdot 2^{400}\\\\big)\")\n",
        "        self.add(answer)\n",
        "\n",
        "\n",
        "class ComingUpWrapper(VideoWrapper):\n",
        "    title = \"Generating functions\"\n",
        "    wait_time = 0\n",
        "\n",
        "    def construct(self):\n",
        "        super().construct()\n",
        "        self.wait(10)\n",
        "        kw = self.title_config\n",
        "        new_title = OldTexText(\"A Complex trick\".replace(\"C\", \"$\\\\mathds{C}$\"), **kw)\n",
        "        parens = OldTexText(\"(secretly Fourier)\", **kw)\n",
        "        new_title.move_to(self.title_text, DOWN)\n",
        "        new_title.generate_target()\n",
        "        group = VGroup(new_title.target, parens)\n",
        "        group.arrange(RIGHT, MED_LARGE_BUFF)\n",
        "        group.move_to(self.title_text, DOWN)\n",
        "\n",
        "        self.boundary.clear_updaters()\n",
        "        self.play(\n",
        "            FadeOut(self.title_text, UP),\n",
        "            FadeIn(new_title, UP),\n",
        "        )\n",
        "        self.wait(4)\n",
        "        self.play(\n",
        "            Write(parens),\n",
        "            MoveToTarget(new_title)\n",
        "        )\n",
        "        self.wait(10)\n",
        "\n",
        "\n",
        "class IsItHelpful(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.student_says(\n",
        "            \"Is that helpful here?\",\n",
        "            index=2,\n",
        "            added_anims=[LaggedStart(\n",
        "                self.students[0].change(\"confused\", self.screen),\n",
        "                self.students[1].change(\"maybe\", self.screen),\n",
        "                lag_ratio=0.5,\n",
        "            )]\n",
        "        )\n",
        "        self.wait(2)\n",
        "        self.teacher_says(\n",
        "            \"Honestly...\\nnot really.\",\n",
        "            target_mode=\"shruggie\",\n",
        "            added_anims=[self.change_students(\n",
        "                \"sassy\", \"erm\",\n",
        "                look_at=self.teacher.eyes,\n",
        "            )]\n",
        "        )\n",
        "        self.play(self.students[2].change(\"angry\"))\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class AskAboutOrganization(InteractiveScene):\n",
        "    def construct(self):\n",
        "        pass\n",
        "\n",
        "\n",
        "class NoteToPatrons(InteractiveScene):\n",
        "    def construct(self):\n",
        "        morty = Mortimer()\n",
        "        morty.to_corner(DR)\n",
        "        title = Text(\"(Note for patrons)\", font_size=60)\n",
        "        title.to_edge(UP)\n",
        "\n",
        "        self.play(\n",
        "            morty.change(\"raise_right_hand\"),\n",
        "            FadeInFromPoint(title, morty.get_corner(UL)),\n",
        "        )\n",
        "        modes = [\"happy\", \"tease\", \"shruggie\", \"gracious\"]\n",
        "        for x in range(70):\n",
        "            if random.random() < 0.3:\n",
        "                self.play(Blink(morty))\n",
        "            elif random.random() < 0.1:\n",
        "                self.play(morty.change(\n",
        "                    random.choice(modes),\n",
        "                    title,\n",
        "                ))\n",
        "            else:\n",
        "                self.wait()\n",
        "\n",
        "\n",
        "class QuestionMorph(InteractiveScene):\n",
        "    def construct(self):\n",
        "        question = OldTexText(\n",
        "            \"How many subsets are there\\\\\\\\\",\n",
        "            \"with a sum divisible by 5\", \"?\"\n",
        "        )\n",
        "        self.play(Write(question))\n",
        "        self.wait(2)\n",
        "        self.play(\n",
        "            question[1].animate.scale(0.75).set_opacity(0.5).to_corner(DL),\n",
        "            question[2].animate.next_to(question[0], RIGHT, SMALL_BUFF),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class SimpleRect(InteractiveScene):\n",
        "    def construct(self):\n",
        "        rect = Rectangle(2, 0.5)\n",
        "        rect.set_stroke(YELLOW, 2)\n",
        "        self.play(ShowCreation(rect))\n",
        "        self.wait()\n",
        "        self.play(FadeOut(rect))\n",
        "\n",
        "\n",
        "class FirstTrick(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.teacher_says(\n",
        "            \"Here's our\\nfirst trick\",\n",
        "            target_mode=\"tease\",\n",
        "            run_time=1\n",
        "        )\n",
        "        self.play_student_changes(\n",
        "            \"pondering\", \"thinking\", \"sassy\",\n",
        "            look_at=self.screen\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "        # Here\n",
        "        self.student_says(\n",
        "            OldTexText(\"Huh? What is $x$?\"),\n",
        "            index=2,\n",
        "            target_mode=\"confused\",\n",
        "            look_at=self.teacher.eyes,\n",
        "        )\n",
        "        self.play_student_changes(\n",
        "            \"erm\", \"pondering\",\n",
        "            look_at=self.screen,\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class BeyondOurExample(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.teacher_says(\n",
        "            \"Generating functions\\n\"\n",
        "            \"are useful beyond\\n\"\n",
        "            \"our one example.\",\n",
        "            bubble_config=dict(width=4, height=3),\n",
        "            added_anims=[self.change_students(\n",
        "                \"happy\", \"jamming\", \"tease\",\n",
        "                look_at=self.screen,\n",
        "            )]\n",
        "        )\n",
        "        self.wait(3)\n",
        "        self.play(self.teacher.change(\"tease\"))\n",
        "        self.play_student_changes(\"thinking\", \"tease\", \"tease\")\n",
        "        self.wait(2)\n",
        "\n",
        "\n",
        "class MoriaEntrance(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Show\n",
        "        path = SVGMobject(\"mines-of-moria-entrance\")\n",
        "        path.set_height(FRAME_HEIGHT - 1)\n",
        "        outline = path.copy()\n",
        "        outline.set_stroke(WHITE, 2)\n",
        "        outline.set_fill(opacity=0)\n",
        "        outline.insert_n_curves(20)\n",
        "        self.play(\n",
        "            LaggedStartMap(\n",
        "                VShowPassingFlash,\n",
        "                VGroup(*outline.family_members_with_points()),\n",
        "                lag_ratio=0.001,\n",
        "                time_width=1.5,\n",
        "            ),\n",
        "            FadeIn(path),\n",
        "            run_time=5,\n",
        "        )\n",
        "\n",
        "\n",
        "class WaitWhat(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.student_says(\n",
        "            OldTexText(\"Wait...can you\\\\\\\\explain that?\", target_mode=\"confused\"),\n",
        "            added_anims=[\n",
        "                self.teacher.change(\"guilty\"),\n",
        "                self.students[0].change(\"erm\", self.screen),\n",
        "                self.students[1].change(\"maybe\", self.screen),\n",
        "            ]\n",
        "        )\n",
        "        self.wait()\n",
        "        self.look_at(self.screen)\n",
        "        self.play_student_changes(\n",
        "            \"pondering\", \"confused\", \"maybe\",\n",
        "            look_at=self.screen,\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "\n",
        "class HalfTheTotal(InteractiveScene):\n",
        "    def construct(self):\n",
        "        tex = Tex(\n",
        "            \"\\\\frac{1}{2}\\\\Big( 2^{2{,}000} + {0} \\\\Big)\",\n",
        "            tex_to_color_map={\n",
        "                \"2^{2{,}000}\": TEAL,\n",
        "                \"{0}\": TEAL,\n",
        "            },\n",
        "            font_size=60\n",
        "        )\n",
        "        self.play(Write(tex))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class SquaringZeta(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Magnitude\n",
        "        kw = dict(tex_to_color_map={\"\\\\zeta\": YELLOW})\n",
        "        mag = Tex(\"|\\\\zeta^2| = |\\\\zeta|^2 = 1^2 = 1\", **kw)\n",
        "        mag.move_to(2 * UR)\n",
        "\n",
        "        self.play(FadeIn(mag[:4]))\n",
        "        self.play(TransformMatchingShapes(mag[:4].copy(), mag[4:9]))\n",
        "        self.play(TransformMatchingShapes(mag[4:9].copy(), mag[9:12]))\n",
        "        self.play(TransformMatchingShapes(mag[9:12].copy(), mag[12:]))\n",
        "        self.wait()\n",
        "\n",
        "        # Explicit\n",
        "        exp = Tex(\n",
        "            \"\\\\zeta^2 =\"\n",
        "            \"\\\\big(e^{2\\\\pi i / 5}\\\\big)^2 =\"\n",
        "            \"e^{4\\\\pi i / 5}\",\n",
        "            **kw\n",
        "        )\n",
        "        exp.next_to(mag, DOWN, LARGE_BUFF, aligned_edge=LEFT)\n",
        "        rect = SurroundingRectangle(exp[-5:], buff=0.05)\n",
        "        rect.set_stroke(YELLOW, 2)\n",
        "\n",
        "        self.play(FadeIn(exp, lag_ratio=0.1))\n",
        "        self.play(ShowCreation(rect))\n",
        "        self.wait()\n",
        "        self.play(FadeOut(rect))\n",
        "\n",
        "\n",
        "class FifthRootsOfOneOverlay(InteractiveScene):\n",
        "    def construct(self):\n",
        "        lines = [\n",
        "            \"z^5 &= 1 \",\n",
        "            \"z &= \\\\sqrt[5]{1}\",\n",
        "        ]\n",
        "        tex = OldTex(\"\\\\\\\\ \".join(lines), isolate=lines)\n",
        "\n",
        "        self.add(tex[0])\n",
        "        self.wait()\n",
        "        self.play(TransformMatchingShapes(tex[0].copy(), tex[1]))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ObviouslyOne(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        eq = Tex(\"z^5 = 1\", font_size=72)\n",
        "        self.teacher_holds_up(eq)\n",
        "        self.wait()\n",
        "        self.student_says(\n",
        "            OldTexText(\"Obviously $z = 1$!\"), target_mode=\"angry\",\n",
        "            bubble_config=dict(direction=RIGHT),\n",
        "            added_anims=[self.change_students(\"sassy\", \"hesitant\")]\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class EqualsZeta3(InteractiveScene):\n",
        "    def construct(self):\n",
        "        arrow = Vector(0.5 * DOWN)\n",
        "        tex = Tex(\"\\\\zeta^3\", tex_to_color_map={\"\\\\zeta\": YELLOW})\n",
        "        tex.next_to(arrow, DOWN)\n",
        "        self.play(\n",
        "            GrowArrow(arrow),\n",
        "            FadeIn(tex, DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class Roughly2(InteractiveScene):\n",
        "    def construct(self):\n",
        "        self.play(Write(Tex(\"\\\\approx 2\")))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class EvaluateF1(InteractiveScene):\n",
        "    def construct(self):\n",
        "        tex_x = \"f(x) = (1 + x)(1 + x^2)(1 + x^3)(1 + x^4)(1 + x^5)\\\\cdots\\\\left(1 + x^{2{,}000}\\\\right)\"\n",
        "        tex_1 = tex_x.replace(\"x\", \"{1}\")\n",
        "        fx = Tex(tex_x, tex_to_color_map={\"x\": BLUE})\n",
        "        f1 = Tex(tex_1, tex_to_color_map={\"{1}\": GREEN})\n",
        "        f1.match_width(fx)\n",
        "        fx.to_edge(UP)\n",
        "        f1.next_to(fx, DOWN, MED_LARGE_BUFF)\n",
        "\n",
        "        xs = fx.select_parts(\"x\")\n",
        "        ones = f1.select_parts(\"{1}\")\n",
        "        fx_copy = fx.copy().move_to(f1)\n",
        "        fx_copy.select_parts(\"x\").set_opacity(0)\n",
        "\n",
        "        brace = Brace(f1[5:], DOWN, buff=SMALL_BUFF)\n",
        "        brace.stretch(0.5, 1, about_edge=UP)\n",
        "        ans = Tex(\"2^{2{,}000}\")\n",
        "        ans.next_to(brace, DOWN, SMALL_BUFF)\n",
        "\n",
        "        self.add(fx)\n",
        "        self.play(TransformFromCopy(fx, fx_copy))\n",
        "        self.play(Transform(xs.copy(), ones, lag_ratio=0.1, run_time=2, remover=True))\n",
        "        self.remove(fx_copy)\n",
        "        self.add(f1)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            GrowFromCenter(brace),\n",
        "            FadeIn(ans, 0.25 * DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class CoefPoly(InteractiveScene):\n",
        "    def construct(self):\n",
        "        mid_str = \"\".join((f\"c_{{{n}}} x^{{{n}}} + \" for n in range(2, 8)))\n",
        "        self.add(Tex(\n",
        "            \"f(x) = c_0 + c_1 x + \" + mid_str + \"\\\\cdots\",\n",
        "            tex_to_color_map={\"x\": BLUE}\n",
        "        ).to_edge(UP).shift(DOWN))\n",
        "\n",
        "\n",
        "class AskAboutTaylorSeries(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.student_says(\n",
        "            OldTexText(\"Can we use derivatives\\\\\\\\in some way?\"),\n",
        "            bubble_config=dict(width=4, height=3, direction=LEFT),\n",
        "            index=2,\n",
        "        )\n",
        "        self.play(\n",
        "            self.teacher.change(\"tease\"),\n",
        "            self.change_students(\n",
        "                None, \"confused\", \"thinking\",\n",
        "                look_at=self.students[2].bubble,\n",
        "            ),\n",
        "        )\n",
        "        self.wait(4)\n",
        "        self.teacher_says(\n",
        "            \"It's not a\\nbad idea...\",\n",
        "            target_mode=\"hesitant\",\n",
        "        )\n",
        "        self.play_student_changes(\"plain\", \"maybe\", \"pondering\", look_at=self.screen)\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class TantalizinglyClose(InteractiveScene):\n",
        "    def construct(self):\n",
        "        brace = Brace(Line(ORIGIN, 4.5 * RIGHT), DOWN)\n",
        "        brace.to_edge(RIGHT, buff=LARGE_BUFF)\n",
        "        brace.set_y(-2)\n",
        "        words = brace.get_text(\"Tantalizingly close to\\nwhat we want\", font_size=36)\n",
        "        randy = Randolph(height=1.5)\n",
        "        randy.next_to(brace, DL)\n",
        "        randy.shift(0.5 * RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            GrowFromCenter(brace),\n",
        "            FadeIn(randy),\n",
        "        )\n",
        "        self.play(\n",
        "            randy.change(\"hooray\"),\n",
        "            Write(words),\n",
        "        )\n",
        "        self.play(Blink(randy))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStartMap(FadeOut, VGroup(brace, words, randy), shift=DOWN)\n",
        "        )\n",
        "\n",
        "\n",
        "class ToTheComplexPlane(InteractiveScene):\n",
        "    def construct(self):\n",
        "        plane = ComplexPlane()\n",
        "        plane.add_coordinate_labels()\n",
        "        label = Text(\"Complex plane\")\n",
        "        label.to_corner(UL, buff=MED_SMALL_BUFF)\n",
        "        label.set_backstroke(width=10)\n",
        "        poly = Tex(\n",
        "            \"f(x) = (1 + x)(1 + x^2)\\\\cdots\\\\left(1+x^{2{,}000}\\\\right)\",\n",
        "            tex_to_color_map={\"x\": YELLOW}\n",
        "        )\n",
        "        poly.scale(0.75)\n",
        "        poly.next_to(label, DOWN, MED_LARGE_BUFF, LEFT)\n",
        "        poly.set_backstroke(width=8)\n",
        "\n",
        "        self.play(\n",
        "            Write(plane),\n",
        "            Write(label),\n",
        "        )\n",
        "        self.play(FadeIn(poly, DOWN))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class StudentSaysWhat(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        self.student_says(\n",
        "            \"I'm sorry, what?!\",\n",
        "            target_mode=\"angry\"\n",
        "        )\n",
        "        self.play(\n",
        "            self.teacher.change(\"happy\"),\n",
        "            self.change_students(\"confused\", \"sassy\", \"angry\")\n",
        "        )\n",
        "        self.look_at(self.screen)\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class FocusOnPropertiesNotValues(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        morty = self.teacher\n",
        "        kw = dict(\n",
        "            tex_to_color_map={\"\\\\zeta\": YELLOW}\n",
        "        )\n",
        "        words = VGroup(\n",
        "            Tex(\"\\\\text{Don't worry about the}\\\\\\\\ \\\\text{numerical value of } \\\\zeta\", **kw),\n",
        "            Tex(\"\\\\text{Focus on properties}\\\\\\\\ \\\\text{of } \\\\{\\\\zeta^1, \\\\zeta^2, \\\\zeta^3, \\\\zeta^4\\\\, \\\\zeta^5\\\\}\", **kw),\n",
        "        )\n",
        "        words.move_to(self.hold_up_spot, DOWN).shift_onto_screen()\n",
        "\n",
        "        self.play(\n",
        "            morty.change('raise_right_hand'),\n",
        "            self.change_students(\"erm\", \"confused\", \"hesitant\", look_at=words[0]),\n",
        "            FadeIn(words[0], UP)\n",
        "        )\n",
        "        self.wait(3)\n",
        "        self.play(\n",
        "            morty.change(\"hooray\", words[1]),\n",
        "            FadeIn(words[1], UP),\n",
        "            words[0].animate.shift(2.5 * UP),\n",
        "            self.change_students(\"tease\", \"happy\", \"tease\")\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class CanYouComputeThis(InteractiveScene):\n",
        "    def construct(self):\n",
        "        text = Text(\"Can you compute this?\")\n",
        "        text.move_to(2 * RIGHT)\n",
        "        arrow = Arrow(text.get_bottom(), 2 * DOWN)\n",
        "\n",
        "        VGroup(text, arrow).set_color(GREEN_B)\n",
        "\n",
        "        self.play(Write(text), ShowCreation(arrow))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ConjugatePairFact(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Plane\n",
        "        plane = ComplexPlane((-2, 2), (-1, 1))\n",
        "        plane.set_height(3)\n",
        "        plane.to_corner(DR)\n",
        "        plane.add_coordinate_labels([-1, 0, 1, 2, -1j, 1j], font_size=18)\n",
        "        plane.coordinate_labels[-2].set_y(plane.c2p(0, -1)[1] + SMALL_BUFF, DOWN)\n",
        "\n",
        "        # Numbers\n",
        "        z0 = complex(1.5, 0.5)\n",
        "        zs = [z0, z0.conjugate()]\n",
        "        points = [plane.n2p(z) for z in zs]\n",
        "        dots = Group(*(GlowDot(point, color=RED) for point in points))\n",
        "        lines = Line().replicate(2)\n",
        "        lines.set_stroke(RED, 2)\n",
        "        lines.add_updater(lambda ls: [line.put_start_and_end_on(plane.n2p(0), dot.get_center()) for line, dot in zip(ls, dots)])\n",
        "        labels = VGroup(\n",
        "            Tex(\"a + bi\", font_size=24).next_to(points[0], UP, SMALL_BUFF),\n",
        "            Tex(\"a - bi\", font_size=24).next_to(points[1], DOWN, SMALL_BUFF),\n",
        "        )\n",
        "\n",
        "        # Equation\n",
        "        lhs = \"(a + bi)(a - bi)\"\n",
        "        rhs = \"||a + bi|| \\\\cdot ||a - bi||\"\n",
        "        eq = Tex(\n",
        "            lhs + \" = a^2 + b^2 = \" + rhs,\n",
        "            isolate=[lhs, rhs]\n",
        "        )\n",
        "        eq.match_width(plane)\n",
        "        eq.next_to(plane, UP)\n",
        "        lhs_brace = Brace(eq.select_part(lhs), UP, buff=SMALL_BUFF)\n",
        "        rhs_brace = Brace(eq.select_part(rhs), UP, buff=SMALL_BUFF)\n",
        "        lhs_brace.add(lhs_brace.get_text(\"Product\", font_size=30))\n",
        "        rhs_brace.add(rhs_brace.get_text(\"Product of magnitudes\", font_size=30))\n",
        "\n",
        "        lines.update()\n",
        "        self.play(\n",
        "            FadeIn(VGroup(plane, labels), lag_ratio=0.01),\n",
        "            ShowCreation(lines),\n",
        "            FadeIn(dots),\n",
        "        )\n",
        "        self.play(FadeIn(eq, UP))\n",
        "        self.wait()\n",
        "        self.play(Swap(*dots))\n",
        "        self.add(lines)\n",
        "        self.add(dots)\n",
        "        self.wait()\n",
        "        self.play(LaggedStart(\n",
        "            FadeIn(lhs_brace, 0.5 * UP),\n",
        "            FadeIn(rhs_brace, 0.5 * UP),\n",
        "        ))\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class HangInThereRecapPrep(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Hang on\n",
        "        self.play_student_changes(\n",
        "            \"dejected\", \"tired\", \"concerned_musician\",\n",
        "            look_at=self.screen,\n",
        "        )\n",
        "        self.wait(2)\n",
        "        self.teacher_says(\n",
        "            \"Hang in\\nthere!\",\n",
        "            target_mode=\"tease\",\n",
        "            added_anims=[self.change_students(\"plain\", \"tease\", \"hesitant\")]\n",
        "        )\n",
        "        self.wait(4)\n",
        "        self.student_says(\n",
        "            \"Can you recap\\nwhere we are?\",\n",
        "        )\n",
        "        self.play_student_changes(\"confused\", \"thinking\", added_anims=[self.teacher.change(\"happy\")])\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class AskIfItMakesSense(InteractiveScene):\n",
        "    def construct(self):\n",
        "        randy = Randolph(height=2)\n",
        "        randy.to_edge(DOWN)\n",
        "\n",
        "        self.play(PiCreatureBubbleIntroduction(\n",
        "            randy, Text(\"Does this...\\nmake sense?\", font_size=36),\n",
        "            bubble_config=dict(width=3.5, height=2),\n",
        "            target_mode=\"maybe\",\n",
        "        ))\n",
        "        self.play(Blink(randy))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class RootOfUnityRearranging(InteractiveScene):\n",
        "    def construct(self):\n",
        "        kw = dict(tex_to_color_map={\"\\\\zeta\": YELLOW})\n",
        "        expressions = VGroup(\n",
        "            Tex(\"z^5 = 1\", **kw),\n",
        "            Tex(\"z^5 - 1 = 0\", **kw),\n",
        "            Tex(\"z^5 - 1 = (z - \\\\zeta^0)(z - \\\\zeta^1)(z - \\\\zeta^2)(z - \\\\zeta^3)(z - \\\\zeta^4)\", **kw),\n",
        "        )\n",
        "        expressions[:2].scale(1.5, about_edge=UP)\n",
        "        subtexts = VGroup(\n",
        "            Tex(\"\\\\text{Solutions: } \\\\zeta^0,\\\\, \\\\zeta^1,\\\\, \\\\zeta^2,\\\\, \\\\zeta^3,\\\\, \\\\zeta^4\", **kw),\n",
        "            Tex(\"\\\\text{Roots: } \\\\zeta^0,\\\\, \\\\zeta^1,\\\\, \\\\zeta^2,\\\\, \\\\zeta^3,\\\\, \\\\zeta^4\", **kw),\n",
        "        )\n",
        "        subtexts.next_to(expressions, DOWN, LARGE_BUFF)\n",
        "\n",
        "        self.play(FadeIn(expressions[0]))\n",
        "        self.play(Write(subtexts[0]))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformMatchingShapes(*expressions[:2]),\n",
        "            FadeTransform(*subtexts[:2]),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            expressions[1].animate.move_to(expressions[2], LEFT)\n",
        "        )\n",
        "        self.play(\n",
        "            FadeOut(expressions[1][-1]),\n",
        "            FadeTransform(expressions[1][:5], expressions[2][:5]),\n",
        "            TransformMatchingShapes(subtexts[1], expressions[2][5:]),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class RotationalSum(InteractiveScene):\n",
        "    n_iterations = 40\n",
        "\n",
        "    def construct(self):\n",
        "        # Intro\n",
        "        outer_r = 3\n",
        "        inner_r = 2.0\n",
        "        circle = Circle(radius=outer_r)\n",
        "        circle.set_stroke(GREY_B, 2)\n",
        "        points = outer_r * compass_directions(5)\n",
        "        values = VGroup(*(\n",
        "            Integer(0, edge_to_fix=ORIGIN).move_to(point)\n",
        "            for point in points\n",
        "        ))\n",
        "        values[0].edge_to_fix = LEFT\n",
        "        rects = VGroup(*(BackgroundRectangle(v) for v in values))\n",
        "        rects.set_fill(BLACK, 1)\n",
        "\n",
        "        def update_rects(rects):\n",
        "            for rect, value in zip(rects, values):\n",
        "                rect.replace(value, stretch=True)\n",
        "                rect.set_width(value.get_width() + SMALL_BUFF)\n",
        "\n",
        "        rects.add_updater(update_rects)\n",
        "\n",
        "        def update_values(values):\n",
        "            for v in values:\n",
        "                v.set_max_width(1, about_edge=v.edge_to_fix)\n",
        "\n",
        "        values.add_updater(update_values)\n",
        "\n",
        "        values[0].increment_value()\n",
        "\n",
        "        self.add(circle)\n",
        "        self.add(rects, values)\n",
        "\n",
        "        # Add labels\n",
        "        labels = VGroup(*(\n",
        "            OldTexText(f\"sum $\\\\equiv$ {n}\\\\\\\\mod 5\", font_size=30)\n",
        "            for n in range(5)\n",
        "        ))\n",
        "        colors = [YELLOW, *color_gradient([BLUE_B, BLUE_D], 4)]\n",
        "        for label, rect, color in zip(labels, rects, colors):\n",
        "            label.set_fill(color)\n",
        "            label.add_background_rectangle()\n",
        "            # label.next_to(rect, DOWN, SMALL_BUFF)\n",
        "            label.next_to(rect, normalize(rect.get_center()), SMALL_BUFF)\n",
        "        labels[0].next_to(rects[0], DR, SMALL_BUFF)\n",
        "\n",
        "        self.add(labels)\n",
        "\n",
        "        # Corner set\n",
        "        set_tex = get_set_tex([])\n",
        "        set_tex.scale(0.75)\n",
        "        set_tex.to_corner(UL)\n",
        "        set_tex.shift(LEFT)\n",
        "        self.camera.frame.move_to(LEFT)\n",
        "\n",
        "        self.add(set_tex)\n",
        "\n",
        "        # Iterative all\n",
        "        for n in range(1, self.n_iterations + 1):\n",
        "            value_copies = values.copy()\n",
        "            to_add = [0] * 5\n",
        "            for i, vc in enumerate(value_copies):\n",
        "                new_i = (i + n) % 5\n",
        "                vc.move_to((inner_r / outer_r) * points[new_i])\n",
        "                to_add[new_i] = vc.get_value()\n",
        "                vc.target = VectorizedPoint(values[new_i].get_center())\n",
        "                vc.target.set_opacity(0)\n",
        "\n",
        "            reduced_n = n % 5\n",
        "            path_arc = min(reduced_n * TAU / 5, TAU / 3)\n",
        "\n",
        "            rot_label = Text(f\"Add {n}\", font_size=30)\n",
        "            arcs = VGroup(Arc(0, path_arc), Arc(TAU / 2, path_arc))\n",
        "            for arc in arcs:\n",
        "                arc.add_tip(width=0.1, length=0.1)\n",
        "            if reduced_n == 0:\n",
        "                arcs.set_opacity(0)\n",
        "\n",
        "            new_set_tex = get_set_tex([*set_tex.values, n])\n",
        "            new_set_tex.match_height(set_tex)\n",
        "            new_set_tex.move_to(set_tex, LEFT)\n",
        "\n",
        "            self.remove(set_tex)\n",
        "            self.play(\n",
        "                TransformFromCopy(\n",
        "                    values, value_copies,\n",
        "                    path_arc=-path_arc\n",
        "                ),\n",
        "                FadeIn(rot_label),\n",
        "                TransformMatchingTex(\n",
        "                    set_tex, new_set_tex,\n",
        "                    fade_transform_mismatches=(len(set_tex) == len(new_set_tex)),\n",
        "                    remover=True,\n",
        "                ),\n",
        "                *map(ShowCreation, arcs)\n",
        "            )\n",
        "            set_tex = new_set_tex\n",
        "            self.add(set_tex)\n",
        "\n",
        "            self.play(*map(FadeOut, [rot_label, *arcs]))\n",
        "            self.play(\n",
        "                *(\n",
        "                    ChangeDecimalToValue(\n",
        "                        v, v.get_value() + ta, time_span=(0.5, 1),\n",
        "                    )\n",
        "                    for v, ta in zip(values, to_add)\n",
        "                ),\n",
        "                *(\n",
        "                    MoveToTarget(vc, remover=True)\n",
        "                    for v, vc in zip(values, value_copies)\n",
        "                ),\n",
        "            )\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class HighlightAnswerParts(InteractiveScene):\n",
        "    def construct(self):\n",
        "        self.add(get_question_title())\n",
        "\n",
        "        frac = \"\\\\frac{1}{5}\"\n",
        "        e1 = \"2^{2{,}000}\"\n",
        "        e2 = \"4 \\\\cdot 2^{400}\"\n",
        "        answer = Tex(\n",
        "            f\"{frac} \\\\Big({e1} + {e2} \\\\Big)\",\n",
        "            isolate=[frac, e1, e2],\n",
        "            font_size=60\n",
        "        )\n",
        "        answer.move_to(UP)\n",
        "        p1 = VGroup(answer.select_part(frac), answer.select_part(e1))\n",
        "        p2 = answer.select_part(e2)\n",
        "\n",
        "        p1_rect = SurroundingRectangle(p1)\n",
        "        p2_rect = SurroundingRectangle(p2)\n",
        "\n",
        "        self.add(answer)\n",
        "        self.wait()\n",
        "        self.play(ShowCreation(p1_rect))\n",
        "        self.wait()\n",
        "        self.play(ShowCreation(p2_rect), FadeOut(p1_rect))\n",
        "        self.wait()\n",
        "        self.play(FadeOut(p2_rect))\n",
        "\n",
        "\n",
        "class ReferenceZetaPromise(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        morty = self.teacher\n",
        "        ss = self.students\n",
        "        self.student_says(\n",
        "            OldTexText(\"Didn't you once promise\\\\\\\\a video about $\\\\zeta(s)$ and primes?\"),\n",
        "            target_mode=\"sassy\",\n",
        "            index=0,\n",
        "            added_anims=[\n",
        "                ss[1].change(\"hesitant\"),\n",
        "                ss[2].change(\"angry\"),\n",
        "            ]\n",
        "        )\n",
        "        self.play(morty.change(\"guilty\"))\n",
        "        self.wait(3)\n",
        "        self.play(\n",
        "            RemovePiCreatureBubble(ss[0], target_mode=\"pondering\", look_at=self.screen),\n",
        "            ss[1].change(\"pondering\", self.screen),\n",
        "            ss[2].change(\"thinking\", self.screen),\n",
        "            morty.change(\"raise_right_hand\", self.screen)\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class FactorLargeInteger(InteractiveScene):\n",
        "    def construct(self):\n",
        "        p_value = 314159265359\n",
        "        q_value = 271828182863\n",
        "        p, q, N = [\n",
        "            Tex(\"{:,}\".format(value).replace(\",\", \"{,}\"))\n",
        "            for value in (p_value, q_value, p_value * q_value)\n",
        "        ]\n",
        "        p.set_color(TEAL)\n",
        "        q.set_color(BLUE)\n",
        "        N.to_edge(UP)\n",
        "        eq = Tex(\"=\", font_size=72).rotate(90 * DEGREES)\n",
        "        eq.next_to(N, DOWN)\n",
        "        prod = VGroup(p, Tex('\\\\times'), q)\n",
        "        prod.arrange(RIGHT, buff=MED_SMALL_BUFF)\n",
        "        prod.next_to(eq, DOWN)\n",
        "\n",
        "        self.play(FadeIn(N))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                TransformMatchingShapes(N.copy(), p.copy()),\n",
        "                Write(prod[1]),\n",
        "                TransformMatchingShapes(N.copy(), q.copy()),\n",
        "                lag_ratio=0.5,\n",
        "            )\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class WriteDFTMatrix(InteractiveScene):\n",
        "    def construct(self):\n",
        "        matrix = Tex(r\"\"\"\\frac{1}{\\sqrt{N}}\\left[\\begin{array}{cccccc}\n",
        "            1 & 1 & 1 & 1 & \\cdots & 1 \\\\\n",
        "            1 & \\zeta & \\zeta^{2} & \\zeta^{3} & \\cdots & \\zeta^{N-1} \\\\\n",
        "            1 & \\zeta^{2} & \\zeta^{4} & \\zeta^{6} & \\cdots & \\zeta^{2(N-1)} \\\\\n",
        "            1 & \\zeta^{3} & \\zeta^{6} & \\zeta^{9} & \\cdots & \\zeta^{3(N-1)} \\\\\n",
        "            \\vdots & \\vdots & \\vdots & \\vdots & \\ddots & \\vdots \\\\\n",
        "            1 & \\zeta^{N-1} & \\zeta^{2(N-1)} & \\zeta^{3(N-1)} & \\cdots & \\zeta^{(N-1)(N-1)}\n",
        "            \\end{array}\\right] \"\"\"\n",
        "        )\n",
        "        self.play(Write(matrix, lag_ratio=0.05, run_time=5))\n",
        "\n",
        "\n",
        "class FourierSeriesWrapper(VideoWrapper):\n",
        "    title = \"Fourier series\"\n",
        "    wait_time = 4\n",
        "\n",
        "\n",
        "class GeneratingfunctionologyTitle(InteractiveScene):\n",
        "    def construct(self):\n",
        "        title = Text(\"Generatingfunctionology\", font_size=60)\n",
        "        author = Text(\"by Herbert Wilf\")\n",
        "        author.next_to(title, DOWN, MED_LARGE_BUFF, LEFT)\n",
        "        author.set_color(GREY_B)\n",
        "\n",
        "        self.play(Write(title))\n",
        "        self.play(FadeIn(author, LEFT))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class EndScreen(PatreonEndScreen):\n",
        "    pass\n",
        "\n",
        "\n",
        "class Thumbnail(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add plane\n",
        "        plane = ComplexPlane(\n",
        "            (-3, 3), (-3, 3),\n",
        "            background_line_style=dict(stroke_color=BLUE_D, stroke_width=3),\n",
        "            faded_line_ratio=1,\n",
        "            axis_config=dict(stroke_color=GREY_B),\n",
        "        )\n",
        "        plane.set_width(FRAME_WIDTH)\n",
        "        plane.scale(1.2)\n",
        "        # plane.move_to(0.75 * DOWN)\n",
        "        # plane.add_coordinate_labels(font_size=24)\n",
        "\n",
        "        circle = Circle(radius=get_norm(plane.n2p(1) - plane.n2p(0)))\n",
        "        circle.move_to(plane.n2p(0))\n",
        "        circle.set_stroke(WHITE, 2)\n",
        "\n",
        "        points = [plane.n2p(np.exp(complex(0, angle))) for angle in np.arange(0, TAU, TAU / 5)]\n",
        "        glow_dots = GlowDots(points, radius=0.5)\n",
        "        dots = DotCloud(points, radius=0.05, color=YELLOW)\n",
        "        lines = VGroup(*(Line(plane.n2p(0), point) for point in points))\n",
        "        lines.set_stroke(YELLOW, 4)\n",
        "\n",
        "        self.add(plane)\n",
        "        self.add(circle)\n",
        "        self.add(lines)\n",
        "        self.add(dots)\n",
        "        self.add(glow_dots)\n",
        "\n",
        "        # Question\n",
        "        st = \"$\\\\big\\\\{1,\\\\dots, 2000\\\\big\\\\}$\"\n",
        "        question = OldTexText(\n",
        "            f\"How many subsets of {st}\\\\\\\\\", \"have a sum divisible by 5?\",\n",
        "            tex_to_color_map={st: TEAL}\n",
        "        )\n",
        "        question.set_backstroke(BLACK, width=20)\n",
        "        # question.set_width(FRAME_WIDTH - 0.5)\n",
        "        question.set_width(FRAME_WIDTH - 3.5)\n",
        "        question.to_edge(UP, buff=0.25)\n",
        "        br = VGroup(BackgroundRectangle(question[:2], buff=SMALL_BUFF), BackgroundRectangle(question[2], buff=SMALL_BUFF))\n",
        "        br.set_fill(BLACK, 2)\n",
        "        # self.add(br, question)\n",
        "\n",
        "        # Complex\n",
        "\n",
        "        words = Text(\"Use complex numbers of course...\", color=YELLOW)\n",
        "        words.set_backstroke(width=20)\n",
        "        # words.add_background_rectangle(opacity=0.95, buff=MED_SMALL_BUFF)\n",
        "        words.set_width(FRAME_WIDTH / 2 - 0.1)\n",
        "        words.to_corner(DL, buff=SMALL_BUFF)\n",
        "        # self.add(words)\n",
        "        # self.wait()\n",
        "\n",
        "\n",
        "class AltThumbnail(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Organize sets\n",
        "        subsets = [\n",
        "            subset\n",
        "            for subset in get_subsets(range(1, 10))\n",
        "            if sum(subset) % 5 == 0\n",
        "        ]\n",
        "        n_shown = 28\n",
        "        shown_sets = VGroup(*(get_set_tex(ss) for ss in subsets[:n_shown]))\n",
        "        shown_sets.arrange(DOWN, aligned_edge=LEFT)\n",
        "        shown_sets[n_shown // 2:].next_to(shown_sets[:n_shown // 2], RIGHT, MED_LARGE_BUFF)\n",
        "        shown_sets.refresh_bounding_box()\n",
        "        shown_sets.set_height(FRAME_HEIGHT - 1)\n",
        "        shown_sets.center().to_edge(LEFT)\n",
        "\n",
        "        dots = OldTex(\"\\\\vdots\")\n",
        "        dots.replace(shown_sets[-1], dim_to_match=1)\n",
        "        shown_sets.replace_submobject(-1, dots)\n",
        "\n",
        "        self.add(shown_sets)\n",
        "\n",
        "        # Phrase\n",
        "        text = Text(\"Use complex numbers\", font_size=90)\n",
        "        text.set_color(YELLOW)\n",
        "        text.set_x(2)\n",
        "        text.to_edge(UP)\n",
        "        text.set_backstroke(width=20)\n",
        "\n",
        "        subtext = Text(\"...of course\")\n",
        "        subtext.next_to(text, DOWN, buff=MED_LARGE_BUFF, aligned_edge=RIGHT)\n",
        "\n",
        "        self.add(text)\n",
        "        self.add(subtext)\n",
        "\n",
        "        # Unit circle\n",
        "        plane = ComplexPlane(\n",
        "            (-2, 2), (-2, 2),\n",
        "            background_line_style=dict(stroke_color=BLUE_D, stroke_width=3),\n",
        "            faded_line_ratio=1,\n",
        "            axis_config=dict(stroke_color=GREY_B),\n",
        "        )\n",
        "        plane.set_width(9.5)\n",
        "        plane.match_x(text)\n",
        "        plane.to_edge(UP, buff=0)\n",
        "\n",
        "        circle = Circle(radius=get_norm(plane.n2p(1) - plane.n2p(0)))\n",
        "        circle.move_to(plane.n2p(0))\n",
        "        circle.set_stroke(WHITE, 2)\n",
        "\n",
        "        points = [plane.n2p(np.exp(complex(0, angle))) for angle in np.arange(0, TAU, TAU / 5)]\n",
        "        glow_dots = GlowDots(points, radius=0.5)\n",
        "        dots = DotCloud(points, radius=0.05, color=YELLOW)\n",
        "        lines = VGroup(*(Line(plane.n2p(0), point) for point in points))\n",
        "        lines.set_stroke(YELLOW, 4)\n",
        "\n",
        "        self.add(plane)\n",
        "        self.add(circle)\n",
        "        self.add(lines)\n",
        "        self.add(dots)\n",
        "        self.add(glow_dots)\n",
        "        self.add(text, subtext)\n"
    ]
}