{
    "topic": "demonstrates the concept of a prime number race, where two teams compete to find prime",
    "code": [
        "from manim_imports_ext import *\n",
        "import sympy\n",
        "\n",
        "\n",
        "class PrimeRace(InteractiveScene):\n",
        "    race_length = 26863\n",
        "\n",
        "    def construct(self):\n",
        "        ONE_COLOR = BLUE\n",
        "        THREE_COLOR = RED\n",
        "        colors = [ONE_COLOR, THREE_COLOR]\n",
        "\n",
        "        # Labels\n",
        "        labels = VGroup(\n",
        "            Tex(R\"p \\equiv 1 \\mod 4\", t2c={\"1\": ONE_COLOR}),\n",
        "            Tex(R\"p \\equiv 3 \\mod 4\", t2c={\"3\": THREE_COLOR}),\n",
        "        )\n",
        "        labels.arrange(DOWN, buff=0.75)\n",
        "        labels.to_edge(LEFT)\n",
        "\n",
        "        h_line = Line(LEFT, RIGHT)\n",
        "        h_line.set_width(100)\n",
        "        h_line.to_edge(LEFT)\n",
        "\n",
        "        v_line = Line(UP, DOWN)\n",
        "        v_line.set_height(1.5 * labels.get_height())\n",
        "        v_line.next_to(labels, RIGHT)\n",
        "        v_line.set_y(0)\n",
        "        VGroup(h_line, v_line).set_stroke(width=2)\n",
        "\n",
        "        self.add(h_line, v_line)\n",
        "        self.add(labels)\n",
        "\n",
        "        # Start the race\n",
        "        primes: list[int] = list(sympy.primerange(3, self.race_length))\n",
        "        team1 = VGroup()\n",
        "        team3 = VGroup()\n",
        "        teams = [team1, team3]\n",
        "        blocks = []\n",
        "        for prime in primes:\n",
        "            index = int((prime % 4) == 3)\n",
        "            square = Square(side_length=1)\n",
        "            square.set_fill(colors[index], 0.5)\n",
        "            square.set_stroke(colors[index], 1.0)\n",
        "            p_mob = Integer(prime)\n",
        "            p_mob.set_max_width(0.8 * square.get_width())\n",
        "            block = VGroup(square, p_mob)\n",
        "\n",
        "            teams[index].add(block)\n",
        "            blocks.append(block)\n",
        "\n",
        "        for team, label in zip(teams, labels):\n",
        "            team.arrange(RIGHT, buff=0)\n",
        "            team.next_to(v_line, RIGHT, buff=SMALL_BUFF)\n",
        "            team.match_y(label)\n",
        "\n",
        "        h_line.set_width(teams[1].get_width() + 10, about_edge=LEFT)\n",
        "\n",
        "        for block in blocks[:10]:\n",
        "            self.play(FadeIn(block[0]), Write(block[1]))\n",
        "\n",
        "        # Next sets\n",
        "        frame = self.frame\n",
        "        frame.target = frame.generate_target()\n",
        "        frame.target.scale(1.75, about_edge=LEFT)\n",
        "        self.play(\n",
        "            LaggedStartMap(\n",
        "                FadeIn, VGroup(*blocks[10:30]),\n",
        "                lag_ratio=0.9,\n",
        "            ),\n",
        "            MoveToTarget(frame, rate_func=rush_into),\n",
        "            run_time=12,\n",
        "        )\n",
        "\n",
        "        # Last set\n",
        "        curr = 30\n",
        "        tups = [\n",
        "            (200, 10, linear, 1.25),\n",
        "            (len(blocks) - 100, 60, linear, 1.25),\n",
        "            (len(blocks) - 1, 5, smooth, 0.8)\n",
        "        ]\n",
        "\n",
        "        for index, rt, func, sf in tups:\n",
        "            frame.target = frame.generate_target()\n",
        "            frame.target.scale(sf)\n",
        "            frame.target.set_x(blocks[index].get_right()[0] + 1)\n",
        "            self.play(\n",
        "                ShowIncreasingSubsets(VGroup(*blocks[curr:index])),\n",
        "                MoveToTarget(frame),\n",
        "                run_time=rt,\n",
        "                rate_func=func,\n",
        "            )\n",
        "            curr = index\n",
        "\n",
        "        blocks = VGroup(*blocks)\n",
        "        self.add(blocks)\n",
        "        self.play(frame.animate.set_height(8, about_point=blocks.get_right() + 2 * LEFT), run_time=3)\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class RaceGraph(InteractiveScene):\n",
        "    race_length = 26863\n",
        "    y_range = (-4, 30, 2)\n",
        "\n",
        "    def construct(self):\n",
        "        # Compute differences\n",
        "        primes: list[int] = list(sympy.primerange(3, self.race_length))\n",
        "        diffs = [0]\n",
        "        colors = [WHITE]\n",
        "        y_max = self.y_range[1]\n",
        "        for p in primes:\n",
        "            diff = diffs[-1] + (p % 4 - 2)\n",
        "            diffs.append(diff)\n",
        "            if diff < 0:\n",
        "                colors.append(BLUE)\n",
        "            elif diff < y_max / 2:\n",
        "                colors.append(interpolate_color(WHITE, RED, clip(2 * diff / y_max, 0, 1)))\n",
        "            else:\n",
        "                colors.append(interpolate_color(RED, RED_E, clip(2 * (diff - y_max / 2) / y_max, 0, 1)))\n",
        "\n",
        "        # Axes and graph\n",
        "        x_unit = 10\n",
        "        axes = Axes(\n",
        "            x_range=(0, len(primes) + 10, x_unit),\n",
        "            y_range=self.y_range,\n",
        "            width=len(primes) / x_unit / 1.6,\n",
        "            height=7,\n",
        "            axis_config=dict(tick_size=0.05),\n",
        "        )\n",
        "        axes.to_edge(LEFT, buff=0.8)\n",
        "\n",
        "        y_label = TexText(R\"\\#Team3 $-$ \\#Team1\")\n",
        "        y_label[\"Team3\"].set_color(RED)\n",
        "        y_label[\"Team1\"].set_color(BLUE)\n",
        "        y_label.next_to(axes.y_axis.get_top(), RIGHT)\n",
        "        y_label.fix_in_frame()\n",
        "\n",
        "        axes.y_axis.add_numbers(font_size=14, buff=0.15)\n",
        "\n",
        "        graph = VMobject()\n",
        "        graph.set_points_as_corners([\n",
        "            axes.c2p(i, diff)\n",
        "            for i, diff in enumerate(diffs)\n",
        "        ])\n",
        "        graph.set_stroke(colors, width=3)\n",
        "\n",
        "        self.add(axes)\n",
        "        self.add(y_label)\n",
        "        self.add(graph)\n",
        "\n",
        "        # Set blocking rectangle\n",
        "        rect = FullScreenRectangle()\n",
        "        rect.set_fill(BLACK, 1)\n",
        "        rect.set_stroke(BLACK, 0)\n",
        "        rect.match_x(axes.c2p(0, 0), LEFT)\n",
        "\n",
        "        def set_x_shift(x, anims=[], **kwargs):\n",
        "            self.play(\n",
        "                rect.animate.match_x(axes.c2p(x, 0), LEFT),\n",
        "                *anims,\n",
        "                **kwargs\n",
        "            )\n",
        "\n",
        "        self.clear()\n",
        "        self.add(graph, rect, axes.x_axis, axes.y_axis, y_label)\n",
        "\n",
        "        # First blocks, total runtime should be 12\n",
        "        frame = self.frame\n",
        "        frame.save_state()\n",
        "        zoom_point = axes.c2p(0, 0)\n",
        "        frame.set_height(3, about_point=zoom_point)\n",
        "\n",
        "        for x in range(10):\n",
        "            set_x_shift(x + 1)\n",
        "\n",
        "        for x in range(10, 30):\n",
        "            set_x_shift(x + 1, run_time = 6 / 20)\n",
        "            self.wait(6 / 20)\n",
        "\n",
        "        # Next block\n",
        "        set_x_shift(\n",
        "            200,\n",
        "            anims=[Restore(frame)],\n",
        "            run_time=10, rate_func=linear\n",
        "        )\n",
        "\n",
        "        # Squish the graph\n",
        "        full_width = get_norm(axes.c2p(200, 0) - axes.c2p(0, 0))\n",
        "        origin = axes.c2p(0, 0)\n",
        "\n",
        "        prime_label = Integer(primes[200])\n",
        "        prime_label.next_to(rect, LEFT, buff=0.7)\n",
        "        prime_label.to_edge(DOWN, buff=0.3)\n",
        "        prime_label.fix_in_frame()\n",
        "        self.add(prime_label)\n",
        "\n",
        "        def set_x_squish(x1, x2, **kwargs):\n",
        "            group = VGroup(axes.x_axis, graph)\n",
        "            self.add(group, rect)\n",
        "\n",
        "            self.play(\n",
        "                UpdateFromAlphaFunc(\n",
        "                    group,\n",
        "                    lambda m, a: m.stretch(\n",
        "                        full_width / get_norm(axes.c2p(interpolate(x1, x2, a), 0) - origin),\n",
        "                        0,\n",
        "                        about_point=origin,\n",
        "                    ),\n",
        "                ),\n",
        "                UpdateFromAlphaFunc(\n",
        "                    prime_label,\n",
        "                    lambda m, a: m.set_value(\n",
        "                        primes[min(int(interpolate(x1, x2, a)), len(primes) - 1)]\n",
        "                    )\n",
        "                ),\n",
        "                **kwargs\n",
        "            )\n",
        "\n",
        "        set_x_squish(200, len(primes) - 100, rate_func=linear, run_time=60)\n",
        "        set_x_squish(len(primes) - 100, len(primes), rate_func=smooth, run_time=5)\n",
        "\n",
        "        # Reset frame\n",
        "        self.play(\n",
        "            VGroup(axes, graph).animate.set_width(\n",
        "                len(primes) / 10, about_point=axes.c2p(len(primes), 0), stretch=True\n",
        "            ),\n",
        "            FadeOut(rect),\n",
        "            run_time=6,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "\n",
        "class LongRaceGraph(RaceGraph):\n",
        "    race_length = 650000\n",
        "    y_range = (-10, 100, 5)\n"
    ]
}