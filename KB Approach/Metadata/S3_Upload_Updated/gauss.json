{
    "topic": "demonstrates the process of row reduction in a matrix, specifically using the Gauss-",
    "code": [
        "from fractions import Fraction\n",
        "\n",
        "from manim_imports_ext import *\n",
        "from functools import reduce\n",
        "\n",
        "\n",
        "class FractionMobject(VGroup):\n",
        "    CONFIG = {\n",
        "        \"max_height\": 1,\n",
        "    }\n",
        "\n",
        "    def __init__(self, fraction, **kwargs):\n",
        "        VGroup.__init__(self, **kwargs)\n",
        "        numerator = self.numerator = Integer(fraction.numerator)\n",
        "        self.add(numerator)\n",
        "        if fraction.denominator != 1:\n",
        "            denominator = Integer(fraction.denominator)\n",
        "            line = OldTex(\"/\")\n",
        "            numerator.next_to(line, LEFT, SMALL_BUFF)\n",
        "            denominator.next_to(line, RIGHT, SMALL_BUFF)\n",
        "            self.add(numerator, line, denominator)\n",
        "        self.set_height(min(self.max_height, self.get_height()))\n",
        "        self.value = fraction\n",
        "\n",
        "    def add_plus_if_needed(self):\n",
        "        if self.value > 0:\n",
        "            plus = OldTex(\"+\")\n",
        "            plus.next_to(self, LEFT, SMALL_BUFF)\n",
        "            plus.match_color(self)\n",
        "            self.add_to_back(plus)\n",
        "\n",
        "\n",
        "class ShowRowReduction(Scene):\n",
        "    CONFIG = {\n",
        "        \"matrices\": [\n",
        "            [\n",
        "                [2, -1, -1],\n",
        "                [0, 3, -4],\n",
        "                [-3, 2, 1],\n",
        "            ],\n",
        "            [\n",
        "                [1, 0, 0],\n",
        "                [0, 1, 0],\n",
        "                [0, 0, 1],\n",
        "            ],\n",
        "            # [[1], [2], [3]],\n",
        "        ],\n",
        "        \"h_spacing\": 2,\n",
        "        \"extra_h_spacing\": 0.5,\n",
        "        \"v_spacing\": 1,\n",
        "        \"include_separation_lines\": True,\n",
        "        \"changing_row_color\": YELLOW,\n",
        "        \"reference_row_color\": BLUE,\n",
        "    }\n",
        "\n",
        "    def construct(self):\n",
        "        self.initialize_terms()\n",
        "\n",
        "        self.apply_row_rescaling(0, Fraction(1, 2))\n",
        "        self.add_row_multiple_to_row(2, 0, 3)\n",
        "        self.apply_row_rescaling(1, Fraction(1, 3))\n",
        "        self.add_row_multiple_to_row(2, 1, Fraction(-1, 2))\n",
        "        self.apply_row_rescaling(2, Fraction(6))\n",
        "        self.add_row_multiple_to_row(0, 1, Fraction(1, 2))\n",
        "        self.add_row_multiple_to_row(0, 2, Fraction(7, 6))\n",
        "        self.add_row_multiple_to_row(1, 2, Fraction(4, 3))\n",
        "        self.wait()\n",
        "\n",
        "    def initialize_terms(self):\n",
        "        full_matrix = reduce(\n",
        "            lambda m, v: np.append(m, v, axis=1),\n",
        "            self.matrices\n",
        "        )\n",
        "        mobject_matrix = np.vectorize(FractionMobject)(full_matrix)\n",
        "        rows = self.rows = VGroup(*it.starmap(VGroup, mobject_matrix))\n",
        "        for i, row in enumerate(rows):\n",
        "            for j, term in enumerate(row):\n",
        "                term.move_to(\n",
        "                    i * self.v_spacing * DOWN +\n",
        "                    j * self.h_spacing * RIGHT\n",
        "                )\n",
        "\n",
        "        # Visually seaprate distinct parts\n",
        "        separation_lines = self.separation_lines = VGroup()\n",
        "        lengths = [len(m[0]) for m in self.matrices]\n",
        "        for partial_sum in np.cumsum(lengths)[:-1]:\n",
        "            VGroup(*mobject_matrix[:, partial_sum:].flatten()).shift(\n",
        "                self.extra_h_spacing * RIGHT\n",
        "            )\n",
        "            c1 = VGroup(*mobject_matrix[:, partial_sum - 1])\n",
        "            c2 = VGroup(*mobject_matrix[:, partial_sum])\n",
        "            line = DashedLine(c1.get_top(), c1.get_bottom())\n",
        "            line.move_to(VGroup(c1, c2))\n",
        "            separation_lines.add(line)\n",
        "\n",
        "        if self.include_separation_lines:\n",
        "            group = VGroup(rows, separation_lines)\n",
        "        else:\n",
        "            group = rows\n",
        "        group.center().to_edge(DOWN, buff=2)\n",
        "        self.add(group)\n",
        "\n",
        "    def add_variables(self):\n",
        "        # If it is meant to represent a system of equations\n",
        "        pass\n",
        "\n",
        "    def apply_row_rescaling(self, row_index, scale_factor):\n",
        "        row = self.rows[row_index]\n",
        "        new_row = VGroup()\n",
        "        for element in row:\n",
        "            target = FractionMobject(element.value * scale_factor)\n",
        "            target.move_to(element)\n",
        "            new_row.add(target)\n",
        "        new_row.set_color(self.changing_row_color)\n",
        "\n",
        "        label = VGroup(\n",
        "            OldTex(\"r_%d\" % (row_index + 1)),\n",
        "            OldTex(\"\\\\rightarrow\"),\n",
        "            OldTex(\"(\"),\n",
        "            FractionMobject(scale_factor),\n",
        "            OldTex(\")\"),\n",
        "            OldTex(\"r_%d\" % (row_index + 1)),\n",
        "        )\n",
        "        label.arrange(RIGHT, buff=SMALL_BUFF)\n",
        "        label.to_edge(UP)\n",
        "        VGroup(label[0], label[-1]).set_color(self.changing_row_color)\n",
        "\n",
        "        scalar_mob = FractionMobject(scale_factor)\n",
        "        scalar_mob.add_to_back(\n",
        "            OldTex(\"\\\\times\").next_to(scalar_mob, LEFT, SMALL_BUFF)\n",
        "        )\n",
        "        scalar_mob.scale(0.5)\n",
        "        scalar_mob.next_to(row[0], DR, SMALL_BUFF)\n",
        "\n",
        "        # Do do, fancier illustrations here\n",
        "        self.play(\n",
        "            FadeIn(label),\n",
        "            row.set_color, self.changing_row_color,\n",
        "        )\n",
        "        self.play(FadeIn(scalar_mob))\n",
        "        for elem, new_elem in zip(row, new_row):\n",
        "            self.play(scalar_mob.next_to, elem, DR, SMALL_BUFF)\n",
        "            self.play(ReplacementTransform(elem, new_elem, path_arc=30 * DEGREES))\n",
        "        self.play(FadeOut(scalar_mob))\n",
        "        self.play(new_row.set_color, WHITE)\n",
        "        self.play(FadeOut(label))\n",
        "        self.rows.submobjects[row_index] = new_row\n",
        "\n",
        "    def add_row_multiple_to_row(self, row1_index, row2_index, scale_factor):\n",
        "        row1 = self.rows[row1_index]\n",
        "        row2 = self.rows[row2_index]\n",
        "        new_row1 = VGroup()\n",
        "        scaled_row2 = VGroup()\n",
        "        for elem1, elem2 in zip(row1, row2):\n",
        "            target = FractionMobject(elem1.value + scale_factor * elem2.value)\n",
        "            target.move_to(elem1)\n",
        "            new_row1.add(target)\n",
        "\n",
        "            scaled_term = FractionMobject(scale_factor * elem2.value)\n",
        "            scaled_term.move_to(elem2)\n",
        "            scaled_row2.add(scaled_term)\n",
        "        new_row1.set_color(self.changing_row_color)\n",
        "        scaled_row2.set_color(self.reference_row_color)\n",
        "\n",
        "        for elem1, elem2 in zip(row1, scaled_row2):\n",
        "            elem2.add_plus_if_needed()\n",
        "            elem2.scale(0.5)\n",
        "            elem2.next_to(elem1, UL, buff=SMALL_BUFF)\n",
        "\n",
        "        label = VGroup(\n",
        "            OldTex(\"r_%d\" % (row1_index + 1)),\n",
        "            OldTex(\"\\\\rightarrow\"),\n",
        "            OldTex(\"r_%d\" % (row1_index + 1)),\n",
        "            OldTex(\"+\"),\n",
        "            OldTex(\"(\"),\n",
        "            FractionMobject(scale_factor),\n",
        "            OldTex(\")\"),\n",
        "            OldTex(\"r_%d\" % (row2_index + 1)),\n",
        "        )\n",
        "        label.arrange(RIGHT, buff=SMALL_BUFF)\n",
        "        label.to_edge(UP)\n",
        "        VGroup(label[0], label[2]).set_color(self.changing_row_color)\n",
        "        label[-1].set_color(self.reference_row_color)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(label),\n",
        "            row1.set_color, self.changing_row_color,\n",
        "            row2.set_color, self.reference_row_color,\n",
        "        )\n",
        "        row1.target.next_to(self.rows, UP, buff=2)\n",
        "        row1.target.align_to(row1, LEFT)\n",
        "\n",
        "        row2.target.next_to(row1.target, DOWN, buff=MED_LARGE_BUFF)\n",
        "        lp, rp = row2_parens = OldTex(\"()\")\n",
        "        row2_parens.set_height(row2.get_height() + 2 * SMALL_BUFF)\n",
        "        lp.next_to(row2, LEFT, SMALL_BUFF)\n",
        "        rp.next_to(row2, RIGHT, SMALL_BUFF)\n",
        "        scalar = FractionMobject(scale_factor)\n",
        "        scalar.next_to(lp, LEFT, SMALL_BUFF)\n",
        "        scalar.add_plus_if_needed()\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(row2_parens),\n",
        "            Write(scalar),\n",
        "        )\n",
        "        self.play(ReplacementTransform(row2.copy(), scaled_row2))\n",
        "        self.wait()\n",
        "        for elem, new_elem, s_elem in zip(row1, new_row1, scaled_row2):\n",
        "            self.play(\n",
        "                FadeOut(elem),\n",
        "                FadeIn(new_elem),\n",
        "                Transform(s_elem, new_elem.copy().fade(1), remover=True)\n",
        "            )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(label),\n",
        "            FadeOut(row2_parens),\n",
        "            FadeOut(scalar),\n",
        "            new_row1.set_color, WHITE,\n",
        "            row2.set_color, WHITE,\n",
        "        )\n",
        "        self.rows.submobjects[row1_index] = new_row1\n"
    ]
}