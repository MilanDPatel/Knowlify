{
    "topic": "demonstrates the concept of a die distribution and its corresponding probability distribution.",
    "code": [
        "from manim_imports_ext import *\n",
        "from _2023.clt.main import *\n",
        "\n",
        "# Dice Simulations\n",
        "\n",
        "\n",
        "class DiceSimulation(InteractiveScene):\n",
        "    n_dice = 10\n",
        "    n_samples = 3000\n",
        "    distribution = [1 / 6] * 6\n",
        "    die_distribution_config = dict(\n",
        "        axes_config=dict(width=3.5, height=1.5),\n",
        "        y_range=(0, 0.5, 0.25),\n",
        "    )\n",
        "    brick_height = 0.2\n",
        "    initial_brick_color = YELLOW\n",
        "    full_dist_color = GREEN_D\n",
        "    spread = 22\n",
        "    dice_width = 5\n",
        "\n",
        "    def setup(self):\n",
        "        super().setup()\n",
        "        self.add_die_distribution()\n",
        "        self.add_sum_axes()\n",
        "        self.add_sample_label()\n",
        "        self.buckets = dict()\n",
        "        self.all_bricks = VGroup()\n",
        "\n",
        "    def construct(self):\n",
        "        # Slow samples\n",
        "        for _ in range(3):\n",
        "            self.run_one_sum()\n",
        "\n",
        "        # Speedier samples\n",
        "        for _ in range(10):\n",
        "            self.run_one_sum(run_time=0.5, transition_time=0.5)\n",
        "\n",
        "        # First few instant samples\n",
        "        for _ in range(200):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "        # Thousands of samples\n",
        "        self.scale_brick_height(0.1)\n",
        "        for _ in range(self.n_samples - int(self.sample_label.count.get_value())):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "        self.play(self.all_bricks.animate.set_fill(color=self.full_dist_color))\n",
        "\n",
        "    def add_die_distribution(self, animate=False):\n",
        "        die_dist = get_die_distribution_chart(\n",
        "            self.distribution,\n",
        "            **self.die_distribution_config,\n",
        "        )\n",
        "        die_dist.to_corner(UL)\n",
        "        die_dist.shift(0.25 * DOWN)\n",
        "\n",
        "        axes, bars, dice = die_dist\n",
        "\n",
        "        if animate:\n",
        "            self.play(\n",
        "                Write(axes),\n",
        "                LaggedStartMap(GrowFromEdge, bars, edge=DOWN),\n",
        "                Write(dice),\n",
        "            )\n",
        "\n",
        "        self.add(die_dist)\n",
        "\n",
        "        self.die_dist = die_dist\n",
        "\n",
        "    def add_sum_axes(self):\n",
        "        # (Value, probability) pairs\n",
        "        vps = list(zip(it.count(1), self.distribution))\n",
        "        mu = sum(v * p for v, p in vps)\n",
        "        var = sum(p * (v - mu)**2 for v, p in vps)\n",
        "\n",
        "        n = self.n_dice\n",
        "        x_mid = int(n * mu)\n",
        "        spread = self.spread or int(2.5 * math.sqrt(var * n))\n",
        "\n",
        "        x_range = (x_mid - spread, x_mid + spread, 1)\n",
        "        axes = Axes(\n",
        "            x_range,\n",
        "            (0, int(math.sqrt(self.n_samples))),\n",
        "            width=FRAME_WIDTH - 1,\n",
        "            height=4,\n",
        "        )\n",
        "\n",
        "        # dots = Tex(R\"\\dots\", font_size=24)\n",
        "        # dots.next_to(axes.x_axis, LEFT, SMALL_BUFF)\n",
        "        # axes.y_axis.set_x(dots.get_left()[0] - SMALL_BUFF)\n",
        "        # axes.add(dots)\n",
        "\n",
        "        x_axis = axes.x_axis\n",
        "        x_axis.add_numbers(font_size=16)\n",
        "        x_axis.numbers.remove(x_axis.numbers[-1])\n",
        "        x_axis.numbers.shift(\n",
        "            0.5 * x_axis.get_unit_size() * RIGHT + \\\n",
        "            0.1 * UP\n",
        "        )\n",
        "\n",
        "        # axes.center()\n",
        "        # axes.to_edge(DOWN)\n",
        "\n",
        "        x_axis.center()\n",
        "        x_axis.to_edge(DOWN)\n",
        "\n",
        "        self.add(x_axis)\n",
        "\n",
        "        self.sum_axes = axes\n",
        "        self.sum_axis = x_axis\n",
        "\n",
        "    def add_sample_label(self):\n",
        "        label = TexText(R\"\\# Sums = 0\", font_size=36)\n",
        "        label.set_fill(GREY_B)\n",
        "        label.to_edge(LEFT)\n",
        "        label.count = label.make_number_changeable(\"0\")\n",
        "        label.count.edge_to_fix = LEFT\n",
        "\n",
        "        self.add(label)\n",
        "\n",
        "        self.sample_label = label\n",
        "\n",
        "    def run_one_sum(self, run_time=3.0, transition_time=1.0, still_frame=False):\n",
        "        # Setup sample\n",
        "        values = list(range(1, 7))\n",
        "        bars = self.die_dist.bars\n",
        "        samples = np.random.choice(values, size=self.n_dice, p=self.distribution)\n",
        "        dice = VGroup(*(DieFace(sample) for sample in samples))\n",
        "        dice.arrange_in_grid(n_cols=5)\n",
        "        dice.set_width(self.dice_width)\n",
        "        dice.to_corner(UR)\n",
        "\n",
        "        bar_highlights = VGroup(*(\n",
        "            bars[sample - 1].copy()\n",
        "            for sample in samples\n",
        "        ))\n",
        "        bar_highlights.set_fill(YELLOW, 1)\n",
        "\n",
        "        face_counts = [0] * len(self.distribution)\n",
        "        for sample in samples:\n",
        "            face_counts[sample - 1] += 1\n",
        "\n",
        "        # Tips\n",
        "        tips = get_sample_markers(bars, samples)\n",
        "\n",
        "        def get_sum():\n",
        "            return sum(d.value for d in dice)\n",
        "\n",
        "        # Sum label\n",
        "        sum_label = TexText(f\"Sum = 0\")\n",
        "        sum_label.count = sum_label.make_number_changeable(0)\n",
        "        sum_label.next_to(dice, DOWN, buff=MED_LARGE_BUFF)\n",
        "        sum_label.count.set_value(get_sum())\n",
        "\n",
        "        # Mark the sample\n",
        "        brick = self.get_brick()\n",
        "        s = get_sum()\n",
        "        if s not in self.buckets:\n",
        "            self.buckets[s] = VGroup(VectorizedPoint(\n",
        "                self.sum_axis.n2p(s + 0.5)\n",
        "            ))\n",
        "        bucket = self.buckets[s]\n",
        "\n",
        "        brick.next_to(bucket, UP, buff=0)\n",
        "\n",
        "        count_copy = sum_label.count.copy()\n",
        "        count_copy.target = bucket[0]\n",
        "        for number in self.sum_axis.numbers:\n",
        "            if number.get_value() == sum_label.count.get_value():\n",
        "                sum_label.count.target = number\n",
        "                break\n",
        "\n",
        "        # Animate!\n",
        "        if still_frame:\n",
        "            self.all_bricks.set_fill(color=self.full_dist_color)\n",
        "            self.sample_label.count.increment_value()\n",
        "            self.add(dice, brick, sum_label, tips)\n",
        "            self.wait(transition_time)\n",
        "            self.remove(dice, sum_label, tips)\n",
        "        else:\n",
        "            self.play(\n",
        "                ShowIncreasingSubsets(dice, int_func=np.ceil),\n",
        "                ShowIncreasingSubsets(tips, int_func=np.ceil),\n",
        "                ShowSubmobjectsOneByOne(bar_highlights, remover=True),\n",
        "                UpdateFromFunc(sum_label, lambda m: m.count.set_value(get_sum())),\n",
        "                self.all_bricks.animate.set_fill(color=self.full_dist_color),\n",
        "                run_time=run_time,\n",
        "            )\n",
        "            self.wait(transition_time)\n",
        "            self.play(\n",
        "                FadeInFromPoint(brick, count_copy.get_center()),\n",
        "                MoveToTarget(count_copy),\n",
        "                FadeOut(sum_label, lag_ratio=0.1),\n",
        "                FadeOut(dice, lag_ratio=0.1),\n",
        "                FadeOut(tips, lag_ratio=0.1),\n",
        "                run_time=transition_time\n",
        "            )\n",
        "            self.sample_label.count.increment_value()\n",
        "            self.wait(transition_time)\n",
        "\n",
        "        self.buckets[s].add(brick)\n",
        "        self.all_bricks.add(brick)\n",
        "        self.add(self.all_bricks)\n",
        "\n",
        "    def scale_brick_height(self, scale_factor):\n",
        "        self.brick_height *= scale_factor\n",
        "        bricks = self.all_bricks\n",
        "        bricks.target = bricks.generate_target()\n",
        "        bricks.target.stretch(scale_factor, 1, about_edge=DOWN)\n",
        "        bricks.target.set_stroke(width=scale_factor * bricks[0].get_stroke_width())\n",
        "        self.play(MoveToTarget(bricks), run_time=3)\n",
        "        self.wait()\n",
        "\n",
        "    def get_brick(self):\n",
        "        return Rectangle(\n",
        "            stroke_width=self.brick_height * 5,\n",
        "            stroke_color=BLACK,\n",
        "            fill_color=self.initial_brick_color,\n",
        "            fill_opacity=1,\n",
        "            height=self.brick_height,\n",
        "            width=0.8 * self.sum_axis.get_unit_size()\n",
        "        )\n",
        "\n",
        "\n",
        "class DiceSimulationAlt1(DiceSimulation):\n",
        "    random_seed = 1\n",
        "\n",
        "\n",
        "class DiceSimulationAlt2(DiceSimulation):\n",
        "    random_seed = 2\n",
        "\n",
        "\n",
        "class DiceSimulationAlt3(DiceSimulation):\n",
        "    random_seed = 3\n",
        "\n",
        "\n",
        "class DiceSimulationAlt4(DiceSimulation):\n",
        "    random_seed = 4\n",
        "\n",
        "\n",
        "class DiceSimulationAlt5(DiceSimulation):\n",
        "    random_seed = 5\n",
        "\n",
        "    \n",
        "class LargerDiceSimulation(DiceSimulation):\n",
        "    n_samples = 3000\n",
        "    brick_height = 0.02\n",
        "    random_seed = 1\n",
        "\n",
        "    def construct(self):\n",
        "        # Larger sample\n",
        "        for _ in range(self.n_samples):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "\n",
        "class SimulationWithUShapedDistribution(DiceSimulation):\n",
        "    random_seed = 1\n",
        "    distribution = U_SHAPED_DISTRIBUTION\n",
        "    brick_height = 0.2\n",
        "    n_samples = 3000\n",
        "\n",
        "    def construct(self):\n",
        "        # Transition\n",
        "        tmp_dist = self.distribution\n",
        "        tmp_die_dist = self.die_dist\n",
        "        self.remove(tmp_die_dist)\n",
        "        self.distribution = self.__class__.__base__.distribution\n",
        "        self.add_die_distribution()\n",
        "        self.play(Transform(self.die_dist, tmp_die_dist, run_time=3))\n",
        "\n",
        "        self.distribution = tmp_dist\n",
        "\n",
        "        # First few samples\n",
        "        for _ in range(2):\n",
        "            self.run_one_sum()\n",
        "        for _ in range(6):\n",
        "            self.run_one_sum(run_time=0.5, transition_time=0.5)\n",
        "        for _ in range(300):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "        # Thousands of samples\n",
        "        self.scale_brick_height(0.1)\n",
        "        for _ in range(self.n_samples - int(self.sample_label.count.get_value())):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "        self.play(self.all_bricks.animate.set_fill(color=self.full_dist_color))\n",
        "\n",
        "\n",
        "class LargerUSimulation(SimulationWithUShapedDistribution):\n",
        "    n_samples = 10000\n",
        "    brick_height = 0.01\n",
        "\n",
        "    def construct(self):\n",
        "        # Thousands of samples\n",
        "        for _ in range(self.n_samples):\n",
        "            self.run_one_sum(transition_time=1 / 30, still_frame=True)\n",
        "\n",
        "    def get_brick(self):\n",
        "        return super().get_brick().set_stroke(width=0)\n",
        "\n",
        "\n",
        "class SteeperUDistributionSimulation(SimulationWithUShapedDistribution):\n",
        "    distribution = STEEP_U_SHAPED_DISTRIBUTION\n",
        "\n",
        "\n",
        "class SimulationWithSteepUShapedDistribution(LargerUSimulation):\n",
        "    distribution = [0.4, 0.075, 0.025, 0.025, 0.075, 0.4]\n",
        "    n_samples = 3000\n",
        "    brick_height = 0.02\n",
        "\n",
        "\n",
        "class SimulationWithExpDistribution(SimulationWithUShapedDistribution):\n",
        "    random_seed = 1\n",
        "    distribution = EXP_DISTRIBUTION\n",
        "\n",
        "\n",
        "class SimulationWithExpDistribution2(SimulationWithExpDistribution):\n",
        "    random_seed = 2\n",
        "\n",
        "\n",
        "class SimulationWithExpDistribution2Dice(SimulationWithExpDistribution):\n",
        "    n_dice = 2\n",
        "    brick_height = 0.13\n",
        "    dice_width = 2\n",
        "\n",
        "    def get_brick(self):\n",
        "        return super().get_brick().set_stroke(width=0)\n",
        "\n",
        "\n",
        "class SimulationWithRandomDistribution(SimulationWithUShapedDistribution):\n",
        "    random_seed = 1\n",
        "    n_dice = 15\n",
        "    distribution = [0.05, 0.17, 0.28, 0.05, 0.18, 0.27]\n",
        "\n",
        "\n",
        "class SimulationWithExpDistribution5Dice(SimulationWithExpDistribution):\n",
        "    n_dice = 5\n",
        "    brick_height = 0.15\n",
        "\n",
        "\n",
        "class SimulationWithExpDistribution15Dice(SimulationWithExpDistribution):\n",
        "    n_dice = 15\n",
        "\n"
    ]
}