{
    "topic": "The mathematical concept being demonstrated is the ability of a language model to predict the next word in a sequence",
    "code": [
        "from manim_imports_ext import *\n",
        "from _2024.transformers.generation import *\n",
        "from _2024.transformers.helpers import *\n",
        "from _2024.transformers.embedding import *\n",
        "from _2024.transformers.ml_basics import *\n",
        "\n",
        "\n",
        "# Intro\n",
        "\n",
        "class HoldUpThumbnail(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        im = ImageMobject(\"/Users/grant/3Blue1Brown Dropbox/3Blue1Brown/videos/2024/transformers/Thumbnails/Chapter5_TN3.png\")\n",
        "        im_group = Group(\n",
        "            SurroundingRectangle(im, buff=0).set_stroke(WHITE, 3),\n",
        "            im\n",
        "        )\n",
        "        im_group.set_height(3)\n",
        "        im_group.move_to(self.hold_up_spot, DOWN)\n",
        "\n",
        "        morty = self.teacher\n",
        "        stds = self.students\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(im_group, UP),\n",
        "            morty.change(\"raise_right_hand\", look_at=im_group),\n",
        "            self.change_students(\"tease\", \"happy\", \"tease\", look_at=im_group),\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "class IsThisUsefulToShare(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        morty = self.teacher\n",
        "        self.play(\n",
        "            morty.says(\"Do you find\\nthis useful?\"),\n",
        "            self.change_students(\"pondering\", \"hesitant\", \"well\", look_at=self.screen)\n",
        "        )\n",
        "        self.wait(3)\n",
        "        self.play(self.change_students(\"thinking\", \"pondering\", \"tease\"))\n",
        "        self.wait(3)\n",
        "\n",
        "\n",
        "class AskAboutAttention(TeacherStudentsScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        stds = self.students\n",
        "        morty = self.teacher\n",
        "        self.play(\n",
        "            morty.change(\"tease\"),\n",
        "            stds[2].says(\"Can you explain what\\nAttention does?\", mode=\"raise_left_hand\", bubble_direction=LEFT),\n",
        "            stds[1].change(\"pondering\", self.screen),\n",
        "            stds[0].change(\"pondering\", self.screen),\n",
        "        )\n",
        "        self.wait(4)\n",
        "\n",
        "\n",
        "# Version 1\n",
        "\n",
        "class PredictTheNextWord(SimpleAutogregression):\n",
        "    text_corner = 3.5 * UP + 6.5 * LEFT\n",
        "    machine_name = \"Large\\nLanguage\\nModel\"\n",
        "    seed_text = \"Paris is a city in\"\n",
        "    model = \"gpt3\"\n",
        "    n_shown_predictions = 12\n",
        "    random_seed = 2\n",
        "\n",
        "    def construct(self):\n",
        "        # Setup machine\n",
        "        text_mob, next_word_line, machine = self.init_text_and_machine()\n",
        "        machine.move_to(ORIGIN)\n",
        "        machine[1].set_backstroke(BLACK, 3)\n",
        "\n",
        "        text_group = VGroup(text_mob, next_word_line)\n",
        "        text_group.save_state()\n",
        "        text_group.scale(1.5)\n",
        "        text_group.match_x(machine[0]).to_edge(UP)\n",
        "\n",
        "        # Introduce the machine\n",
        "        in_arrow = Arrow(text_group, machine[0].get_top(), thickness=5)\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "        blocks = machine[0]\n",
        "        llm_text = machine[1]\n",
        "        block_outlines = blocks.copy()\n",
        "        block_outlines.set_fill(opacity=0)\n",
        "        block_outlines.set_stroke(GREY_B, 2)\n",
        "        block_outlines.insert_n_curves(20)\n",
        "\n",
        "        flat_dials, last_dials = self.get_machine_dials(blocks)\n",
        "\n",
        "        self.clear()\n",
        "        frame.reorient(-31, -4, -5, (-0.24, -0.26, -0.06), 3)\n",
        "        self.play(\n",
        "            FadeIn(blocks, shift=0.0, lag_ratio=0.01),\n",
        "            LaggedStartMap(VShowPassingFlash, block_outlines.family_members_with_points(), time_width=2.0, lag_ratio=0.01, remover=True),\n",
        "            LaggedStartMap(VFadeInThenOut, flat_dials, lag_ratio=0.001, remover=True),\n",
        "            Write(llm_text, time_span=(2, 4), stroke_color=WHITE),\n",
        "            FadeIn(last_dials, time_span=(4, 5)),\n",
        "            frame.animate.reorient(0, 0, 0, (-0.17, -0.12, 0.0), 4.50),\n",
        "            run_time=6,\n",
        "        )\n",
        "        blocks[-1].add(last_dials)\n",
        "        self.play(\n",
        "            frame.animate.to_default_state(),\n",
        "            FadeIn(text_group, UP),\n",
        "            GrowFromCenter(in_arrow),\n",
        "            run_time=3\n",
        "        )\n",
        "\n",
        "        # Single word prediction\n",
        "        out_arrow = Vector(1.5 * RIGHT, thickness=5)\n",
        "        out_arrow.next_to(machine[0][-1], RIGHT)\n",
        "        prediction = Text(\"France\", font_size=72)\n",
        "        prediction.next_to(out_arrow, RIGHT)\n",
        "\n",
        "        self.animate_text_input(\n",
        "            text_mob, machine,\n",
        "            position_text_over_machine=False,\n",
        "        )\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (TransformFromCopy(VectorizedPoint(machine.get_right()), letter)\n",
        "                for letter in prediction),\n",
        "                lag_ratio=0.05,\n",
        "            ),\n",
        "            GrowArrow(out_arrow)\n",
        "        )\n",
        "        self.wait()\n",
        "        machine.replace_submobject(2, out_arrow)\n",
        "\n",
        "        # Probability distribution\n",
        "        self.play(FadeOut(prediction, DOWN))\n",
        "        bar_groups = self.animate_prediction_ouptut(machine, self.cur_str)\n",
        "        self.wait()\n",
        "\n",
        "        # Show auto_regression\n",
        "        self.play(\n",
        "            Restore(text_group),\n",
        "            FadeOut(in_arrow),\n",
        "        )\n",
        "\n",
        "        seed_label = Text(\"Seed text\")\n",
        "        seed_label.set_color(YELLOW)\n",
        "        seed_label.next_to(text_mob, DOWN)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(seed_label, rate_func=there_and_back_with_pause),\n",
        "            FlashAround(text_mob, time_width=2),\n",
        "            frame.animate.reorient(0, 0, 0, (0.7, -0.01, 0.0), 8.52),\n",
        "            run_time=2,\n",
        "        )\n",
        "\n",
        "        self.animate_random_sample(bar_groups)\n",
        "        new_text_mob = self.animate_word_addition(\n",
        "            bar_groups, text_mob, next_word_line,\n",
        "        )\n",
        "\n",
        "        # More!\n",
        "        for n in range(20):\n",
        "            text_mob = self.new_selection_cycle(\n",
        "                text_mob, next_word_line, machine,\n",
        "                quick=True,\n",
        "                skip_anims=(n > 5),\n",
        "            )\n",
        "            self.wait(0.25)\n",
        "\n",
        "    def get_machine_dials(self, blocks):\n",
        "        dials = VGroup(\n",
        "            Dial().get_grid(8, 12).set_width(0.9 * block.get_width()).move_to(block)\n",
        "            for block in blocks\n",
        "        )\n",
        "        dials.set_stroke(opacity=0.5)\n",
        "        for group in dials:\n",
        "            for dial in group:\n",
        "                dial.set_value(dial.get_random_value())\n",
        "        flat_dials = VGroup(*it.chain(*dials))\n",
        "        last_dials = dials[-1].copy()\n",
        "        last_dials.set_stroke(opacity=0.1)\n",
        "\n",
        "        return flat_dials, last_dials\n",
        "\n",
        "\n",
        "class LotsOfTextIntoTheMachine(PredictTheNextWord):\n",
        "    run_time = 25\n",
        "    max_snippet_width = 3\n",
        "\n",
        "    def construct(self):\n",
        "        # Add machine\n",
        "        text_mob, next_word_line, machine = self.init_text_and_machine()\n",
        "        machine.scale(1.5)\n",
        "        self.clear()\n",
        "        self.add(machine)\n",
        "\n",
        "        blocks, title = machine[:2]\n",
        "        dials = Dial().get_grid(8, 12).set_width(0.9 * blocks[-1].get_width()).move_to(blocks[-1])\n",
        "        dials.set_stroke(opacity=0.1)\n",
        "        blocks[-1].add(dials)\n",
        "\n",
        "        machine.center()\n",
        "        machine[1].set_stroke(BLACK, 3)\n",
        "\n",
        "        # Feed in lots of text\n",
        "        snippets = self.get_text_snippets()\n",
        "        text_mobs = VGroup(get_paragraph(snippet.split(\" \"), line_len=25) for snippet in snippets)\n",
        "        directions = compass_directions(12, start_vect=UR)\n",
        "        for text_mob, vect in zip(text_mobs, it.cycle(directions)):\n",
        "            text_mob.set_max_width(self.max_snippet_width)\n",
        "            text_mob.move_to(5 * vect).shift_onto_screen(buff=0.25)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (Succession(\n",
        "                    FadeIn(text_mob),\n",
        "                    text_mob.animate.set_opacity(0).move_to(machine.get_center()),\n",
        "                )\n",
        "                for text_mob in text_mobs),\n",
        "                lag_ratio=0.05,\n",
        "                run_time=self.run_time\n",
        "            )\n",
        "        )\n",
        "        self.remove(text_mobs)\n",
        "        self.wait()\n",
        "\n",
        "    def get_text_snippets(self):\n",
        "        facts = Path(DATA_DIR, \"pile_of_text.txt\").read_text().split(\"\\n\")\n",
        "        random.shuffle(facts)\n",
        "        return facts\n",
        "\n",
        "\n",
        "class EvenMoreTextIntoMachine(LotsOfTextIntoTheMachine):\n",
        "    run_time = 40\n",
        "    max_snippet_width = 2.5\n",
        "    n_examples = 300\n",
        "    context_size = 25\n",
        "\n",
        "    def get_text_snippets(self):\n",
        "        book = Path(DATA_DIR, \"tale_of_two_cities.txt\").read_text()\n",
        "        book = book.replace(\"\\n\", \" \")\n",
        "        words = list(filter(lambda m: m, book.split(\" \")))\n",
        "        context_size = self.context_size\n",
        "        result = []\n",
        "        for n in range(self.n_examples):\n",
        "            index = random.randint(0, len(words) - context_size - 1)\n",
        "            result.append(\" \".join(words[index:index + context_size]))\n",
        "\n",
        "        return result\n",
        "\n",
        "\n",
        "class WriteTransformer(InteractiveScene):\n",
        "    def construct(self):\n",
        "        text = Text(\"Transformer\", font_size=120)\n",
        "        self.play(Write(text))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class LabelVector(InteractiveScene):\n",
        "    def construct(self):\n",
        "        brace = Brace(Line(UP, DOWN).set_height(4), RIGHT)\n",
        "        name = Text(\"Vector\", font_size=72)\n",
        "        name.next_to(brace, RIGHT)\n",
        "        name.set_backstroke(BLACK, 5)\n",
        "\n",
        "        self.play(\n",
        "            GrowFromCenter(brace),\n",
        "            Write(name),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class AdjustingTheMachine(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add a machine and repeatedly tweak it\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "        frame.reorient(-28, -17, 0, ORIGIN, 8.91)\n",
        "        self.camera.light_source.move_to([-10, 10, 10])\n",
        "\n",
        "        machine = MachineWithDials(n_rows=10, n_cols=12)\n",
        "        machine.set_height(6)\n",
        "        blocks = VCube().replicate(10)\n",
        "        blocks.set_shape(machine.get_width(), machine.get_height(), 1.0)\n",
        "        blocks.deactivate_depth_test()\n",
        "        cam_loc = self.frame.get_implied_camera_location() \n",
        "        for block in blocks:\n",
        "            block.sort(lambda p: -get_norm(p - cam_loc))\n",
        "        blocks.set_fill(GREY_D, 1)\n",
        "        blocks.set_shading(0.2, 0.5, 0.25)\n",
        "        blocks.arrange(OUT, buff=0.5)\n",
        "        blocks.move_to(machine, OUT)\n",
        "\n",
        "        self.add(blocks)\n",
        "        self.add(machine)\n",
        "\n",
        "        frame.clear_updaters()\n",
        "        frame.add_updater(lambda f: f.set_theta(-30 * DEGREES * math.cos(0.1 * self.time)))\n",
        "        self.add(frame)\n",
        "        for x in range(6):\n",
        "            self.play(machine.random_change_animation(lag_factor=0.1))\n",
        "\n",
        "\n",
        "class FirthQuote(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Show Quote\n",
        "        quote = TexText(R\"``You shall know a word\\\\by the company it keeps!''\", font_size=60)\n",
        "        image = ImageMobject(\"JohnRFirth\")  # From https://www.cambridge.org/core/journals/bulletin-of-the-school-of-oriental-and-african-studies/article/john-rupert-firth/D926AFCBF99AD17D5C7A7A9C0558DFDC\n",
        "        image.set_height(6.5)\n",
        "        image.to_corner(UL, buff=0.5)\n",
        "        name = Text(\"John R. Firth\")\n",
        "        name.next_to(image, DOWN)\n",
        "        quote.move_to(midpoint(image.get_right(), RIGHT_SIDE))\n",
        "        quote.to_edge(UP)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(image, 0.25 * UP),\n",
        "            FadeIn(name, lag_ratio=0.1)\n",
        "        )\n",
        "        self.play(Write(quote))\n",
        "        self.wait()\n",
        "\n",
        "        # Show two sentences\n",
        "        phrases = VGroup(\n",
        "            Text(\"Down by the river bank\"),\n",
        "            Text(\"Deposit a check at the bank\"),\n",
        "        )\n",
        "        bank = Text(\"bank\", font_size=90)\n",
        "        bank.set_color(TEAL)\n",
        "        bank.match_x(quote).match_y(image)\n",
        "        for phrase in phrases:\n",
        "            phrase[\"bank\"].set_color(TEAL)\n",
        "\n",
        "        phrases.arrange(DOWN, buff=1.0, aligned_edge=LEFT)\n",
        "        phrases.next_to(quote, DOWN, buff=2.5)\n",
        "        phrases[1].set_opacity(0.15)\n",
        "        banks = VGroup(\n",
        "            phrase[\"bank\"][0]\n",
        "            for phrase in phrases\n",
        "        )\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(bank, scale=2, lag_ratio=0.25),\n",
        "            quote.animate.scale(0.7, about_edge=UP).set_opacity(0.75)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.remove(bank)\n",
        "        self.play(\n",
        "            FadeIn(phrases[0][:len(\"downbytheriver\")], lag_ratio=0.1),\n",
        "            FadeIn(phrases[1][:len(\"depositacheckatthe\")], lag_ratio=0.1),\n",
        "            *(TransformFromCopy(bank, bank2) for bank2 in banks)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            phrases[0].animate.set_opacity(0.5),\n",
        "            phrases[1].animate.set_opacity(1),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Isolate both phrases\n",
        "        self.play(LaggedStart(\n",
        "            FadeOut(image, LEFT, scale=0.5),\n",
        "            FadeOut(name, LEFT, scale=0.5),\n",
        "            FadeOut(quote, LEFT, scale=0.5),\n",
        "            phrases.animate.set_opacity(1).arrange(DOWN, buff=3.5, aligned_edge=LEFT).move_to(0.5 * UP),\n",
        "        ))\n",
        "        self.wait()\n",
        "\n",
        "        # Recreate\n",
        "        word = Text(\"bank\", font_size=72)\n",
        "        word.set_color(TEAL)\n",
        "        self.clear()\n",
        "\n",
        "        self.add(word)\n",
        "        self.wait()\n",
        "        self.remove(word)\n",
        "        self.play(\n",
        "            *(\n",
        "                FadeIn(phrase[phrase.get_text().replace(\"bank\", \"\")])\n",
        "                for phrase in phrases\n",
        "            ),\n",
        "            *(\n",
        "                TransformFromCopy(word, phrase[\"bank\"][0])\n",
        "                for phrase in phrases\n",
        "            )\n",
        "        )\n",
        "        self.add(phrases)\n",
        "\n",
        "        # Show influence\n",
        "        query_rects = VGroup(\n",
        "            SurroundingRectangle(bank)\n",
        "            for bank in banks\n",
        "        )\n",
        "        query_rects.set_stroke(TEAL, 2)\n",
        "        query_rects.set_fill(TEAL, 0.25)\n",
        "        key_rects = VGroup(\n",
        "            SurroundingRectangle(phrases[0][\"river\"]),\n",
        "            SurroundingRectangle(phrases[1][\"Deposit\"]),\n",
        "            SurroundingRectangle(phrases[1][\"check\"]),\n",
        "        )\n",
        "        key_rects.set_stroke(BLUE, 2)\n",
        "        key_rects.set_fill(BLUE, 0.5)\n",
        "        key_rects[2].match_height(key_rects[1], about_edge=UP, stretch=True)\n",
        "        arrows = VGroup(\n",
        "            Arrow(key_rects[0].get_top(), banks[0].get_top(), path_arc=-180 * DEGREES, buff=0.1),\n",
        "            Arrow(key_rects[1].get_top(), banks[1].get_top(), path_arc=-90 * DEGREES),\n",
        "            Arrow(key_rects[2].get_top(), banks[1].get_top(), path_arc=-90 * DEGREES),\n",
        "        )\n",
        "        arrows.set_color(BLUE)\n",
        "\n",
        "        key_rects.save_state()\n",
        "        key_rects[0].become(query_rects[0])\n",
        "        key_rects[1].become(query_rects[1])\n",
        "        key_rects[2].become(query_rects[1])\n",
        "        key_rects.set_opacity(0)\n",
        "\n",
        "        self.add(query_rects, phrases)\n",
        "        self.play(FadeIn(query_rects, lag_ratio=0.25))\n",
        "        self.wait()\n",
        "\n",
        "        self.add(key_rects, phrases)\n",
        "        self.play(Restore(key_rects, lag_ratio=0.1, path_arc=PI / 4, run_time=2))\n",
        "        self.play(LaggedStartMap(Write, arrows, stroke_width=5, run_time=3))\n",
        "        self.wait()\n",
        "\n",
        "        # Show images\n",
        "        images = Group(\n",
        "            ImageMobject(\"RiverBank\"),\n",
        "            ImageMobject(\"FederalReserve\"),\n",
        "        )\n",
        "        for image, bank in zip(images, banks):\n",
        "            image.set_height(2.0)\n",
        "            image.next_to(bank, DOWN, MED_SMALL_BUFF, aligned_edge=LEFT)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (FadeTransform(Group(word).copy(), image)\n",
        "                for word, image in zip(banks, images)),\n",
        "                lag_ratio=0.5,\n",
        "                group_type=Group,\n",
        "            )\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "\n",
        "class DownByTheRiverHeader(InteractiveScene):\n",
        "    def construct(self):\n",
        "        words = Text(\"Down by the river bank ...\")\n",
        "        rect = SurroundingRectangle(words[\"bank\"])\n",
        "        rect.set_fill(BLUE, 0.5)\n",
        "        rect.set_stroke(BLUE, 3)\n",
        "        brace = Brace(rect, DOWN, buff=SMALL_BUFF)\n",
        "        self.add(rect, words, brace)\n",
        "\n",
        "\n",
        "class RiverBankProbParts(SimpleAutogregression):\n",
        "    seed_text = \"Down by the river bank, \"\n",
        "    model = \"gpt3\"\n",
        "\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        text_mob, next_word_line, machine = self.init_text_and_machine()\n",
        "        machine.set_x(0)\n",
        "        words = [\n",
        "            \"water\",\n",
        "            \"river\",\n",
        "            \"lake\",\n",
        "            \"grass\",\n",
        "            \"waves\",\n",
        "            \"shallows\",\n",
        "            \"pool\",\n",
        "            \"depths\",\n",
        "            \"foam\",\n",
        "            \"mist\",\n",
        "        ]\n",
        "        probs = softmax([6, 5, 4, 4, 3.5, 3.25, 3, 3, 2.5, 2])\n",
        "        bar_groups = self.get_distribution(words, probs, machine)\n",
        "\n",
        "        self.clear()\n",
        "        bar_groups.set_height(6).center()\n",
        "        self.play(\n",
        "            LaggedStartMap(FadeIn, bar_groups, shift=0.25 * DOWN, run_time=3)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class FourStepsWithParameters(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add rectangles and titles\n",
        "        self.add(FullScreenRectangle(fill_color=GREY_E))\n",
        "        rects = Square().replicate(4)\n",
        "        rects.arrange(RIGHT, buff=0.25 * rects[0].get_width())\n",
        "        rects.set_width(FRAME_WIDTH - 1.0)\n",
        "        rects.center().to_edge(UP, buff=0.5)\n",
        "        rects.set_fill(BLACK, 1)\n",
        "        rects.set_stroke(WHITE, 2)\n",
        "        names = VGroup(*map(TexText, [\n",
        "            R\"Text snippets\\\\$\\downarrow$\\\\Vectors\",\n",
        "            R\"Attention\",\n",
        "            R\"Feedforward\",\n",
        "            R\"Final prediction\",\n",
        "        ]))\n",
        "        for name, rect in zip(names, rects):\n",
        "            name.scale(0.8)\n",
        "            name.next_to(rect, DOWN)\n",
        "\n",
        "        self.add(rects)\n",
        "        self.play(LaggedStartMap(FadeIn, names, shift=0.25 * DOWN, lag_ratio=0.25))\n",
        "        self.wait()\n",
        "\n",
        "        # Show many dials\n",
        "        machines = VGroup(\n",
        "            MachineWithDials(\n",
        "                width=rect.get_width(),\n",
        "                height=3.0,\n",
        "                n_rows=9,\n",
        "                n_cols=6,\n",
        "            )\n",
        "            for rect in rects\n",
        "        )\n",
        "        for machine, rect in zip(machines, rects):\n",
        "            machine.next_to(rect, DOWN, buff=0)\n",
        "            machine[0].set_opacity(0)\n",
        "            machine.scale(rect.get_width() / machine.dials.get_width(), about_edge=UP)\n",
        "            machine.dials.shift(0.25 * UP)\n",
        "            for dial in machine.dials:\n",
        "                dial.set_value(0)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart((\n",
        "                LaggedStart(\n",
        "                    (GrowFromPoint(dial, machine.get_top())\n",
        "                    for dial in machine.dials),\n",
        "                    lag_ratio=0.025,\n",
        "                )\n",
        "                for machine in machines\n",
        "            ), lag_ratio=0.25),\n",
        "            LaggedStartMap(FadeOut, names)\n",
        "        )\n",
        "        for _ in range(2):\n",
        "            self.play(\n",
        "                LaggedStart(\n",
        "                    (machine.random_change_animation()\n",
        "                    for machine in machines),\n",
        "                    lag_ratio=0.2,\n",
        "                )\n",
        "            )\n",
        "\n",
        "\n",
        "class ChatbotFeedback(InteractiveScene):\n",
        "    random_seed = 404\n",
        "\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        self.frame.set_height(10).move_to(DOWN)\n",
        "        user_prompt = \"User: How and when was the internet invented?\"\n",
        "\n",
        "        prompt_mob = Text(user_prompt)\n",
        "        prompt_mob.to_edge(UP)\n",
        "        prompt_mob[\"User:\"].set_color(BLUE)\n",
        "\n",
        "        self.answer_mob = Text(\"AI Assistant:\")\n",
        "        self.answer_mob.next_to(prompt_mob, DOWN, buff=1.0, aligned_edge=LEFT)\n",
        "        self.answer_mob.set_color(YELLOW)\n",
        "        self.og_answer_mob = self.answer_mob\n",
        "\n",
        "        self.add(prompt_mob, self.answer_mob)\n",
        "\n",
        "        # Show multiple answer\n",
        "        for n in range(8):\n",
        "            self.give_answer(prompt_mob)\n",
        "            mark = self.judge_answer()\n",
        "            self.add(self.og_answer_mob)\n",
        "            self.play(FadeOut(self.answer_mob), FadeOut(mark))\n",
        "            self.answer_mob = self.og_answer_mob\n",
        "\n",
        "    def display_answer(self, text):\n",
        "        new_answer_mob = get_paragraph(text.replace(\"\\n\", \" \").split(\" \"))\n",
        "        new_answer_mob[:len(self.og_answer_mob)].match_style(self.og_answer_mob)\n",
        "        new_answer_mob.move_to(self.og_answer_mob, UL)\n",
        "        self.remove(self.answer_mob)\n",
        "        self.answer_mob = new_answer_mob\n",
        "        self.add(self.answer_mob)\n",
        "\n",
        "    def give_answer(self, prompt_mob, max_responses=100):\n",
        "        answer = self.og_answer_mob.get_text()\n",
        "        user_prompt = prompt_mob.get_text()\n",
        "        for n in range(max_responses):\n",
        "            answer, stop = self.add_to_answer(user_prompt, answer)\n",
        "            if stop:\n",
        "                break\n",
        "            self.display_answer(answer)\n",
        "            self.wait(2 / 30)\n",
        "\n",
        "    def judge_answer(self):\n",
        "        mark = random.choice([\n",
        "            Checkmark().set_color(GREEN),\n",
        "            Exmark().set_color(RED),\n",
        "        ])\n",
        "        mark.scale(5)\n",
        "        mark.next_to(self.answer_mob, RIGHT, aligned_edge=UP)\n",
        "        rect = SurroundingRectangle(self.answer_mob)\n",
        "        rect.match_color(mark)\n",
        "        self.play(FadeIn(mark, scale=2), FadeIn(rect, scale=1.05))\n",
        "        self.wait()\n",
        "        return VGroup(mark, rect)\n",
        "\n",
        "    def add_to_answer(self, user_prompt: str, answer: str):\n",
        "        try:\n",
        "            tokens, probs = gpt3_predict_next_token(\"\\n\\n\".join([user_prompt, answer]))\n",
        "            token = random.choices(tokens, np.array(probs) / sum(probs))[0]\n",
        "        except IndexError:\n",
        "            return answer, True\n",
        "\n",
        "        stop = False\n",
        "        if token == '<|endoftext|>':\n",
        "            stop = True\n",
        "        else:\n",
        "            answer += token\n",
        "        return answer, stop\n",
        "\n",
        "\n",
        "class ContrastWithEarlierFrame(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        vline = Line(UP, DOWN)\n",
        "        vline.set_height(FRAME_HEIGHT)\n",
        "        self.add(vline)\n",
        "\n",
        "        titles = VGroup(\n",
        "            VGroup(\n",
        "                Text(\"Most earlier models\"),\n",
        "                # Vector(0.75 * DOWN, thickness=4),\n",
        "                # Text(\"One word at a time\")\n",
        "            ),\n",
        "            VGroup(\n",
        "                Text(\"Transformers\"),\n",
        "                # Vector(0.75 * DOWN, thickness=4),\n",
        "                # Text(\"All words in parallel\")\n",
        "            ),\n",
        "        )\n",
        "        for title, vect in zip(titles, [LEFT, RIGHT]):\n",
        "            title.arrange(DOWN, buff=0.2)\n",
        "            title.scale(1.5)\n",
        "            title.move_to(FRAME_WIDTH * vect / 4)\n",
        "            title.to_edge(UP)\n",
        "\n",
        "        self.add(titles)\n",
        "\n",
        "\n",
        "class SequentialProcessing(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add text\n",
        "        text = Text(\"Down by the river bank, where I used to go fishing ...\")\n",
        "        text.move_to(1.0 * DOWN)\n",
        "        words = break_into_words(text)\n",
        "        rects = get_piece_rectangles(words)\n",
        "        blocks = VGroup(VGroup(rect, word) for rect, word in zip(rects, words))\n",
        "        blocks.save_state()\n",
        "        self.add(blocks)\n",
        "\n",
        "        # Vector wandering over\n",
        "        vect = NumericEmbedding()\n",
        "        vect.set_width(1.0)\n",
        "        vect.next_to(rects[0], UP)\n",
        "\n",
        "        for n in range(len(blocks) - 1):\n",
        "            blocks.target = blocks.saved_state.copy()\n",
        "            blocks.target[:n].fade(0.75)\n",
        "            blocks.target[n + 1:].fade(0.75)\n",
        "            self.play(\n",
        "                vect.animate.next_to(blocks[n], UP),\n",
        "                MoveToTarget(blocks)\n",
        "            )\n",
        "            self.play(\n",
        "                LaggedStart(\n",
        "                    (ContextAnimation(elem, blocks[n][1], lag_ratio=0.01)\n",
        "                    for elem in vect.get_entries()),\n",
        "                    lag_ratio=0.01,\n",
        "                ),\n",
        "                RandomizeMatrixEntries(vect),\n",
        "                run_time=2\n",
        "            )\n",
        "\n",
        "\n",
        "# Version 2\n",
        "\n",
        "\n",
        "class PartialScript(SimpleAutogregression):\n",
        "    machine_name = \"Magic next\\nword predictor\"\n",
        "    machine_phi = 5 * DEGREES\n",
        "    machine_theta = 6 * DEGREES\n",
        "\n",
        "    def construct(self):\n",
        "        # Set frame\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "\n",
        "        # Unfurl script\n",
        "        curled_script_img = ImageMobject(\"HumanAIScript\")\n",
        "        curled_script_img.set_height(7)\n",
        "\n",
        "        curves = VGroup(SVGMobject(\"JaggedCurl1\")[0], SVGMobject(\"JaggedCurl2\")[0])\n",
        "        for curve in curves:\n",
        "            curve.make_smooth(approx=False)\n",
        "            curve.insert_n_curves(100)\n",
        "            curve.set_stroke(WHITE, 3)\n",
        "            curve.set_fill(opacity=0)\n",
        "            curve.set_height(5)\n",
        "        curves[1].scale(curves[0].get_arc_length() / curves[1].get_arc_length())\n",
        "\n",
        "        resolution = (2, 200)  # Change\n",
        "        surface_kw = dict(u_range=(-6, 6), v_range=(0.05, 0.95), resolution=resolution)\n",
        "        curled_script_templates = Group(\n",
        "            ParametricSurface(\n",
        "                lambda u, v: (*curve.pfp(v)[:2], u),\n",
        "                **surface_kw\n",
        "            )\n",
        "            for curve in curves\n",
        "        )\n",
        "        curled_script_templates[1].rotate(PI / 2, UP)\n",
        "        curled_script_templates[0].rotate(-PI / 2)\n",
        "        flat_script_template = ParametricSurface(\n",
        "            lambda u, v: (u, v, 0),\n",
        "            **surface_kw\n",
        "        )\n",
        "        curled_script0 = TexturedSurface(curled_script_templates[0], \"HumanAIScript\")\n",
        "        curled_script1 = TexturedSurface(curled_script_templates[1], \"HumanAIScript\")\n",
        "        curled_script1_torn = TexturedSurface(curled_script_templates[1], \"HumanAIScriptTorn\")\n",
        "        flat_script = TexturedSurface(flat_script_template, \"HumanAIScriptTorn\")\n",
        "        flat_script.replace(curled_script_img, stretch=True)\n",
        "\n",
        "        for script in [curled_script0, curled_script1]:\n",
        "            script.set_shading(0.25, 0.25, 0.35)\n",
        "        curled_script1_torn.set_shading(0, 0, 0)\n",
        "        flat_script.set_shading(0, 0, 0)\n",
        "\n",
        "        frame.reorient(0, -1, 0, (-0.28, 0.69, 0.0), 14.43)\n",
        "        self.play(\n",
        "            TransformFromCopy(curled_script0, curled_script1),\n",
        "            frame.animate.reorient(56, -17, 0, (-0.2, -1.52, -2.39), 20.05),\n",
        "            run_time=3\n",
        "        )\n",
        "        self.play(\n",
        "            frame.animate.reorient(-6, -11, 0, (1.06, -1.22, -2.65), 20.05),\n",
        "            run_time=8,\n",
        "        )\n",
        "        self.play(\n",
        "            FadeOut(curled_script1, shift=1e-2 * IN),\n",
        "            FadeIn(curled_script1_torn, shift=1e-2 * IN),\n",
        "        )\n",
        "        self.play(\n",
        "            ReplacementTransform(curled_script1_torn, flat_script),\n",
        "            frame.animate.to_default_state(),\n",
        "            run_time=2\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Show the machine\n",
        "        machine = self.get_transformer_drawing()\n",
        "        machine[1].set_height(0.7).set_stroke(width=2)\n",
        "        machine[1].set_opacity(0)\n",
        "        machine.remove(machine[-1])\n",
        "        machine.set_height(3)\n",
        "        machine.to_edge(RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            flat_script.animate.set_height(5).to_edge(LEFT),\n",
        "            FadeIn(machine, lag_ratio=0.01)\n",
        "        )\n",
        "        self.add(machine)\n",
        "        self.wait()\n",
        "\n",
        "        # Show example input and output\n",
        "        out_arrow = Vector(DOWN, thickness=6)\n",
        "        out_arrow.next_to(machine, DOWN)\n",
        "        in_arrow = out_arrow.copy().next_to(machine, UP, SMALL_BUFF)\n",
        "        in_text = Text(\"To be or not to _\")\n",
        "        in_text[-1].stretch(3, 0, about_edge=LEFT)\n",
        "        in_text.next_to(in_arrow, UP)\n",
        "        prediction = Text(\"be\", font_size=72)\n",
        "        prediction.next_to(out_arrow, DOWN)\n",
        "\n",
        "        self.play(FadeIn(in_text), GrowArrow(in_arrow))\n",
        "        self.animate_text_input(in_text, machine, position_text_over_machine=False)\n",
        "        self.play(\n",
        "            GrowArrow(out_arrow),\n",
        "            FadeIn(prediction, DOWN),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Clear the board\n",
        "        script_text = self.get_text()\n",
        "        script_text.set_width(0.89 * flat_script.get_width())\n",
        "        script_text.next_to(flat_script.get_top(), DOWN, buff=0.33)\n",
        "\n",
        "        font_size = 48 * (script_text[0].get_height() / Text(\"H\").get_height())\n",
        "        completion = \"A transistor is a semiconductor device used to amplify or switch electronic signals. It consists of three layers of semiconductor material, either p-type or n-type, forming a structure with terminals called the emitter, base, and collector.\"\n",
        "        words = completion.split(\" \")\n",
        "        paragraph = get_paragraph(completion.split(\" \"), font_size=font_size)\n",
        "        paragraph.next_to(script_text, DOWN, aligned_edge=LEFT)\n",
        "        paragraph.set_color(YELLOW)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(script_text),\n",
        "            FadeOut(flat_script),\n",
        "            FadeOut(VGroup(in_text, in_arrow, prediction)),\n",
        "        )\n",
        "\n",
        "        # Repeatedly add predictions\n",
        "        machine.scale(1.25, about_edge=RIGHT)\n",
        "        out_arrow.next_to(machine, DOWN, buff=0.5)\n",
        "\n",
        "        blocks = machine[0]\n",
        "        dials = Dial().get_grid(11, 16)\n",
        "        dials.set_width(blocks[-1].get_width() * 0.95)\n",
        "        dials.rotate(5 * DEGREES, RIGHT).rotate(10 * DEGREES, UP)\n",
        "        dials.move_to(blocks[-1])\n",
        "        dials.set_stroke(opacity=0.5)\n",
        "        for dial in dials:\n",
        "            dial.set_value(dial.get_random_value())\n",
        "        dials.set_z_index(2)\n",
        "        self.add(dials)\n",
        "\n",
        "        curr_answer = VGroup()\n",
        "        curr_answer.next_to(script_text, DOWN)\n",
        "        for n in range(6):\n",
        "            word = words[n]\n",
        "            prediction = Text(words[n], font_size=72)\n",
        "            prediction.next_to(out_arrow, DOWN)\n",
        "            word_in_answer = paragraph[len(curr_answer):len(curr_answer) + len(word)]\n",
        "            word_in_answer.set_color(YELLOW)\n",
        "            mover = VGroup(script_text, curr_answer).copy()\n",
        "\n",
        "            if n > 2:\n",
        "                self.skip_animations = True\n",
        "\n",
        "            self.play(\n",
        "                mover.animate.set_height(1.8).next_to(machine, UP, SMALL_BUFF).set_anim_args(path_arc=-30 * DEGREES),\n",
        "            )\n",
        "            self.animate_text_input(\n",
        "                mover, machine,\n",
        "                position_text_over_machine=False,\n",
        "                lag_ratio=1e-3\n",
        "            )\n",
        "            self.play(FadeIn(prediction, DOWN, rate_func=rush_from, run_time=0.5))\n",
        "\n",
        "            if n > 2:\n",
        "                self.skip_animations = False\n",
        "                self.wait(0.5)\n",
        "                self.skip_animations = True\n",
        "\n",
        "            self.play(\n",
        "                curr_answer.animate.set_color(WHITE),\n",
        "                Transform(prediction, word_in_answer),\n",
        "                FadeOut(mover),\n",
        "            )\n",
        "            curr_answer.add(*word_in_answer)\n",
        "            self.add(curr_answer)\n",
        "            self.remove(prediction)\n",
        "\n",
        "    def get_text(self):\n",
        "        script_text = Text(\"\"\"\n",
        "            Human:\n",
        "            Can you explain the history of\n",
        "            transistors and how they're relevant\n",
        "            to computers? What is a transistor,\n",
        "            and how exactly is it used to\n",
        "            perform computations?\n",
        "\n",
        "            AI assistant:\n",
        "        \"\"\", alignment=\"LEFT\")\n",
        "        script_text[\"Human\"].set_color(BLUE)\n",
        "        script_text[\"AI assistant\"].set_color(TEAL)\n",
        "\n",
        "        script_text.set_height(4).to_edge(UP)\n",
        "        return script_text\n",
        "\n",
        "    def create_image(self):\n",
        "        # Create image\n",
        "        script_text = self.get_text()\n",
        "        script_text.set_fill(BLACK)\n",
        "        script_text[\"Human\"].set_fill(BLUE_D)\n",
        "        script_text[\"AI assistant\"].set_fill(TEAL_D)\n",
        "        self.add(FullScreenRectangle(fill_color=\"#FCF5E5\", fill_opacity=1))\n",
        "        self.add(script_text)\n",
        "\n",
        "        # Add off test\n",
        "        tear_off = SVGMobject('TearOff')\n",
        "        tear_off.set_stroke(width=0)\n",
        "        tear_off.set_fill(BLACK, 1)\n",
        "        tear_off.set_width(7.5)\n",
        "        tear_off.next_to(script_text, DOWN, buff=-0.2)\n",
        "        self.add(tear_off)\n",
        "\n",
        "\n",
        "class ShowMachineWithDials(PredictTheNextWord):\n",
        "    words = ['worst', 'age', 'worse', 'best', 'most', 'end', 'very', 'blur']\n",
        "    logprobs = [4.0, 2.15, 1.89, 1.4, 0.1, -0.18, -0.23, -0.61]\n",
        "\n",
        "    def construct(self):\n",
        "        # Show machine (same position as in PredictTheNextWord)\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "        blocks, llm_text, flat_dials, last_dials = self.get_blocks_and_dials()\n",
        "\n",
        "        self.clear()\n",
        "        self.add(frame)\n",
        "        frame.reorient(0, 0, 0, (-0.17, -0.12, 0.0), 4.50)\n",
        "        self.add(blocks, llm_text, last_dials)\n",
        "\n",
        "        # Prepare dial highlight\n",
        "        last_dials.target = last_dials.generate_target()\n",
        "        self.fix_dials(last_dials.target)\n",
        "\n",
        "        small_rect = SurroundingRectangle(last_dials[0], buff=0.025)\n",
        "        small_rect.set_stroke(BLUE, 2)\n",
        "        big_rect = small_rect.copy().scale(4)\n",
        "        big_rect.next_to(blocks, UP, buff=SMALL_BUFF, aligned_edge=LEFT + OUT)\n",
        "        big_rect.shift(1.5 * RIGHT)\n",
        "        big_dial = last_dials[0].copy().scale(4).set_stroke(opacity=1)\n",
        "        big_dial.move_to(big_rect)\n",
        "        rect_lines = VGroup(\n",
        "            Line(small_rect.get_corner(UL), big_rect.get_corner(DL)),\n",
        "            Line(small_rect.get_corner(UR), big_rect.get_corner(DR)),\n",
        "        )\n",
        "        rect_lines.set_stroke(WHITE, width=(1, 3))\n",
        "        highlighed_parameter_group = VGroup(small_rect, rect_lines, big_rect, big_dial)\n",
        "\n",
        "        last_dials.set_stroke(width=1, opacity=1)\n",
        "        self.play(\n",
        "            MoveToTarget(last_dials),\n",
        "            FadeOut(llm_text),\n",
        "            FadeIn(small_rect),\n",
        "        )\n",
        "\n",
        "        # Show an example input and output\n",
        "        example = self.get_example(blocks)\n",
        "        in_text, in_arrow, out_arrow, bar_groups = example\n",
        "        logprobs = example.logprobs\n",
        "        true_probs = 100 * softmax(logprobs)\n",
        "        bar_groups = self.get_output_distribution(self.words, 0.1 * logprobs, out_arrow)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                ShowCreation(rect_lines, lag_ratio=0),\n",
        "                TransformFromCopy(small_rect, big_rect),\n",
        "                TransformFromCopy(last_dials[0], big_dial),\n",
        "                FadeIn(in_text),\n",
        "                GrowArrow(in_arrow),\n",
        "                FadeIn(bar_groups),\n",
        "                GrowArrow(out_arrow),\n",
        "            ),\n",
        "            frame.animate.reorient(0, 0, 0, (-0.43, 0.38, 0.0), 7.05),\n",
        "            run_time=2\n",
        "        )\n",
        "        self.play(\n",
        "            last_dials[0].animate_set_value(0.8),\n",
        "            big_dial.animate_set_value(0.8),\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(dial.get_random_value())\n",
        "                for dial in last_dials[1:]),\n",
        "                lag_ratio=1.0 / len(last_dials),\n",
        "            ),\n",
        "            *(\n",
        "                self.bar_group_change_animation(bg, value)\n",
        "                for bg, value in zip(bar_groups[:-1], true_probs)\n",
        "            ),\n",
        "            run_time=3\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Play around tweaking the parameters, and seeing the output change\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(0)\n",
        "                for dial in last_dials[:12]),\n",
        "                lag_ratio=0.01,\n",
        "            ),\n",
        "            big_dial.animate_set_value(0),\n",
        "            self.bar_group_change_animation(bar_groups[0], 50),\n",
        "            self.bar_group_change_animation(bar_groups[1], 34),\n",
        "            self.bar_group_change_animation(bar_groups[2], 5),\n",
        "            run_time=4,\n",
        "        )\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(1)\n",
        "                for dial in last_dials[:12]),\n",
        "                lag_ratio=0.01,\n",
        "            ),\n",
        "            big_dial.animate_set_value(1),\n",
        "            self.bar_group_change_animation(bar_groups[0], 80),\n",
        "            self.bar_group_change_animation(bar_groups[1], 5),\n",
        "            self.bar_group_change_animation(bar_groups[2], 15),\n",
        "            run_time=4,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Mention randomness\n",
        "        random_words = Text(\"Initially random\")\n",
        "        random_words.next_to(blocks, UP)\n",
        "        random_words.set_color(RED)\n",
        "        out_dots = Tex(R\"...\", font_size=120)\n",
        "        out_dots.next_to(out_arrow, RIGHT)\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(big_rect),\n",
        "            Uncreate(rect_lines, lag_ratio=0),\n",
        "            FadeOut(small_rect),\n",
        "            Transform(big_dial, last_dials[0])\n",
        "        )\n",
        "        self.play(\n",
        "            Write(random_words),\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(dial.get_random_value())\n",
        "                for dial in last_dials),\n",
        "                lag_ratio=0.5 / len(last_dials),\n",
        "                run_time=2\n",
        "            ),\n",
        "            FadeOut(bar_groups),\n",
        "        )\n",
        "        self.play(Write(out_dots))\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(dots),\n",
        "            FadeOut(random_words),\n",
        "            FadeIn(bar_groups),\n",
        "        )\n",
        "\n",
        "        # Show many many parameters\n",
        "        example.save_state()\n",
        "        blocks.save_state()\n",
        "        last_dials.save_state()\n",
        "        all_dials = VGroup(*flat_dials, *last_dials)\n",
        "        all_dials.generate_target()\n",
        "        all_dials.target.space_out_submobjects(3)\n",
        "        new_dials = VGroup(\n",
        "            all_dials.target.copy().shift(3 * 2 * x * (flat_dials.get_center() - last_dials.get_center()))\n",
        "            for x in range(1, 9)\n",
        "        )\n",
        "\n",
        "        self.play(\n",
        "            FadeOut(example),\n",
        "            FadeOut(blocks),\n",
        "            FadeIn(flat_dials),\n",
        "            FadeOut(bar_groups),\n",
        "            FadeOut(out_arrow),\n",
        "        )\n",
        "        self.play(\n",
        "            FadeOut(highlighed_parameter_group),\n",
        "            MoveToTarget(all_dials),\n",
        "            LaggedStart(\n",
        "                (TransformFromCopy(all_dials.copy().set_opacity(0), nd)\n",
        "                for nd in new_dials),\n",
        "                lag_ratio=0.05,\n",
        "            ),\n",
        "            frame.animate.reorient(-9, 0, 0, (-0.71, -0.07, -0.06), 9.64),\n",
        "            run_time=4\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "    def get_blocks_and_dials(self):\n",
        "        machine = self.get_transformer_drawing()\n",
        "        machine.move_to(ORIGIN)\n",
        "        self.machine = machine\n",
        "\n",
        "        blocks = machine[0]\n",
        "        llm_text = machine[1]\n",
        "        llm_text.set_backstroke(BLACK, 2)\n",
        "        flat_dials, last_dials = self.get_machine_dials(blocks)\n",
        "        return blocks, llm_text, flat_dials, last_dials\n",
        "\n",
        "    def get_example(self, blocks):\n",
        "        in_text = Text(\"It was the best\\nof times it was\\nthe _\", alignment=\"LEFT\")\n",
        "        in_text[-1].stretch(4, 0, about_edge=LEFT)\n",
        "        in_text.next_to(blocks, LEFT, LARGE_BUFF)\n",
        "        in_arrow = Arrow(in_text, blocks)\n",
        "\n",
        "        out_arrow = Vector(RIGHT)\n",
        "        out_arrow.next_to(blocks[-1], RIGHT, buff=0.1)\n",
        "        logprobs = np.array(self.logprobs)\n",
        "        bar_groups = self.get_output_distribution(self.words, logprobs, out_arrow)\n",
        "        example = VGroup(in_text, in_arrow, out_arrow, bar_groups)\n",
        "        example.logprobs = logprobs\n",
        "        return example\n",
        "\n",
        "    def fix_dials(self, dials):\n",
        "        for dial in dials:\n",
        "            dial.set_stroke(width=1, opacity=1)\n",
        "            dial.needle.set_stroke(width=(2, 0))\n",
        "        return dials\n",
        "\n",
        "    def bar_group_change_animation(self, bar_group, new_value):\n",
        "        text, rect, value_mob = bar_group\n",
        "        buff = value_mob.get_left() - rect.get_right()\n",
        "        factor = new_value / value_mob.get_value()\n",
        "\n",
        "        return AnimationGroup(\n",
        "            rect.animate.stretch(factor, 0, about_edge=LEFT),\n",
        "            ChangeDecimalToValue(value_mob, new_value),\n",
        "            UpdateFromFunc(text, lambda m: value_mob.move_to(rect.get_right() + buff, LEFT)),\n",
        "        )\n",
        "\n",
        "    def get_output_distribution(self, words, logprobs, out_arrow):\n",
        "        probs = softmax(logprobs)\n",
        "        bar_groups = self.get_distribution(words, probs, self.machine, width_100p=1.0)\n",
        "        bar_groups.next_to(out_arrow, RIGHT)\n",
        "        return bar_groups\n",
        "\n",
        "\n",
        "class ShowSingleTrainingExample(ShowMachineWithDials):\n",
        "    logprobs = [4.0, 6.15, 1.89, 1.4, 0.1, -0.18, -0.23, -0.61]\n",
        "\n",
        "    def construct(self):\n",
        "        # Add state from before\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "\n",
        "        blocks, llm_text, flat_dials, last_dials = self.get_blocks_and_dials()\n",
        "        self.fix_dials(last_dials)\n",
        "        example = self.get_example(blocks)\n",
        "        in_text, in_arrow, out_arrow, bar_groups = example\n",
        "\n",
        "        self.add(blocks, last_dials)\n",
        "\n",
        "        # Show example up top\n",
        "        parts = (\"It was the best of times it was the\", \"worst\")\n",
        "        sentence = Text(\" \".join(parts))\n",
        "        start = sentence[parts[0]][0]\n",
        "        end = sentence[parts[1]][0]\n",
        "        sentence.set_width(10)\n",
        "        sentence.next_to(blocks, UP, buff=1.5)\n",
        "\n",
        "        start_rect = SurroundingRectangle(start)\n",
        "        start_rect.set_stroke(BLUE, 2)\n",
        "        start_rect.set_fill(BLUE, 0.2)\n",
        "        end_rect = SurroundingRectangle(end)\n",
        "        end_rect.match_height(start_rect, stretch=True).match_y(start_rect)\n",
        "        end_rect.set_stroke(YELLOW, 2)\n",
        "        end_rect.set_fill(YELLOW, 0.2)\n",
        "        arrow = Arrow(start_rect.get_top(), end_rect.get_top(), path_arc=-90 * DEGREES, thickness=5)\n",
        "        arrow.set_fill(border_width=1)\n",
        "\n",
        "        frame.reorient(0, 0, 0, (-0.36, 0.97, 0.0), 7.52)\n",
        "        self.play(FadeIn(sentence, UP))\n",
        "        self.play(\n",
        "            LaggedStartMap(DrawBorderThenFill, VGroup(start_rect, end_rect)),\n",
        "            FadeIn(arrow),\n",
        "        )\n",
        "        self.remove(last_dials)\n",
        "        self.play(LaggedStart(\n",
        "            AnimationGroup(\n",
        "                TransformFromCopy(start, in_text[:-1]),\n",
        "                TransformFromCopy(end_rect, in_text[-1]),\n",
        "                FadeIn(in_arrow)\n",
        "            ),\n",
        "            LaggedStart(\n",
        "                (\n",
        "                    block.animate.set_color(\n",
        "                        block.get_color() if block is blocks[-1] else TEAL\n",
        "                    ).set_anim_args(rate_func=there_and_back)\n",
        "                    for block in blocks\n",
        "                ),\n",
        "                group=blocks,\n",
        "                lag_ratio=0.1,\n",
        "                run_time=1\n",
        "            ),\n",
        "            Animation(last_dials),\n",
        "            GrowArrow(out_arrow),\n",
        "            LaggedStartMap(GrowFromPoint, bar_groups, point=out_arrow.get_start()),\n",
        "            lag_ratio=0.3\n",
        "        ))\n",
        "        self.wait()\n",
        "\n",
        "        # Flag bad prediction\n",
        "        out_rects = VGroup(\n",
        "            SurroundingRectangle(bg)\n",
        "            for bg in bar_groups[:2]\n",
        "        )\n",
        "        out_rects.set_stroke(RED, 3)\n",
        "        annotations = VGroup(\n",
        "            Tex(tex, font_size=60).next_to(rect, LEFT, buff=SMALL_BUFF)\n",
        "            for rect, tex in zip(out_rects, [R\"\\uparrow\", R\"\\downarrow\"])\n",
        "        )\n",
        "        annotations.set_color(RED)\n",
        "\n",
        "        self.play(\n",
        "            FadeTransform(end_rect.copy(), out_rects[0]),\n",
        "            Write(annotations[0]),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeTransform(*out_rects),\n",
        "            FadeTransform(*annotations),\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            FadeOut(out_rects[1]),\n",
        "            FadeOut(annotations[1]),\n",
        "        )\n",
        "\n",
        "        # Adjust\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(dial.get_random_value())\n",
        "                for dial in last_dials),\n",
        "                lag_ratio=1.0 / len(last_dials),\n",
        "            ),\n",
        "            LaggedStart(\n",
        "                (FlashAround(dial, stroke_width=2, color=YELLOW, time_width=1, buff=0.025) for dial in last_dials),\n",
        "                lag_ratio=1.0 / len(last_dials),\n",
        "            ),\n",
        "            self.bar_group_change_animation(bar_groups[0], 70),\n",
        "            self.bar_group_change_animation(bar_groups[1], 20),\n",
        "            self.bar_group_change_animation(bar_groups[2], 8),\n",
        "            run_time=6\n",
        "        )\n",
        "\n",
        "\n",
        "class ParameterWeight(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        text = Text(\"Parameter / Weight\", font_size=72)\n",
        "        text.to_edge(UP)\n",
        "        text.set_color(YELLOW)\n",
        "        param = text[\"Parameter\"][0]\n",
        "        param.save_state()\n",
        "        param.set_x(0)\n",
        "\n",
        "        self.play(Write(param))\n",
        "        self.wait()\n",
        "        self.play(LaggedStart(\n",
        "            Restore(param),\n",
        "            FadeIn(text[\"/ Weight\"]),\n",
        "        ))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class LargeInLargeLanguageModel(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        text = Text(\"Large Language Model\", font_size=72)\n",
        "        text.to_edge(UP)\n",
        "        large = text[\"Large\"][0]\n",
        "        large.save_state()\n",
        "        large.set_x(0)\n",
        "\n",
        "        self.add(large)\n",
        "        self.play(FlashUnder(large), large.animate.set_color(YELLOW))\n",
        "        self.play(\n",
        "            Restore(large, path_arc=-30 * DEGREES),\n",
        "            Write(text[len(large):], time_span=(0.5, 1.5))\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ThousandsOfWords(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Find passage\n",
        "        file = Path(\"/Users/grant/3Blue1Brown Dropbox/3Blue1Brown/videos/2024/transformers/data/tale_of_two_cities.txt\")\n",
        "        novel = file.read_text()\n",
        "        start_index = novel.index(\"It was the best of times\")\n",
        "        end_index = novel.index(\"There were a king with a large jaw\")\n",
        "\n",
        "        # Add text\n",
        "        passage = novel[start_index:start_index + 5000].replace(\"\\n\", \" \")\n",
        "        text = get_paragraph(passage.split(\" \"), line_len=150)\n",
        "        text.set_width(14)\n",
        "        text.to_edge(UP)\n",
        "        self.add(text)\n",
        "\n",
        "\n",
        "class EnormousAmountOfTrainingText(PremiseOfMLWithText):\n",
        "    def construct(self):\n",
        "        # Setup\n",
        "        self.init_data()\n",
        "        # n_rows = n_cols = 41\n",
        "        n_rows = n_cols = 9\n",
        "        screens = VGroup()\n",
        "        for row in range(n_rows):\n",
        "            for col in range(n_cols):\n",
        "                screen = self.get_screen()\n",
        "                screen.move_to(FRAME_WIDTH * row * RIGHT + FRAME_HEIGHT * col * DOWN)\n",
        "                screens.add(screen)\n",
        "        screens.center()\n",
        "        screens.submobjects.sort(key=lambda sm: get_norm(sm.machine.get_center()))\n",
        "\n",
        "        self.add(screens)\n",
        "\n",
        "        # Add frame growth\n",
        "        frame = self.frame\n",
        "        frame.clear_updaters()\n",
        "        frame.add_updater(lambda m: m.set_height(FRAME_HEIGHT * np.exp(0.2 * self.time)))\n",
        "\n",
        "        # Show lots of new data\n",
        "        inner_screens = screens[:25]\n",
        "        n_examples = 20\n",
        "        for n in range(n_examples):\n",
        "            self.play(LaggedStart(\n",
        "                *(self.change_example_animation(screen, show_dial_change=True)\n",
        "                for screen in inner_screens),\n",
        "                lag_ratio=0.1,\n",
        "                run_time=0.5,\n",
        "            ))\n",
        "\n",
        "    def change_example_animation(self, screen, show_dial_change=True):\n",
        "        new_example = VGroup(*self.new_input_output_example(*screen.arrows))\n",
        "        time_span = (0, 0.35)\n",
        "        anims = [\n",
        "            FadeOut(screen.training_example, time_span=time_span),\n",
        "            FadeIn(new_example, time_span=time_span),\n",
        "        ]\n",
        "        if show_dial_change:\n",
        "            anims.append(screen.machine.random_change_animation(run_time=0.5))\n",
        "        screen.training_example = new_example\n",
        "        return AnimationGroup(*anims)\n",
        "\n",
        "    def get_screen(self):\n",
        "        border = FullScreenRectangle()\n",
        "        border.set_fill(opacity=0)\n",
        "        border.set_stroke(WHITE, 2)\n",
        "\n",
        "        machine = MachineWithDials(width=3.5, height=2.5, n_rows=5, n_cols=7)\n",
        "        machine.move_to(1.0 * RIGHT)\n",
        "        in_arrow, out_arrow = arrows = Vector(RIGHT).replicate(2)\n",
        "        in_arrow.next_to(machine, LEFT)\n",
        "        out_arrow.next_to(machine, RIGHT)\n",
        "        in_data, out_data = training_example = VGroup(\n",
        "            *self.new_input_output_example(in_arrow, out_arrow)\n",
        "        )\n",
        "\n",
        "        screen = VGroup(\n",
        "            border, machine,\n",
        "            arrows, training_example\n",
        "        )\n",
        "        screen.border = border\n",
        "        screen.machine = machine\n",
        "        screen.arrows = arrows\n",
        "        screen.training_example = training_example\n",
        "\n",
        "        return screen\n",
        "\n",
        "    def new_input_output_example(self, in_arrow, out_arrow):\n",
        "        in_data, out_data = super().new_input_output_example(in_arrow, out_arrow)\n",
        "        in_data.scale(0.8, about_edge=RIGHT)\n",
        "        out_data.scale(0.8, about_edge=LEFT)\n",
        "        return in_data, out_data\n",
        "\n",
        "\n",
        "class BadChatBot(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add bot\n",
        "        bot = self.get_bot()\n",
        "        bot.set_height(3)\n",
        "\n",
        "        lines = Line(LEFT, RIGHT).get_grid(4, 1, buff=0.25)\n",
        "        lines.set_stroke(WHITE, 1)\n",
        "        lines[-1].stretch(0.5, 0, about_edge=LEFT)\n",
        "        lines.set_width(3)\n",
        "        bubble = SpeechBubble(lines, buff=MED_LARGE_BUFF)\n",
        "        bubble.set_stroke(width=5)\n",
        "        bubble.pin_to(bot).shift(DOWN)\n",
        "\n",
        "        self.add(bot)\n",
        "        self.play(Write(bubble, run_time=3))\n",
        "        self.blink(bot)\n",
        "        self.wait()\n",
        "\n",
        "        # Make lines bad\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (Transform(line, self.get_scribble(line))\n",
        "                for line in lines),\n",
        "                lag_ratio=0.1,\n",
        "                run_time=2\n",
        "            )\n",
        "        )\n",
        "        for _ in range(2):\n",
        "            self.blink(bot)\n",
        "            self.wait(2)\n",
        "\n",
        "    def get_scribble(self, line):\n",
        "        freqs = np.random.random(5)\n",
        "        graph = FunctionGraph(\n",
        "            lambda x: 0.05 * sum(math.sin(freq * TAU * x) for freq in freqs),\n",
        "            x_range=(0, 5, 0.1)\n",
        "        )\n",
        "        graph.put_start_and_end_on(*line.get_start_and_end())\n",
        "        graph.match_style(line)\n",
        "        graph.set_stroke(color=RED)\n",
        "        return graph\n",
        "\n",
        "    def get_bot(self):\n",
        "        bot = SVGMobject(\"Bot\")\n",
        "        subpaths = bot[0].get_subpaths()\n",
        "        bot[0].set_points([*subpaths[0], subpaths[0][-1], *subpaths[1]])\n",
        "        eyes = VGroup(Dot().replace(VMobject().set_points(subpath)) for subpath in subpaths[2:])\n",
        "        bot.eyes = eyes\n",
        "        bot.add(eyes)\n",
        "        bot.set_stroke(width=0)\n",
        "\n",
        "        bot.set_height(4)\n",
        "        bot.set_fill(GREY_B)\n",
        "        bot.set_shading(0.5, 0.5, 1)\n",
        "\n",
        "        return bot\n",
        "\n",
        "    def blink(self, bot):\n",
        "        self.play(\n",
        "            bot.eyes.animate.stretch(0, 1).set_anim_args(rate_func=squish_rate_func(there_and_back))\n",
        "        )\n",
        "\n",
        "\n",
        "class WriteRLHF(InteractiveScene):\n",
        "    def construct(self):\n",
        "        text = Text(\"Step 2: RLHF\")\n",
        "        full_text = Text(\"Reinforcement Learning\\nwith Human Feedback\")\n",
        "        full_text.next_to(text, UP, LARGE_BUFF)\n",
        "        full_text.align_to(text, RIGHT).shift(RIGHT)\n",
        "        initials = VGroup(full_text[letter[0]][0][0] for letter in \"RLHF\")\n",
        "        full_text.remove(*initials)\n",
        "\n",
        "        self.add(text)\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            TransformFromCopy(text[\"RLHF\"][0], initials, lag_ratio=0.25),\n",
        "            Write(full_text, time_span=(1.5, 3)),\n",
        "            run_time=3\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class RLHFWorker(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        self.add(FullScreenRectangle().set_fill(GREY_E, 1))\n",
        "        # worker = SVGMobject(\"computer_stall\")\n",
        "        worker = SVGMobject(\"comp_worker\")\n",
        "        worker.set_height(4)\n",
        "        worker.move_to(4 * LEFT)\n",
        "        worker.set_fill(GREY_C, 1)\n",
        "\n",
        "        rect = Rectangle(7, 5)\n",
        "        rect.to_edge(RIGHT)\n",
        "        rect.set_stroke(WHITE, 2)\n",
        "        rect.set_fill(BLACK, 1)\n",
        "\n",
        "        self.add(worker)\n",
        "        self.add(rect)\n",
        "\n",
        "\n",
        "class RLHFWorkers(ShowMachineWithDials):\n",
        "    def construct(self):\n",
        "        # Add workers\n",
        "        self.add(FullScreenRectangle().set_fill(GREY_E, 1))\n",
        "        workers = SVGMobject(\"comp_worker\").get_grid(3, 2, buff=0.5)\n",
        "        workers.set_height(7)\n",
        "        workers.to_edge(LEFT)\n",
        "        workers.set_fill(GREY_C, 1)\n",
        "\n",
        "        self.add(workers)\n",
        "\n",
        "        # Machine\n",
        "        blocks, llm_text, flat_dials, last_dials = self.get_blocks_and_dials()\n",
        "        machine = VGroup(blocks, last_dials)\n",
        "        machine.set_height(4)\n",
        "        machine.center().to_edge(RIGHT, buff=LARGE_BUFF)\n",
        "        last_dials.set_stroke(opacity=1)\n",
        "\n",
        "        self.add(machine)\n",
        "\n",
        "        for _ in range(8):\n",
        "            self.play(LaggedStart(\n",
        "                (dial.animate_set_value(dial.get_random_value())\n",
        "                for dial in last_dials),\n",
        "                lag_ratio=0.5 / len(last_dials),\n",
        "                run_time=2\n",
        "            ))\n",
        "            self.wait()\n",
        "\n",
        "\n",
        "class SerialProcessing(InteractiveScene):\n",
        "    phrase = \"It was the best of times it was the worst of times\"\n",
        "    phrase_center = 2 * UP\n",
        "\n",
        "    def construct(self):\n",
        "        # Set up words\n",
        "        words = self.get_words()\n",
        "        rects = get_piece_rectangles(words)\n",
        "\n",
        "        self.add(rects)\n",
        "        self.add(words)\n",
        "\n",
        "        # Animate in the vectors\n",
        "        vectors = VGroup(\n",
        "            self.get_abstract_vector().next_to(word, DOWN, LARGE_BUFF)\n",
        "            for word in words\n",
        "        )\n",
        "        last_vect = VGroup(VectorizedPoint(rects[0].get_bottom()))\n",
        "\n",
        "        for word, vect in zip(words, vectors):\n",
        "            self.play(\n",
        "                FadeIn(vect, run_time=2),\n",
        "                LaggedStart(\n",
        "                    (ContextAnimation(\n",
        "                        square, VGroup(*word, *last_vect),\n",
        "                        direction=DOWN,\n",
        "                        lag_ratio=0.01,\n",
        "                        path_arc=30 * DEGREES\n",
        "                    )\n",
        "                    for square in vect),\n",
        "                    lag_ratio=0.05,\n",
        "                    run_time=2\n",
        "                ),\n",
        "                last_vect.animate.set_opacity(0.2)\n",
        "            )\n",
        "            last_vect = vect\n",
        "\n",
        "    def get_words(self):\n",
        "        result = break_into_words(Text(self.phrase))\n",
        "        result.move_to(self.phrase_center)\n",
        "        return result\n",
        "\n",
        "    def get_abstract_vector(self, values=None, default_length=10, elem_size=0.2):\n",
        "        if values is None:\n",
        "            values = np.random.uniform(-1, 1, default_length)\n",
        "        result = Square().get_grid(len(values), 1, buff=0)\n",
        "        result.set_width(elem_size)\n",
        "        result.set_stroke(WHITE, 1)\n",
        "        for square, value in zip(result, values):\n",
        "            color = value_to_color(value, min_value=0, max_value=1)\n",
        "            square.set_fill(color, opacity=1)\n",
        "        return result\n",
        "\n",
        "\n",
        "class ParallelProcessing(SerialProcessing):\n",
        "    def construct(self):\n",
        "        # Set up words\n",
        "        words = self.get_words()\n",
        "        rects = get_piece_rectangles(words)\n",
        "\n",
        "        self.add(rects)\n",
        "        self.add(words)\n",
        "\n",
        "        # Animate in the vectors\n",
        "        vectors = VGroup(\n",
        "            self.get_abstract_vector().next_to(word, DOWN, buff=1.5)\n",
        "            for word in words\n",
        "        )\n",
        "\n",
        "        lines = VGroup(\n",
        "            Line(\n",
        "                rect.get_bottom(), vect.get_top(),\n",
        "                buff=0.05,\n",
        "                stroke_color=WHITE,\n",
        "                stroke_width=2 * random.random()**3\n",
        "            )\n",
        "            for rect in rects\n",
        "            for vect in vectors\n",
        "        )\n",
        "        lines.shuffle()\n",
        "\n",
        "        for vect, word in zip(vectors, words):\n",
        "            vect.save_state()\n",
        "            for square in vect:\n",
        "                square.move_to(word)\n",
        "                square.set_opacity(0)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStartMap(ShowCreation, lines, lag_ratio=0.01),\n",
        "            LaggedStartMap(Restore, vectors, lag_ratio=0)\n",
        "        )\n",
        "        self.play(lines.animate.set_stroke(opacity=0.25))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ManyComputationsPerUnitTimeV2(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Add computations\n",
        "        box = Rectangle(5, 5)\n",
        "        label = Text(\"1 Billion computations per Second\")\n",
        "        label.next_to(box, UP)\n",
        "        self.add(box)\n",
        "        self.add(label)\n",
        "\n",
        "        comps = self.get_computations(box)\n",
        "        self.add(comps)\n",
        "        self.wait(3)\n",
        "\n",
        "        # Place box into minute interval\n",
        "        width = FRAME_WIDTH - 1\n",
        "        number_lines = VGroup(\n",
        "            minute_line := NumberLine((0, 60, 1), width=width, big_tick_spacing=10),\n",
        "            hour_line := NumberLine((0, 60, 1), width=width, big_tick_spacing=10),\n",
        "            day_line := NumberLine((0, 24, 1), width=width, big_tick_spacing=6),\n",
        "            month_line := NumberLine((0, 31, 1), width=width),\n",
        "            year_line := NumberLine((0, 12, 1), width=width),\n",
        "            y100_line := NumberLine((0, 100, 1), width=width),\n",
        "            y10k_line := NumberLine((0, 100, 1), width=width),\n",
        "            y1M_line := NumberLine((0, 100, 1), width=width),\n",
        "            y100M_line := NumberLine((0, 100, 1), width=width),\n",
        "        )\n",
        "        number_lines.move_to(DOWN)\n",
        "\n",
        "        first_ticks = minute_line.ticks[:2]\n",
        "        sec_brace = Brace(first_ticks, DOWN, buff=0, tex_string=R\"\\underbrace{\\qquad\\qquad}\")\n",
        "        sec_label = Text(\"Second\", font_size=30).next_to(sec_brace, DOWN, SMALL_BUFF)\n",
        "\n",
        "        self.play(\n",
        "            ShowCreation(minute_line, lag_ratio=0.01),\n",
        "            box.animate.match_width(first_ticks).move_to(first_ticks.get_center(), DOWN).set_stroke(width=1),\n",
        "            TransformFromCopy(label[\"Second\"][0], sec_label),\n",
        "            GrowFromCenter(sec_brace),\n",
        "            run_time=2\n",
        "        )\n",
        "\n",
        "        # Add other boxes\n",
        "        minute_label = self.get_timeline_full_label(number_lines[1], \"Minute\")\n",
        "        new_boxes = VGroup(\n",
        "            box.copy().move_to(tick.get_center(), DL)\n",
        "            for tick in minute_line.ticks[1:-1]\n",
        "        )\n",
        "        for new_box in new_boxes:\n",
        "            new_box.save_state()\n",
        "            new_box.move_to(box)\n",
        "        computations = VGroup(\n",
        "            self.get_computations(new_box, n_iterations=1)\n",
        "            for new_box in new_boxes\n",
        "        )\n",
        "        # computations = VGroup()  # If needed\n",
        "\n",
        "        self.add(computations)\n",
        "        self.play(\n",
        "            FadeIn(minute_label, DOWN),\n",
        "            LaggedStartMap(Restore, new_boxes, lag_ratio=0.1),\n",
        "            run_time=2\n",
        "        )\n",
        "        self.wait(2)\n",
        "\n",
        "        # Add labels\n",
        "        minute_line.add(minute_label)\n",
        "        names = [\"Hour\", \"Day\", \"Month\", \"Year\", \"100 Years\", \"10,000 Years\", \"1,000,000 Years\", \"100,000,000 Years\"]\n",
        "        for line, name in zip(number_lines[1:], names):\n",
        "            line.label = self.get_timeline_full_label(line, name)\n",
        "            line.add(line.label)\n",
        "\n",
        "        # Arrange all lines\n",
        "        number_lines[1:].arrange(DOWN, buff=2.0)\n",
        "        number_lines[1:].next_to(minute_line, DOWN, buff=2.0)\n",
        "\n",
        "        scale_lines = VGroup()\n",
        "        for nl1, nl2 in zip(number_lines, number_lines[1:]):\n",
        "            n = len(nl2.ticks) // 2\n",
        "            mini_line = Line(nl2.ticks[n - 1].get_center(), nl2.ticks[n].get_center())\n",
        "            pair = VGroup(\n",
        "                DashedLine(nl1.get_start(), mini_line.get_start()),\n",
        "                DashedLine(nl1.get_end(), mini_line.get_end()),\n",
        "            )\n",
        "            pair.set_stroke(WHITE, 2)\n",
        "            nl1.target = nl1.copy()\n",
        "            nl1.target.replace(mini_line, dim_to_match=0)\n",
        "            nl1.target.shift(mini_line.pfp(0.5) - nl1.target.pfp(0.5))\n",
        "            scale_lines.add(pair)\n",
        "\n",
        "        # Start panning down\n",
        "        lag_ratio = 1.5\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                *(AnimationGroup(*(ShowCreation(sl) for sl in pair)) for pair in scale_lines),\n",
        "                lag_ratio=lag_ratio,\n",
        "            ),\n",
        "            LaggedStart(\n",
        "                *(FadeIn(nl) for nl in number_lines[1:]),\n",
        "                lag_ratio=lag_ratio,\n",
        "            ),\n",
        "            LaggedStart(\n",
        "                *(TransformFromCopy(nl, nl.target) for nl in number_lines[:-1]),\n",
        "                lag_ratio=lag_ratio,\n",
        "            ),\n",
        "            self.frame.animate.set_y(number_lines[-1].get_y() + 2).set_width(18).set_anim_args(\n",
        "                rate_func=lambda t: interpolate(smooth(t), linear(t), there_and_back_with_pause(t, pause_ratio=0.8))\n",
        "            ),\n",
        "            run_time=30\n",
        "        )\n",
        "        self.play(self.frame.animate.reorient(0, 0, 0, (-0.03, -11.55, 0.0), 31.76), run_time=4)\n",
        "        self.wait(4)\n",
        "\n",
        "    def fade_in_bigger_interval(self, new_interval, prev_interval, fader, scale_factor, added_anims=[]):\n",
        "        pivot = prev_interval.n2p(0)\n",
        "        new_interval.save_state()\n",
        "        new_interval.scale(scale_factor, about_point=pivot)\n",
        "        new_interval[:-1].set_opacity(0)\n",
        "        new_interval[-1].set_fill(BLACK)\n",
        "\n",
        "        self.play(\n",
        "            Restore(new_interval),\n",
        "            prev_interval.animate.scale(1.0 / scale_factor, about_point=pivot).set_fill(border_width=0),\n",
        "            fader.animate.scale(1.0 / scale_factor, about_point=pivot).set_opacity(0),\n",
        "            *added_anims,\n",
        "            run_time=4,\n",
        "            rate_func=rush_from\n",
        "        )\n",
        "        self.remove(fader)\n",
        "\n",
        "    def get_timeline_full_label(self, timeline, name):\n",
        "        brace = Brace(Line().set_width(7), UP, buff=MED_SMALL_BUFF)\n",
        "        brace.set_fill(border_width=5)\n",
        "        brace.match_width(timeline)\n",
        "        brace.next_to(timeline, UP, buff=MED_SMALL_BUFF)\n",
        "        label = Text(name, font_size=72)\n",
        "        label.next_to(brace, UP, MED_SMALL_BUFF)\n",
        "\n",
        "        label.next_to(timeline, DOWN)\n",
        "        return label\n",
        "\n",
        "        return VGroup(brace, label)\n",
        "\n",
        "    def get_computations(self, box, n_lines=10, n_iterations=3, n_digits=4, cycle_time=0.5):\n",
        "        # Try adding lines\n",
        "        lines = VGroup()\n",
        "        for iteration in range(n_iterations):\n",
        "            cluster = VGroup()\n",
        "            for n in range(n_lines):\n",
        "                x = random.uniform(0, 10**(n_digits))\n",
        "                y = random.uniform(0, 10**(n_digits))\n",
        "                if random.choice([True, False]):\n",
        "                    comb = x * y\n",
        "                    sym = Tex(R\"\\times\")\n",
        "                else:\n",
        "                    comb = x + y\n",
        "                    sym = Tex(R\"+\")\n",
        "                line = VGroup(\n",
        "                    DecimalNumber(x, num_decimal_places=3), sym,\n",
        "                    DecimalNumber(y, num_decimal_places=3), Tex(\"=\"),\n",
        "                    DecimalNumber(comb, num_decimal_places=3)\n",
        "                )\n",
        "                line.arrange(RIGHT, buff=SMALL_BUFF)\n",
        "                lines.add(line)\n",
        "                cluster.add(line)\n",
        "            cluster.arrange(DOWN, buff=MED_LARGE_BUFF, aligned_edge=LEFT)\n",
        "            cluster.set_max_height(0.9 * box.get_height())\n",
        "            cluster.set_max_width(0.9 * box.get_width())\n",
        "            cluster.move_to(box)\n",
        "\n",
        "        # Add updater\n",
        "        def update_lines(lines):\n",
        "            sigma = 0.12\n",
        "            alpha = (self.time / (cycle_time * n_iterations)) % 1\n",
        "            step = 1.0 / len(lines)\n",
        "            for n, line in enumerate(lines):\n",
        "                x = min((\n",
        "                    abs(a - n * step)\n",
        "                    for a in (alpha - 1, alpha, alpha + 1)\n",
        "                ))\n",
        "                y = np.exp(-x**2 / sigma**2)\n",
        "                line.set_fill(opacity=y)\n",
        "\n",
        "            lines.set_height(0.9 * box.get_height())\n",
        "            lines.move_to(box)\n",
        "\n",
        "        lines.clear_updaters()\n",
        "        lines.add_updater(update_lines)\n",
        "\n",
        "        return lines\n",
        "\n",
        "    def old(self):\n",
        "        # Repeatedly scale down\n",
        "        to_fade = VGroup(sec_brace, sec_label, box, comps, new_boxes, computations)\n",
        "        scale_factors = [60, 24, 365, 1000]\n",
        "        for new_int, prev_int, scale_factor in zip(number_lines[1:], number_lines[0:], scale_factors):\n",
        "            self.fade_in_bigger_interval(\n",
        "                new_int, prev_int, to_fade, scale_factor,\n",
        "                added_anims=[label.animate.set_opacity(0)],\n",
        "            )\n",
        "            self.wait(2)\n",
        "            to_fade = prev_int\n",
        "\n",
        "        # Multiply last line by 100\n",
        "        self.fade_in_bigger_interval(\n",
        "            y1M_line, millenium_line, year_line, 1000,\n",
        "            added_anims=[self.frame.animate.reorient(0, 0, 0, (-3.51, -5.18, 0.0), 12.93)],\n",
        "        )\n",
        "\n",
        "        lines = Line(LEFT, RIGHT).replicate(100)\n",
        "        lines.match_width(y1M_line)\n",
        "        lines.arrange_to_fit_height(10)\n",
        "        lines.sort(lambda p: -p[1])\n",
        "        lines.set_stroke(WHITE, 1)\n",
        "        lines.move_to(y1M_line[0].get_center(), UP)\n",
        "\n",
        "        side_brace, label100M = self.get_timeline_full_label(y1M_line, \"100,000,000 Years\")\n",
        "        side_brace.rotate(PI / 2)\n",
        "        side_brace.match_height(lines)\n",
        "        side_brace.next_to(lines, LEFT)\n",
        "        label100M.next_to(side_brace, LEFT)\n",
        "\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (TransformFromCopy(lines[0].copy().set_opacity(0), line)\n",
        "                for line in lines),\n",
        "                lag_ratio=0.03,\n",
        "                run_time=2\n",
        "            ),\n",
        "            FadeIn(side_brace, scale=10, shift=2 * DOWN, time_span=(1, 2)),\n",
        "            FadeIn(label100M, time_span=(1, 2)),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class VectorLabel(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        brace = Brace(Line(4 * UP, ORIGIN), LEFT)\n",
        "        brace.center()\n",
        "        brace.set_stroke(WHITE, 3)\n",
        "        text = Text(\"Vector\", font_size=90)\n",
        "        text.next_to(brace, LEFT, MED_SMALL_BUFF)\n",
        "        text.shift(SMALL_BUFF * UP)\n",
        "\n",
        "        self.play(\n",
        "            GrowFromCenter(brace),\n",
        "            Write(text)\n",
        "        )\n",
        "        self.play(\n",
        "            FlashUnder(text, color=YELLOW)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ParameterToVectorAnnotation(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        dials = VGroup(Dial(value_range=(-10, 10, 1)) for _ in range(10))\n",
        "        dials.arrange(DOWN)\n",
        "        dials.set_height(5)\n",
        "\n",
        "        values = [1, 4.3, 2, 0.9, -1.5, 2.9, -1.2, 7.8, 0, -2.3]\n",
        "        arrows = VGroup(\n",
        "            Vector(0.5 * RIGHT, thickness=2).next_to(dial, RIGHT, buff=SMALL_BUFF)\n",
        "            for dial in dials\n",
        "        )\n",
        "\n",
        "        self.play(\n",
        "            Write(dials, lag_ratio=0.01),\n",
        "            LaggedStartMap(GrowArrow, arrows),\n",
        "        )\n",
        "        self.play(LaggedStart(\n",
        "            (dial.animate_set_value(value)\n",
        "            for dial, value in zip(dials, values)),\n",
        "            lag_ratio=0.05,\n",
        "        ))\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ThreeWordsToOne(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        image = ImageMobject(\"CHMTopText\")\n",
        "        image.set_height(FRAME_HEIGHT)\n",
        "        # self.add(image)\n",
        "\n",
        "        phrase = Text(\"Computer History Museum\", font_size=61)\n",
        "        words = VGroup(phrase[word][0] for word in phrase.get_text().split(\" \"))\n",
        "        words.move_to([0, 2.627, 0])\n",
        "        og_words = words.copy()\n",
        "        og_words.shift(DOWN)\n",
        "        words[0].shift(0.13 * LEFT)\n",
        "        words[2].shift(0.4 * RIGHT)\n",
        "        colors = [\"#63DCF7\", \"#90C9FA\", \"#85D4FE\"]\n",
        "        for word, color in zip(words, colors):\n",
        "            word.set_color(color)\n",
        "\n",
        "        words.save_state()\n",
        "\n",
        "        self.add(words)\n",
        "        self.wait()\n",
        "\n",
        "        # Back to unity\n",
        "        rect = SurroundingRectangle(og_words)\n",
        "        rect.set_color(RED)\n",
        "        chm_image = ImageMobject(\"/Users/grant/3Blue1Brown Dropbox/3Blue1Brown/videos/2024/transformers/chm/images/CHM_Exterior.jpeg\")\n",
        "        chm_image.match_width(rect)\n",
        "        chm_image.next_to(rect, DOWN)\n",
        "\n",
        "        self.play(Transform(words, og_words))\n",
        "        self.play(\n",
        "            ShowCreation(rect),\n",
        "            FadeIn(chm_image, DOWN)\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Three pieces\n",
        "        rects = VGroup(\n",
        "            SurroundingRectangle(word).set_fill(color, 0.2).set_stroke(color, 2)\n",
        "            for word, color in zip(words.saved_state, colors)\n",
        "        )\n",
        "        words.set_z_index(1)\n",
        "\n",
        "        icons = VGroup(\n",
        "            SVGMobject(\"GenericComputer.svg\"),\n",
        "            SVGMobject(\"History.svg\"),\n",
        "            SVGMobject(\"Museum.svg\"),\n",
        "        )\n",
        "        for word, icon in zip(words.saved_state, icons):\n",
        "            icon.set_fill(word.get_color(), 1, border_width=1)\n",
        "            icon.set_height(1)\n",
        "            icon.next_to(word, DOWN)\n",
        "\n",
        "        self.remove(chm_image)\n",
        "        self.play(\n",
        "            ReplacementTransform(VGroup(rect), rects),\n",
        "            Restore(words),\n",
        "            *(\n",
        "                FadeTransform(chm_image.copy(), icon)\n",
        "                for icon in icons\n",
        "            )\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class ExamplePhraseHeader(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        phrase = Text(\"The Computer History Museum\\nis located in ?????\")\n",
        "        phrase.to_edge(UP)\n",
        "        rect = SurroundingRectangle(phrase).set_stroke(WHITE, 2)\n",
        "\n",
        "        q_marks = phrase[\"?????\"][0]\n",
        "        q_marks[::4].set_fill(opacity=0)\n",
        "        q_rect = SurroundingRectangle(q_marks)\n",
        "        q_rect.set_fill(YELLOW, 0.25)\n",
        "        q_rect.set_stroke(YELLOW, 2)\n",
        "\n",
        "        self.add(q_rect)\n",
        "        self.add(phrase)\n",
        "\n",
        "\n",
        "class TrainingDataCHM(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Test\n",
        "        passages = [\n",
        "            \"The Computer History Museum (CHM) is a museum ... located in Mountain View...\",\n",
        "            \"Computer History Museum ... 1401 N. Shoreline Blvd. Mountain View...\",\n",
        "            \"Things to do in Mountain View ... the Computer History Museum ...\",\n",
        "            \"While I was in Mountain View ... stopped by the Computer History Museum ...\",\n",
        "        ]\n",
        "        items = VGroup(\n",
        "            get_paragraph(passage.split(\" \"), line_len=35, font_size=30)\n",
        "            for passage in passages\n",
        "        )\n",
        "\n",
        "        items.arrange(DOWN, buff=LARGE_BUFF, aligned_edge=LEFT)\n",
        "        items.to_corner(DL)\n",
        "        items.shift(0.5 * UP)\n",
        "        dots = Tex(R\"\\vdots\")\n",
        "        dots.next_to(items, DOWN, MED_LARGE_BUFF)\n",
        "        dots.shift_onto_screen(buff=MED_SMALL_BUFF)\n",
        "        items.add(dots)\n",
        "\n",
        "        title = Text(\"Training Data\")\n",
        "        title.next_to(items, UP, buff=LARGE_BUFF)\n",
        "        title.shift_onto_screen(buff=MED_SMALL_BUFF)\n",
        "        underline = Underline(title)\n",
        "\n",
        "        chm_phrases = VGroup(item[\"Computer History Museum\"] for item in items)\n",
        "        mv_phrases = VGroup(item[\"Mountain View\"] for item in items)\n",
        "\n",
        "        self.play(\n",
        "            FadeIn(title),\n",
        "            ShowCreation(underline),\n",
        "            LaggedStartMap(FadeIn, items, shift=DOWN, lag_ratio=0.15)\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(chm_phrases.animate.set_color(RED).set_anim_args(lag_ratio=0.1))\n",
        "        self.wait()\n",
        "        self.play(mv_phrases.animate.set_color(PINK).set_anim_args(lag_ratio=0.1))\n",
        "        self.wait()\n",
        "\n",
        "        # Arrows to ffn\n",
        "        ffn_point = 3 * RIGHT + DOWN\n",
        "        arrows = VGroup(\n",
        "            Arrow(\n",
        "                item.get_right(),\n",
        "                interpolate(item.get_right(), ffn_point, 0.6),\n",
        "                path_arc=arc * DEGREES,\n",
        "            )\n",
        "            for item, arc in zip(items[:-1], range(-40, 40, 20))\n",
        "        )\n",
        "        arrows.set_fill(border_width=1)\n",
        "        self.play(Write(arrows, lag_ratio=0.1), run_time=3)\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                *(\n",
        "                    FadeOutToPoint(letter.copy(), ffn_point)\n",
        "                    for letter in VGroup(chm_phrases, mv_phrases).family_members_with_points()\n",
        "                ),\n",
        "                lag_ratio=1e-2,\n",
        "                run_time=3\n",
        "            )\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class DivyUpParameters(ShowMachineWithDials):\n",
        "    def construct(self):\n",
        "        # Show machine\n",
        "        frame = self.frame\n",
        "        self.set_floor_plane(\"xz\")\n",
        "\n",
        "        machine = VGroup(*self.get_blocks_and_dials())\n",
        "        blocks, llm_text, flat_dials, last_dials = machine\n",
        "        machine.set_height(3.0)\n",
        "        machine.to_edge(DOWN, buff=LARGE_BUFF)\n",
        "\n",
        "        block_outlines = blocks.copy()\n",
        "        block_outlines.set_fill(opacity=0)\n",
        "        block_outlines.set_stroke(WHITE, 2)\n",
        "        block_outlines.insert_n_curves(20)\n",
        "\n",
        "        # last_dials.set_submobjects(last_dials[:3])  # Remove\n",
        "        last_dials.set_stroke(opacity=1)\n",
        "        for dial in last_dials:\n",
        "            dial[0].set_stroke(width=1)\n",
        "            dial[1].set_stroke(width=1)\n",
        "            dial[3].set_stroke(width=(3, 0))\n",
        "\n",
        "        frame.reorient(-23, -13, 0, (-0.41, -1.71, -0.06), 4.95)\n",
        "        self.play(\n",
        "            FadeIn(blocks, shift=0.0, lag_ratio=0.01),\n",
        "            LaggedStartMap(VShowPassingFlash, block_outlines.family_members_with_points(), time_width=2.0, lag_ratio=0.01, remover=True),\n",
        "            LaggedStartMap(VFadeInThenOut, flat_dials, lag_ratio=0.001, remover=True),\n",
        "            FadeIn(last_dials, time_span=(2, 3)),\n",
        "            self.frame.animate.reorient(10, -2, 0, (-0.25, -1.58, -0.02), 4.61),\n",
        "            run_time=3,\n",
        "        )\n",
        "        self.remove(flat_dials)\n",
        "\n",
        "        # Show individual blocks\n",
        "        top_blocks = blocks[:3].copy()\n",
        "        all_dials = VGroup(*last_dials)\n",
        "        for block in top_blocks:\n",
        "            dials = last_dials.copy()\n",
        "            dials.rotate(self.machine_phi, RIGHT)\n",
        "            dials.rotate(self.machine_theta, UP)\n",
        "            dials.move_to(block)\n",
        "            dials.set_stroke(opacity=1)\n",
        "            block.add(dials)\n",
        "            block.target = block.generate_target()\n",
        "            dials.set_opacity(0)\n",
        "            all_dials.add(*dials)\n",
        "\n",
        "        block_targets = Group(block.target for block in top_blocks)\n",
        "        block_targets.rotate(-self.machine_theta, UP)\n",
        "        block_targets.rotate(-self.machine_phi, RIGHT)\n",
        "        block_targets.set_height(2)\n",
        "        block_targets.arrange(RIGHT, buff=1.5)\n",
        "        block_targets.to_edge(UP)\n",
        "        block_targets.set_shading(0.1, 0.1, 0.1)\n",
        "\n",
        "        labels = VGroup(\n",
        "            TexText(R\"Word $\\to$ Vector\"),\n",
        "            Text(\"Attention\"),\n",
        "            Text(\"Feedforward\"),\n",
        "        )\n",
        "        for label, block in zip(labels, block_targets):\n",
        "            label.next_to(block, DOWN)\n",
        "\n",
        "        self.add(\n",
        "            blocks[0], top_blocks[0],\n",
        "            blocks[1], top_blocks[1],\n",
        "            blocks[2], top_blocks[2],\n",
        "            blocks[3:], last_dials\n",
        "        )\n",
        "        self.play(\n",
        "            MoveToTarget(top_blocks[1], time_span=(0, 2)),\n",
        "            MoveToTarget(top_blocks[2], time_span=(1, 3)),\n",
        "            MoveToTarget(top_blocks[0], time_span=(2, 4)),\n",
        "            Write(labels[1], time_span=(1.5, 2)),\n",
        "            Write(labels[2], time_span=(2.5, 3)),\n",
        "            Write(labels[0], time_span=(3.5, 4)),\n",
        "            frame.animate.to_default_state(),\n",
        "            run_time=4\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "        # Change all the parameters\n",
        "        self.play(\n",
        "            LaggedStart(\n",
        "                (dial.animate_set_value(dial.get_random_value())\n",
        "                for dial in all_dials),\n",
        "                lag_ratio=1 / len(all_dials),\n",
        "                run_time=6\n",
        "            ),\n",
        "            LaggedStart(\n",
        "                (FlashAround(dial, buff=0, color=YELLOW)\n",
        "                for dial in all_dials),\n",
        "                lag_ratio=1 / len(all_dials),\n",
        "                run_time=6\n",
        "            ),\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "# End clips\n",
        "\n",
        "\n",
        "class ShowPreviousVideos(InteractiveScene):\n",
        "    def construct(self):\n",
        "        # Backdrop\n",
        "        background = FullScreenRectangle()\n",
        "        self.add(background)\n",
        "\n",
        "        line = Line(UP, DOWN).set_height(FRAME_HEIGHT)\n",
        "        line.set_stroke(WHITE, 2)\n",
        "\n",
        "        series_name = Text(\"Deep Learning Series\", font_size=68)\n",
        "        series_name.to_edge(UP, buff=0.35)\n",
        "        self.add(series_name)\n",
        "\n",
        "        # Show thumbnails\n",
        "        thumbnails = Group(\n",
        "            Group(\n",
        "                Rectangle(16, 9).set_height(1).set_stroke(WHITE, 2),\n",
        "                ImageMobject(f\"https://img.youtube.com/vi/{slug}/maxresdefault.jpg\", height=1)\n",
        "            )\n",
        "            for slug in [\n",
        "                \"aircAruvnKk\",\n",
        "                \"IHZwWFHWa-w\",\n",
        "                \"Ilg3gGewQ5U\",\n",
        "                \"tIeHLnjs5U8\",\n",
        "                \"wjZofJX0v4M\",\n",
        "                \"eMlx5fFNoYc\",\n",
        "                \"9-Jl0dxWQs8\",\n",
        "            ]\n",
        "        )\n",
        "\n",
        "        thumbnails.arrange_in_grid(n_cols=4, buff=0.2)\n",
        "        thumbnails.set_width(FRAME_WIDTH - 1)\n",
        "        thumbnails.next_to(series_name, DOWN, buff=1.0)\n",
        "        thumbnails[-3:].set_x(0)\n",
        "\n",
        "        self.play(LaggedStartMap(FadeIn, thumbnails, shift=0.3 * UP, lag_ratio=0.35, run_time=4))\n",
        "        self.wait()\n",
        "\n",
        "        # Rearrange\n",
        "        left_x = -FRAME_WIDTH / 4\n",
        "        self.play(\n",
        "            series_name.animate.set_x(left_x),\n",
        "            thumbnails.animate.arrange_in_grid(n_cols=2, buff=0.25).set_height(6).set_x(left_x).to_edge(DOWN),\n",
        "            ShowCreation(line, time_span=(1, 2)),\n",
        "            run_time=2,\n",
        "        )\n",
        "        self.wait()\n",
        "\n",
        "\n",
        "class EndScreen(PatreonEndScreen):\n",
        "    title_text = \"Where to dig deeper\"\n",
        "    thanks_words = \"\"\"\n",
        "        Special thanks to these Patreon supporters\n",
        "    \"\"\"\n"
    ]
}