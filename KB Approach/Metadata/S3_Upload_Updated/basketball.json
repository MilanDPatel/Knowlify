{
    "topic": "the concept of visualizing data through animation. Specifically, it shows how to",
    "code": [
        "from manim_imports_ext import *\n",
        "import pandas as pd\n",
        "\n",
        "\n",
        "def year_to_file_name(year):\n",
        "    year_str = str(year)[-2:]\n",
        "    year_p1_str = str(year + 1)[-2:]\n",
        "    return f\"/Users/grant/Downloads/allShots/nbaShots{year_str}_{year_p1_str}.csv\"\n",
        "\n",
        "\n",
        "def load_data(year):\n",
        "    frame = pd.read_csv(\n",
        "        year_to_file_name(year),\n",
        "        usecols=[\n",
        "            'LOC_X',\n",
        "            'LOC_Y',\n",
        "            'SHOT_MADE_FLAG',\n",
        "        ]\n",
        "    )\n",
        "    coords = np.array(frame[[\"LOC_X\", \"LOC_Y\"]])\n",
        "    zero_free_coords = coords[~(coords == [0, 0]).all(1)]\n",
        "\n",
        "    return zero_free_coords\n",
        "\n",
        "\n",
        "def get_dots(axes, coords):\n",
        "    dots = DotCloud(axes.c2p(*coords.T))\n",
        "    dots.set_color(YELLOW)\n",
        "    dots.set_glow_factor(0)\n",
        "    dots.set_radius(0.01)\n",
        "    dots.shift(0.01 * OUT)\n",
        "    dots.set_opacity(0.5)\n",
        "    return dots\n",
        "\n",
        "\n",
        "def get_bars(axes, coords, resolution=(50, 94)):\n",
        "    # Test\n",
        "    # resolution = (10, 20)\n",
        "    # resolution = (25, 47)\n",
        "    x_min, x_max = axes.x_range\n",
        "    y_min, y_max = axes.y_range\n",
        "\n",
        "    int_coords = (((coords - [x_min, y_min]) / [x_max - x_min, y_max - y_min]) * resolution).astype(int)\n",
        "    int_coords = int_coords[::50]\n",
        "\n",
        "    xs = np.linspace(x_min, x_max, resolution[0])\n",
        "    ys = np.linspace(y_min, y_max, resolution[1])\n",
        "\n",
        "    factor = 200 / len(int_coords)\n",
        "\n",
        "    boxes = VGroup()\n",
        "    for i, j in it.product(range(len(xs) - 1), range(len(ys) - 1)):\n",
        "        n_in_range = (int_coords == (i, j)).all(1).sum()\n",
        "        x1, x2 = xs[i:i + 2]\n",
        "        y1, y2 = ys[j:j + 2]\n",
        "        line = Line(axes.c2p(x1, y1), axes.c2p(x2, y2))\n",
        "        box = VCube()\n",
        "        box.remove(box[-1])\n",
        "        box.set_fill(RED, 1)\n",
        "        box.set_stroke(BLACK, 0.5, 0.5)\n",
        "        box.set_width(0.35 * line.get_width(), stretch=True)\n",
        "        box.set_height(0.35 * line.get_height(), stretch=True)\n",
        "        box.set_depth(factor * n_in_range, stretch=True)\n",
        "        box.move_to(line, IN)\n",
        "        if n_in_range < 1:\n",
        "            box.set_opacity(0)\n",
        "        boxes.add(box)\n",
        "\n",
        "    boxes.set_fill(BLUE_E)\n",
        "    boxes.set_stroke(WHITE, 1)\n",
        "\n",
        "    return boxes\n",
        "\n",
        "\n",
        "class ShotHistory(InteractiveScene, ThreeDScene):\n",
        "    def construct(self):\n",
        "        self.always_depth_test = False\n",
        "        frame = self.frame\n",
        "        frame.reorient(-65, 70)\n",
        "\n",
        "        # Court\n",
        "        court_rect = Rectangle(50, 94)\n",
        "        court_rect.set_height(10)\n",
        "        court_rect.set_fill(GREY, 1)\n",
        "        court_rect.set_stroke(width=0)\n",
        "        court_rect.move_to(IN)\n",
        "        court = ImageMobject(\"basketball-court\")\n",
        "        court.rotate(90 * DEGREES)\n",
        "        court.replace(court_rect, stretch=True)\n",
        "        axes = Axes((-250, 250), (-50, 900))\n",
        "        axes.replace(court, stretch=True)\n",
        "        self.add(court)\n",
        "\n",
        "        # Year label\n",
        "        year_label = TexText(\"Year: 2000\", font_size=72)\n",
        "        year_mob = year_label.make_number_changeable(\"2000\", group_with_commas=False)\n",
        "        year_label.fix_in_frame()\n",
        "        year_label.to_edge(UP)\n",
        "        self.add(year_label)\n",
        "        year_mob.add_updater(lambda m: m.fix_in_frame())\n",
        "\n",
        "        # Create plots\n",
        "        all_dots = Group()\n",
        "        all_bars = Group()\n",
        "        year_range = (1997, 2022)\n",
        "        low_point = court_rect.get_bottom() + 0.6 * UP\n",
        "\n",
        "        for year in ProgressDisplay(range(*year_range)):\n",
        "            try:\n",
        "                coords = load_data(year)\n",
        "            except FileNotFoundError:\n",
        "                continue\n",
        "            all_dots.add(get_dots(axes, coords))\n",
        "            all_bars.add(get_bars(axes, coords))\n",
        "            for bar in all_bars[-1]:\n",
        "                dist = get_norm(bar.get_nadir() - low_point)\n",
        "                if dist < 0.5:\n",
        "                    bar.set_opacity(0)\n",
        "\n",
        "        for bars in all_bars:\n",
        "            bars.sort(lambda p: np.dot(p, frame.get_implied_camera_location()))\n",
        "\n",
        "        all_dots.save_state()\n",
        "        all_bars.save_state()\n",
        "\n",
        "        # Show all data\n",
        "        self.remove(all_dots, all_bars)\n",
        "        all_dots.restore()\n",
        "        all_bars.restore()\n",
        "\n",
        "        self.play(\n",
        "            frame.animate.reorient(-100),\n",
        "            ShowSubmobjectsOneByOne(all_dots, rate_func=linear, int_func=np.floor),\n",
        "            ShowSubmobjectsOneByOne(all_bars, rate_func=linear, int_func=np.floor),\n",
        "            UpdateFromAlphaFunc(year_mob, lambda m, a: m.set_value(\n",
        "                integer_interpolate(year_range[0], year_range[1] - 1, a)[0]\n",
        "            ), rate_func=linear),\n",
        "            run_time=20,\n",
        "        )\n",
        "        self.play(\n",
        "            frame.animate.reorient(-65),\n",
        "            run_time=10\n",
        "        )\n",
        "\n",
        "        # Reset states\n",
        "        all_bars.restore()\n",
        "        all_dots.restore()\n",
        "        curr_bars = all_bars[-1].copy()\n",
        "        curr_dots = all_dots[-1].copy()\n",
        "\n",
        "        self.remove(*all_bars, *all_dots)\n",
        "        self.add(curr_dots, curr_bars)\n",
        "\n",
        "        # Roll back to 2000\n",
        "        def update_dots(dots):\n",
        "            dots.set_submobjects(\n",
        "                all_dots[int(year_mob.get_value() - year_range[0])]\n",
        "            )\n",
        "\n",
        "        def update_bars(bars):\n",
        "            bars.set_submobjects(\n",
        "                all_bars[int(year_mob.get_value() - year_range[0])]\n",
        "            )\n",
        "\n",
        "        self.play(\n",
        "            UpdateFromFunc(curr_dots, update_dots),\n",
        "            UpdateFromFunc(curr_bars, update_bars),\n",
        "            ChangeDecimalToValue(year_mob, 2000),\n",
        "            self.frame.animate.reorient(-117, 69, 0).move_to([-0.54, -2.5, 0.31]).set_height(5.50),\n",
        "            run_time=3,\n",
        "        )\n",
        "        self.wait(2)\n",
        "        self.play(\n",
        "            self.frame.animate.reorient(42, 98, 0).move_to([-0.54, -2.5, 0.31]).set_height(5.50),\n",
        "            run_time=3,\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            self.frame.animate.reorient(-29, 95, 0).move_to([-0.57, -2.46, 0.52]).set_height(6.10),\n",
        "            run_time=3,\n",
        "        )\n",
        "\n",
        "        # Up to 2010\n",
        "        self.play(\n",
        "            UpdateFromFunc(curr_dots, update_dots),\n",
        "            UpdateFromFunc(curr_bars, update_bars),\n",
        "            ChangeDecimalToValue(year_mob, 2010),\n",
        "            self.frame.animate.reorient(-159, 84, 0).move_to([-0.41, -2.56, 0.76]).set_height(6.73),\n",
        "            run_time=4,\n",
        "        )\n",
        "        self.play(\n",
        "            self.frame.animate.reorient(-232, 84, 0).move_to([-0.41, -2.56, 0.76]).set_height(6.73),\n",
        "            run_time=15,\n",
        "        )\n",
        "        self.frame.reorient(128)\n",
        "        self.wait()\n",
        "\n",
        "        # Up to 2020\n",
        "        self.play(\n",
        "            UpdateFromFunc(curr_dots, update_dots),\n",
        "            UpdateFromFunc(curr_bars, update_bars),\n",
        "            ChangeDecimalToValue(year_mob, 2020),\n",
        "            self.frame.animate.reorient(0, 31, 0).move_to([-0.37, -2.11, 0.71]).set_height(7.26),\n",
        "            run_time=4,\n",
        "        )\n",
        "        self.wait()\n",
        "        self.play(\n",
        "            self.frame.animate.reorient(-34, 80, 0).move_to([-0.37, -2.11, 0.71]).set_height(7.26),\n",
        "            run_time=5,\n",
        "        )\n",
        "        self.play(\n",
        "            self.frame.animate.reorient(29, 70, 0).move_to([0.43, -1.87, 0.95]).set_height(7.49),\n",
        "            run_time=25,\n",
        "        )\n",
        "        self.wait()\n"
    ]
}